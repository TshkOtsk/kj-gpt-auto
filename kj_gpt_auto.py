from logging import basicConfig
from urllib import response
import streamlit as st
from langchain_community.chat_models import ChatOpenAI
from langchain.schema import (
    SystemMessage,
    HumanMessage,
    AIMessage
)
from langchain.callbacks import get_openai_callback

import os
import re
import urllib.parse
import random
import time
import datetime
import pandas as pd
import ast

import requests

from datasets.download import DownloadManager
from datasets import load_dataset
from sentence_transformers import SentenceTransformer
import faiss
import tiktoken

OPENAI_API_KEY = os.environ.get("OPENAI_API_KEY")
MIRO_API_KEY = os.environ.get("MIRO_API_KEY")
if not MIRO_API_KEY:
    MIRO_API_KEY = st.secrets["keys"]["MIRO_API_KEY"]

theme = ""
prompt_ptrn = ""
sytle_prompt = ""

# ç¾åœ¨æ™‚åˆ»ã®å–å¾—
dt_now = datetime.datetime.now()
# ç¾åœ¨æ™‚åˆ»ã®æ›¸å¼å¤‰æ›´
dt_now_formatted = dt_now.strftime("%Y%m%d_%H%M%S")

def theme_translate(user_theme,openai_api_key):
    theme = "ç§ãŒå…¥åŠ›ã™ã‚‹ã®ã¯ã€" + user_theme + "ã«ã¤ã„ã¦ã®ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚"
    llm = ChatOpenAI(openai_api_key=openai_api_key, temperature=0, model_name=st.session_state["model_name"])
    translating_prompt = f"""
Please translate the following Japanese sentence into English.
{theme}
"""
    st.session_state.messages.append(SystemMessage(content=translating_prompt))
    with st.spinner("KJ-GPTãŒãƒ†ãƒ¼ãƒžã‚’åˆ†æžã—ã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-1:])
    translated_theme = answer
    st.session_state.costs.append(cost)
    st.session_state["translated_theme"] = translated_theme
    return translated_theme

def eng_translates(text,openai_api_key):
    llm = ChatOpenAI(openai_api_key=openai_api_key, temperature=0, model_name=st.session_state["model_name"])
    translating_prompt = f"""
Please translate the following Japanese sentence into English.
{text}
"""
    st.session_state.messages.append(SystemMessage(content=translating_prompt))
    with st.spinner("KJ-GPTãŒå†…å®¹ã‚’åˆ†æžã—ã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-1:])
    translated_text = answer
    st.session_state.costs.append(cost)
    return translated_text

def summarize(text,openai_api_key,style):
    llm = ChatOpenAI(openai_api_key=openai_api_key, temperature=0.7, model_name=st.session_state["model_name"])

    if style=="formal":
        translating_prompt = f"""
### Instruction:
Act as an introspective person who excels at looking deep into his or her own mind.
Briefly summarise the following statement in about 50 words.

### Conditions:
Please write in Japanese.

### Input:
ï¼ˆãã®ä¸­ã§ã‚‚ä¸€ç•ªæ°—ã«ãªã£ã¦ã„ã‚‹ã®ãŒã€ï¼‰å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œã¨ã„ã†ã“ã¨ã€‚ï¼ˆç­”ãˆã®ã‚ã‚‹å•é¡Œã‚’ãŸã å¼·åˆ¶çš„ã«è§£ç­”ã•ã›ã‚‰ã‚Œã‚‹ã®ã¯ç„¡é§„ã ã¨æ€ã†ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚„ChatGPTãªã©ãŒæ€¥é€Ÿã«ç™ºå±•ã—ã¦ã„ã‚‹ã®ã§ã€ãã†ã„ã£ãŸå˜ãªã‚‹æš—è¨˜ã‚„è«–ç†è¨ˆç®—ã¯ã€ãã®ã†ã¡äººé–“ãŒã‚„ã‚‹å¿…è¦ã¯ãªããªã‚‹ã¨æ€ã†ã€‚ãã‚Œãªã®ã«ã€ã“ã®ã¾ã¾åå·®å€¤è‡³ä¸Šä¸»ç¾©ã®è©°ã‚è¾¼ã¿æ•™è‚²ã§ä»Šå¾Œã‚‚ã‚„ã£ã¦ã„ããªã‚‰ã°ã€ä½•ã®å½¹ã«ã‚‚ç«‹ãŸãªã„å¤§äººã‚’è‚²ã¦ã‚‹ã“ã¨ã«ãªã‚‹ã ã‚ã†ã€‚ï¼‰
ãã†ã§ã¯ãªãã¦ã€ã‚‚ã£ã¨æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„ã€‚ï¼ˆç­”ãˆã®ãªã„å•ã„ã«è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ç«‹ã¡å‘ã‹ã£ãŸã‚Šã€è‡ªåˆ†ã ã‘ã®ç‰¹åˆ¥ãªèˆˆå‘³é–¢å¿ƒã‚’è‚²ã¦ã¦å°‚é–€æ€§ã‚’é«˜ã‚ãŸã‚Šã™ã‚‹å‹‰å¼·ã®æ–¹ãŒä»Šå¾Œæ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã¯æ˜Žã‚‰ã‹ã ã€‚ï¼‰ã¤ã¾ã‚Šã€ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§ã¯ãªãã€å°†æ¥ã®ç¤¾ä¼šã«æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã‚’ã—ãŸã„ã¨ã„ã†ã“ã¨ã€‚ãã—ã¦ãã®ãŸã‚ã«ã¯ã€å­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãå¤§äººã®æ•™è‚²ã‚‚å¿…è¦ã ã¨æ€ã†ã€‚
ï¼ˆãã‚‚ãã‚‚ä»Šã®æ•™å¸«ãŒæ˜”ãªãŒã‚‰ã®è©°ã‚è¾¼ã¿å¼ã®æ•™è‚²ã§è‚²ã£ãŸã®ã§ã€ãã®æ„è­˜æ”¹é©ãŒå¿…è¦ã ã€‚æ•™å¸«è‡ªèº«ãŒç­”ãˆã®ãªã„è‡ªåˆ†ã®å¿ƒã®åº•ã‹ã‚‰å‡ºã¦ããŸå•ã„ã‚’è¨­å®šã—ã€ç”Ÿå¾’ã¨ä¸€ç·’ã«ãã‚Œã«å–ã‚Šçµ„ã‚€å§¿å‹¢ã‚’è¦‹ã›ãªã„ã¨ã€å­ä¾›é”ã¯ã¤ã„ã¦ã„ã‹ãªã„ã€‚ãã‚Œã ã‘ã§ã¯ãªãã€å­ä¾›ã®è¦ªãŸã¡ã‚‚æ–°ã—ã„å­¦ã³ã‚’äººç”Ÿã«å–ã‚Šå…¥ã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ç­”ãˆã®ãªã„æŽ¢ç©¶æ´»å‹•ã¯å¾“æ¥ã®å­¦ç¿’ã«æ¯”ã¹ã¦ã€ã‚ˆã‚Šæ—¥å¸¸ç”Ÿæ´»ã«æ·±ãé–¢ã‚ã‚‹ã‚‚ã®ã ã€‚æ™®æ®µéŽã”ã—ã¦ã„ã‚‹ä¸­ã§æ„Ÿã˜ã‚‹ç–‘å•ã‚„é•å’Œæ„Ÿãªã©ã‚’èµ·ç‚¹ã«ã—ãŸã€å®Ÿä½“é¨“ã«å³ã—ãŸå•ã„ã§ã‚ã‚‹ã»ã©ã€ä»Šå¾Œã®é•·ã„äººç”Ÿã§å–ã‚Šçµ„ã‚€ã«å€¤ã™ã‚‹æ·±ã„ã‚‚ã®ã«ãªã‚Šã‚„ã™ã„ã€‚ãªã®ã§ã€ã“ã‚Œã¾ã§ã®ã‚ˆã†ã«è¦ªãŒæ•™è‚²ã‚’å­¦æ ¡ã‚„å¡¾ã«ä»»ã›ã£ã±ãªã—ã«ã—ã¦ã€å®¶åº­ã§å­ä¾›ã«ç„¡é–¢å¿ƒã§ã„ã¦ã¯å­ä¾›ã®æŽ¢ç©¶å¿ƒãŒè‚²ã¡ã«ãããªã‚‹ã€‚æ•™å¸«ã¨åŒã˜ã‚ˆã†ã«ã€è¦ªãŸã¡ã‚‚è‡ªåˆ†ã®å•ã„ã‚’ç«‹ã¦ã¦ãã‚Œã‚’è¿½æ±‚ã™ã‚‹å–¶ã¿ã‚’å®Ÿéš›ã«ã‚„ã‚‹ã¹ãã ã€‚ãã—ã¦ã€ãã®è¡Œå‹•ãŒå­ä¾›ãŸã¡ã‚’æ„ŸåŒ–ã•ã›ã€å®¶åº­ã‚’æ´»æ°—ã¥ã‹ã›ã¦ã€ã•ã‚‰ã«ã¯è·å ´ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚‚ä¸Šã’ã‚‹ã“ã¨ã«ãªã‚‹ã®ãŒç†æƒ³ã ã€‚ï¼‰ã“ã‚Œã‚‰ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€æœªæ¥ã«ã¨ã£ã¦æ„å‘³ã®ã‚ã‚‹æœ¬å½“ã®å­¦ã³ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãèª°ã«ã§ã‚‚é‡è¦ãªã®ã ã¨è¨€ãˆã‚‹ã€‚

### Output:
è€ƒãˆã‚‹åŠ›ã‚„æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹åŠ›ã‚’è‚²ã‚€ã‚ˆã†ãªæœ¬å½“ã«æ„å‘³ã®ã‚ã‚‹å­¦ã³ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãèª°ã«ã§ã‚‚å¤§åˆ‡ã ã€‚

### Input:
{text}
"""
    else:
        translating_prompt = f"""
### Instruction:
Act as an introspective person who excels at looking deep into his or her own mind.
Briefly summarise the following statement in about 50 words.

### Conditions:
Please write in Japanese.

### Input:
ï¼ˆãã®ä¸­ã§ã‚‚ä¸€ç•ªæ°—ã«ãªã£ã¦ã„ã‚‹ã®ãŒã€ï¼‰å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œã¨ã„ã†ã“ã¨ã€‚ï¼ˆç­”ãˆã®ã‚ã‚‹å•é¡Œã‚’ãŸã å¼·åˆ¶çš„ã«è§£ç­”ã•ã›ã‚‰ã‚Œã‚‹ã®ã¯ç„¡é§„ã ã¨æ€ã†ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚„ChatGPTãªã©ãŒæ€¥é€Ÿã«ç™ºå±•ã—ã¦ã„ã‚‹ã®ã§ã€ãã†ã„ã£ãŸå˜ãªã‚‹æš—è¨˜ã‚„è«–ç†è¨ˆç®—ã¯ã€ãã®ã†ã¡äººé–“ãŒã‚„ã‚‹å¿…è¦ã¯ãªããªã‚‹ã¨æ€ã†ã€‚ãã‚Œãªã®ã«ã€ã“ã®ã¾ã¾åå·®å€¤è‡³ä¸Šä¸»ç¾©ã®è©°ã‚è¾¼ã¿æ•™è‚²ã§ä»Šå¾Œã‚‚ã‚„ã£ã¦ã„ããªã‚‰ã°ã€ä½•ã®å½¹ã«ã‚‚ç«‹ãŸãªã„å¤§äººã‚’è‚²ã¦ã‚‹ã“ã¨ã«ãªã‚‹ã ã‚ã†ã€‚ï¼‰
ãã†ã§ã¯ãªãã¦ã€ã‚‚ã£ã¨æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„ã€‚ï¼ˆç­”ãˆã®ãªã„å•ã„ã«è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ç«‹ã¡å‘ã‹ã£ãŸã‚Šã€è‡ªåˆ†ã ã‘ã®ç‰¹åˆ¥ãªèˆˆå‘³é–¢å¿ƒã‚’è‚²ã¦ã¦å°‚é–€æ€§ã‚’é«˜ã‚ãŸã‚Šã™ã‚‹å‹‰å¼·ã®æ–¹ãŒä»Šå¾Œæ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã¯æ˜Žã‚‰ã‹ã ã€‚ï¼‰ã¤ã¾ã‚Šã€ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§ã¯ãªãã€å°†æ¥ã®ç¤¾ä¼šã«æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã‚’ã—ãŸã„ã¨ã„ã†ã“ã¨ã€‚ãã—ã¦ãã®ãŸã‚ã«ã¯ã€å­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãå¤§äººã®æ•™è‚²ã‚‚å¿…è¦ã ã¨æ€ã†ã€‚
ï¼ˆãã‚‚ãã‚‚ä»Šã®æ•™å¸«ãŒæ˜”ãªãŒã‚‰ã®è©°ã‚è¾¼ã¿å¼ã®æ•™è‚²ã§è‚²ã£ãŸã®ã§ã€ãã®æ„è­˜æ”¹é©ãŒå¿…è¦ã ã€‚æ•™å¸«è‡ªèº«ãŒç­”ãˆã®ãªã„è‡ªåˆ†ã®å¿ƒã®åº•ã‹ã‚‰å‡ºã¦ããŸå•ã„ã‚’è¨­å®šã—ã€ç”Ÿå¾’ã¨ä¸€ç·’ã«ãã‚Œã«å–ã‚Šçµ„ã‚€å§¿å‹¢ã‚’è¦‹ã›ãªã„ã¨ã€å­ä¾›é”ã¯ã¤ã„ã¦ã„ã‹ãªã„ã€‚ãã‚Œã ã‘ã§ã¯ãªãã€å­ä¾›ã®è¦ªãŸã¡ã‚‚æ–°ã—ã„å­¦ã³ã‚’äººç”Ÿã«å–ã‚Šå…¥ã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ç­”ãˆã®ãªã„æŽ¢ç©¶æ´»å‹•ã¯å¾“æ¥ã®å­¦ç¿’ã«æ¯”ã¹ã¦ã€ã‚ˆã‚Šæ—¥å¸¸ç”Ÿæ´»ã«æ·±ãé–¢ã‚ã‚‹ã‚‚ã®ã ã€‚æ™®æ®µéŽã”ã—ã¦ã„ã‚‹ä¸­ã§æ„Ÿã˜ã‚‹ç–‘å•ã‚„é•å’Œæ„Ÿãªã©ã‚’èµ·ç‚¹ã«ã—ãŸã€å®Ÿä½“é¨“ã«å³ã—ãŸå•ã„ã§ã‚ã‚‹ã»ã©ã€ä»Šå¾Œã®é•·ã„äººç”Ÿã§å–ã‚Šçµ„ã‚€ã«å€¤ã™ã‚‹æ·±ã„ã‚‚ã®ã«ãªã‚Šã‚„ã™ã„ã€‚ãªã®ã§ã€ã“ã‚Œã¾ã§ã®ã‚ˆã†ã«è¦ªãŒæ•™è‚²ã‚’å­¦æ ¡ã‚„å¡¾ã«ä»»ã›ã£ã±ãªã—ã«ã—ã¦ã€å®¶åº­ã§å­ä¾›ã«ç„¡é–¢å¿ƒã§ã„ã¦ã¯å­ä¾›ã®æŽ¢ç©¶å¿ƒãŒè‚²ã¡ã«ãããªã‚‹ã€‚æ•™å¸«ã¨åŒã˜ã‚ˆã†ã«ã€è¦ªãŸã¡ã‚‚è‡ªåˆ†ã®å•ã„ã‚’ç«‹ã¦ã¦ãã‚Œã‚’è¿½æ±‚ã™ã‚‹å–¶ã¿ã‚’å®Ÿéš›ã«ã‚„ã‚‹ã¹ãã ã€‚ãã—ã¦ã€ãã®è¡Œå‹•ãŒå­ä¾›ãŸã¡ã‚’æ„ŸåŒ–ã•ã›ã€å®¶åº­ã‚’æ´»æ°—ã¥ã‹ã›ã¦ã€ã•ã‚‰ã«ã¯è·å ´ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚‚ä¸Šã’ã‚‹ã“ã¨ã«ãªã‚‹ã®ãŒç†æƒ³ã ã€‚ï¼‰ã“ã‚Œã‚‰ã‚’ã¾ã¨ã‚ã‚‹ã¨ã€æœªæ¥ã«ã¨ã£ã¦æ„å‘³ã®ã‚ã‚‹æœ¬å½“ã®å­¦ã³ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãèª°ã«ã§ã‚‚é‡è¦ãªã®ã ã¨è¨€ãˆã‚‹ã€‚

### Output:
ã‚¬ãƒã§æ„å‘³ã‚ã‚‹å‹‰å¼·ã‚’ã™ã‚Œã°ã€è€ƒãˆã‚‹åŠ›ã¨ã‹æŒ‘æˆ¦ã™ã‚‹åŠ›ãŒä¼¸ã³ã‚‹ã—ã€ãã‚Œã¯å­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãã¦å¤§äººã«ãªã£ã¦ã‚‚å¤§åˆ‡ã€‚

### Input:
{text}
"""
    st.session_state.messages.append(SystemMessage(content=translating_prompt))
    with st.spinner("KJ-GPTãŒå†…å®¹ã‚’è¦ç´„ã—ã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-1:])
    summarized_text = answer
    st.session_state.costs.append(cost)
    return summarized_text

def data_generating(user_theme,openai_api_key):
    theme = user_theme
    llm = ChatOpenAI(openai_api_key=openai_api_key, temperature=0, model_name=st.session_state["model_name"])
    translating_prompt = f"""
Please translate the following Japanese sentence into English.
{theme}
"""
    st.session_state.messages.append(SystemMessage(content=translating_prompt))
    with st.spinner("KJ-GPTãŒãƒ†ãƒ¼ãƒžã«ã¤ã„ã¦è€ƒãˆã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-1:])
    translated_theme = answer
    st.session_state.costs.append(cost)

    generating_prompt = f"""
### Instruction:
Please list about 15 bulleted assertions or opinions from a variety of perspectives, including those that may be somehow related to the following topic.
Items should begin with the letter "ãƒ»".
Items should be generated with more subjective items that are full of emotions and feelings.
Keep sentences as concise as possible, avoiding duplication.
Please write in Japanese.

### Topic:
{translated_theme}
"""
    return generating_prompt

def select_style():
    # æ–‡ç« ã‚¹ã‚¿ã‚¤ãƒ«ã®é¸æŠž
    style_choice = st.sidebar.radio("æ–‡ç« åŒ–ã®ã‚¹ã‚¿ã‚¤ãƒ«:", ("ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«", "ãƒ•ã‚©ãƒ¼ãƒžãƒ«"))
    if style_choice == "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«":
        style = "casual"
        sytle_prompt = "Write in a casual manner."
    else:
        style = "formal"
        sytle_prompt = "Please write in a formal manner."
    return style

def prompt_grouping(lines, translated_theme):
    # ä¾‹ç¤ºãƒ‡ãƒ¼ã‚¿ã®å‡ºå…¸
    # ã€ŒR1 ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã«æŠ€è¡“å”åŠ›ã™ã‚‹ã«ã¯ï¼Ÿã€
    # å››æ³¨è¨˜ (1) 1985.1.11 (2)è‡ªå®… (3)å·å–œç”°äºŒéƒŽ (4)å·å–œç”°äºŒéƒŽ (5)ã€ŽKJæ³•ã€åŸ·ç­†ç”¨ (6)å·å–œç”°äºŒéƒŽ1986ã€ŽKJæ³• æ¸¾æ²Œã‚’ã—ã¦èªžã‚‰ã—ã‚ã‚‹ã€ä¸­å¤®å…¬è«–ç¤¾ã€pp.374-375
    theme = translated_theme
    grouping1 = f"""
### Instruction:
{theme}
Please group all of these items with those that are closer in deeper underlying meaning.

### Condition:
Please write in Japanese.
Each group should have at most 3 items. Items that cannot be grouped should be listed as is.
Items with conflicting content should be grouped separately.

### Input:
#### Theme:
ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã«æŠ€è¡“å”åŠ›ã™ã‚‹ã«ã¯ï¼Ÿ
#### Data:
ãƒ˜ãƒžã‚’ã™ã‚‹ã¨ãƒãƒ‘ãƒ¼ãƒ«ã¯æˆ¦äº‰ã®å¼•ãé‡‘ã¨ãªã£ãŸãƒãƒ«ã‚«ãƒ³ãƒ»ãƒ™ãƒˆãƒŠãƒ ã¨åŒ–ã—ã¦ã—ã¾ã†ã€‚
å±±å²³åœ°ã®æ‘ã€…ã«ã¯ã€ç´ æœ´ãªæ´»åŠ›ãŒã‚ã‚Šãã†ã ã€‚
ä¼çµ±çš„ãªæš®ã‚‰ã—æ–¹ã‚’ã€ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ãã†ã€‚
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
å±±å²³åœ°åŸŸã®ç¤¾ä¼šã¯ç—…æ°—ã«ã‹ã‹ã£ã¦ã„ã‚‹ã®ã§ã€ãã®åŽŸå› ã‚’çªãæ­¢ã‚ã‚ˆã†ã€‚
è¿‘ä»£åŒ–ã®ã‚‚ã¨ã€éŽç–ŽéŽå¯†ãŒé‡å¤§ãªå•é¡Œã¨ãªã£ã¦ã„ã‚‹ã€‚
å¤–å›½äººã®ç§ã«ã‚‚ã§ãã‚‹ã“ã¨ã¯ã€æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰ã€å†…æ”¿ã«ã¯å¹²æ¸‰ã—ãŸããªã„ã€‚
è¿‘å¤–æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ‘ã®æ´»æ€§åŒ–ã«å½¹ç«‹ã¤ã‚‚ã®ã‚‚å¤šãã‚ã‚‹ã€‚
ç¾åœ°äººã‚ˆã‚Šç§ã®æ–¹ãŒè¿‘ä»£æ–‡æ˜Žã®éºç”£ã«ã¯è©³ã—ã„ã€‚
éŽç–Žã¯ä¼çµ±çš„ãªæ–‡åŒ–ã¨ç’°å¢ƒã‚’ç ´å£Šã—ã¤ã¤ã‚ã‚‹ã€‚
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€åœ°ç†å­¦ãƒ»æ°‘æ—å­¦ã§ã®çµŒé¨“ã‚’æ´»ã‹ã™ã“ã¨ã ã€‚
ä½æ°‘ã®åŠ›ã§ç¶­æŒã§ãã‚‹ã‚ˆã†ãªæŠ€è¡“å°Žå…¥ã§ã‚ã‚ŠãŸã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«ã«è»Šé“ã°ã‹ã‚Šå…ˆè¡Œã—ã¦ç™ºé”ã•ã›ã‚Œã°ã€å±±ä¸­ã¯éŽç–ŽåŒ–ã™ã‚‹ã°ã‹ã‚Šã§ã¯ãªã„ã‹ã€‚
ä½æ°‘ã«ã¨ã£ã¦æœ€ã‚‚åŠ¹æžœçš„ãªäº‹æ¥­ã‹ã‚‰é‡ç‚¹çš„ã«å§‹ã‚ãŸã„ã€‚
å±±ä¸­ã®æ‘ã€…ãŒè‡ªåŠ›æ›´ç”Ÿã§æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’æ¿€åŠ±ã—ãŸã„ã€‚
ä½æ°‘ã¨ä¸€ç·’ã«ãªã£ã¦æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ãã ã€‚
åœ°ã™ã¹ã‚ŠãŒé »ç™ºã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚
æˆåŠŸã—ãŸå®Ÿä¾‹ã¯åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã™åŠ¹æžœãŒã‚ã‚ã†ã€‚
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã¨ã„ã†å®Ÿä¾‹ã‚’ã€å°åœ°åŸŸã§å®Ÿç¾ã—ãŸã„ã€‚
å±±æ°‘ã®ç¦ç¥‰å‘ä¸ŠãŒå›½éš›ç´›äº‰ã®æœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
æ–°æŠ€è¡“ã®å°Žå…¥ã¯ã€ä½æ°‘ã«ã¨ã£ã¦é»’å­—ã®äº‹æ¥­ã§ã‚ã‚‹ã¹ãã ã€‚
ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ‰ãˆã€ãã‚Œã‚’æ´»ç”¨ã—ãŸã„ã€‚
æŠ€è¡“å”åŠ›ã®çµæžœã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã‚’ãã®ã¾ã¾æŠ¼ã—ä»˜ã‘ã‚‹ã®ã¯ç–‘å•ã€‚
å€‹ã€…ã®æ‘ãŒæ´»æ€§åŒ–ã—ãªã„ã¨ã€äººä½“ã«ä¾‹ãˆã‚Œã°ç­‹è‚‰ãŒç™ºé”ã—ãªã„ã‚ˆã†ãªã‚‚ã®ã€‚
ä½æ°‘ã¯ç”Ÿæ´»è‹¦ã«å–˜ãŽã€è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
æ£®æž—ãŒã©ã‚“ã©ã‚“å¤±ã‚ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
ã¾ãšç¾åœ°ã®è‡ªç„¶ãƒ»æ–‡åŒ–ãƒ»äººé–“ã‹ã‚‰ã§ãã‚‹ã ã‘å­¦ã¶ã“ã¨ã ã€‚
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«ã®äººå£ã¯æ€¥å¢—ã—ã¦ã„ã‚‹ãŒã€ã©ã†ã‚„ã£ã¦äººã€…ã¯é£Ÿã£ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ã€‚

### Output:
ã‚°ãƒ«ãƒ¼ãƒ—1:
æˆåŠŸã—ãŸå®Ÿä¾‹ã¯åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã™åŠ¹æžœãŒã‚ã‚ã†ã€‚
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã¨ã„ã†å®Ÿä¾‹ã‚’ã€å°åœ°åŸŸã§å®Ÿç¾ã—ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—2:
ãƒãƒ‘ãƒ¼ãƒ«ã«è»Šé“ã°ã‹ã‚Šå…ˆè¡Œã—ã¦ç™ºé”ã•ã›ã‚Œã°ã€å±±ä¸­ã¯éŽç–ŽåŒ–ã™ã‚‹ã°ã‹ã‚Šã§ã¯ãªã„ã‹ã€‚
å€‹ã€…ã®æ‘ãŒæ´»æ€§åŒ–ã—ãªã„ã¨ã€äººä½“ã«ä¾‹ãˆã‚Œã°ç­‹è‚‰ãŒç™ºé”ã—ãªã„ã‚ˆã†ãªã‚‚ã®ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—3:
ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ‰ãˆã€ãã‚Œã‚’æ´»ç”¨ã—ãŸã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã‚’ãã®ã¾ã¾æŠ¼ã—ä»˜ã‘ã‚‹ã®ã¯ç–‘å•ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—4:
è¿‘ä»£åŒ–ã®ã‚‚ã¨ã€éŽç–ŽéŽå¯†ãŒé‡å¤§ãªå•é¡Œã¨ãªã£ã¦ã„ã‚‹ã€‚
éŽç–Žã¯ä¼çµ±çš„ãªæ–‡åŒ–ã¨ç’°å¢ƒã‚’ç ´å£Šã—ã¤ã¤ã‚ã‚‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—5:
æ£®æž—ãŒã©ã‚“ã©ã‚“å¤±ã‚ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
åœ°ã™ã¹ã‚ŠãŒé »ç™ºã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—6:
å±±æ°‘ã®ç¦ç¥‰å‘ä¸ŠãŒå›½éš›ç´›äº‰ã®æœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
ãƒ˜ãƒžã‚’ã™ã‚‹ã¨ãƒãƒ‘ãƒ¼ãƒ«ã¯æˆ¦äº‰ã®å¼•ãé‡‘ã¨ãªã£ãŸãƒãƒ«ã‚«ãƒ³ãƒ»ãƒ™ãƒˆãƒŠãƒ ã¨åŒ–ã—ã¦ã—ã¾ã†ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—7:
å±±å²³åœ°åŸŸã®ç¤¾ä¼šã¯ç—…æ°—ã«ã‹ã‹ã£ã¦ã„ã‚‹ã®ã§ã€ãã®åŽŸå› ã‚’çªãæ­¢ã‚ã‚ˆã†ã€‚
ä¼çµ±çš„ãªæš®ã‚‰ã—æ–¹ã‚’ã€ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ãã†ã€‚
ã¾ãšç¾åœ°ã®è‡ªç„¶ãƒ»æ–‡åŒ–ãƒ»äººé–“ã‹ã‚‰ã§ãã‚‹ã ã‘å­¦ã¶ã“ã¨ã ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—8:
è¿‘å¤–æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ‘ã®æ´»æ€§åŒ–ã«å½¹ç«‹ã¤ã‚‚ã®ã‚‚å¤šãã‚ã‚‹ã€‚
ç¾åœ°äººã‚ˆã‚Šç§ã®æ–¹ãŒè¿‘ä»£æ–‡æ˜Žã®éºç”£ã«ã¯è©³ã—ã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—9:
å¤–å›½äººã®ç§ã«ã‚‚ã§ãã‚‹ã“ã¨ã¯ã€æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰ã€å†…æ”¿ã«ã¯å¹²æ¸‰ã—ãŸããªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—10:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ãã ã€‚
ä½æ°‘ã¯ç”Ÿæ´»è‹¦ã«å–˜ãŽã€è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—11:
å±±ä¸­ã®æ‘ã€…ãŒè‡ªåŠ›æ›´ç”Ÿã§æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’æ¿€åŠ±ã—ãŸã„ã€‚
æŠ€è¡“å”åŠ›ã®çµæžœã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—12:
ä½æ°‘ã®åŠ›ã§ç¶­æŒã§ãã‚‹ã‚ˆã†ãªæŠ€è¡“å°Žå…¥ã§ã‚ã‚ŠãŸã„ã€‚
æ–°æŠ€è¡“ã®å°Žå…¥ã¯ã€ä½æ°‘ã«ã¨ã£ã¦é»’å­—ã®äº‹æ¥­ã§ã‚ã‚‹ã¹ãã ã€‚
ä½æ°‘ã«ã¨ã£ã¦æœ€ã‚‚åŠ¹æžœçš„ãªäº‹æ¥­ã‹ã‚‰é‡ç‚¹çš„ã«å§‹ã‚ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—13:
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—14:
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—15:
ãƒãƒ‘ãƒ¼ãƒ«ã®äººå£ã¯æ€¥å¢—ã—ã¦ã„ã‚‹ãŒã€ã©ã†ã‚„ã£ã¦äººã€…ã¯é£Ÿã£ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—16:
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—17:
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€åœ°ç†å­¦ãƒ»æ°‘æ—å­¦ã§ã®çµŒé¨“ã‚’æ´»ã‹ã™ã“ã¨ã ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—18:
ä½æ°‘ã¨ä¸€ç·’ã«ãªã£ã¦æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
ã‚°ãƒ«ãƒ¼ãƒ—19:
å±±å²³åœ°ã®æ‘ã€…ã«ã¯ã€ç´ æœ´ãªæ´»åŠ›ãŒã‚ã‚Šãã†ã ã€‚

### Input:
"""
    grouping2 = f"""
### Instruction:
{theme}
Please group all of these items with those that are closer in deeper underlying meaning.

### Condition:
Please write in Japanese.
Each group should have at most 3 items. Items that cannot be grouped should be listed as is.
Items with conflicting content should be grouped separately.

### Input:
#### Theme:
ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã«æŠ€è¡“å”åŠ›ã™ã‚‹ã«ã¯ï¼Ÿ
#### Data:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«å±±ä¸­ã«è»Šé“ã®ã¿ç™ºé”ã•ã›å€‹ã€…ã®æ‘ã®æ´»æ€§åŒ–ãŒãªã„ã¨ã€ç­‹è‚‰ã‚’å¿˜ã‚Œè¡€ç®¡ã®ã¿å¤ªã‚‰ã›ãŸã®ã¨åŒã˜ãã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã®åž‹é€šã‚Šã®æŠ¼ã—ã¤ã‘ã§ãªãã€ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã¹ãã ã€‚
è¿‘ä»£åŒ–ã®ã‚‚ã¨ã§ã€éŽç–ŽåŒ–ã¯ä¼çµ±çš„ãªæ–‡åŒ–ã¨ç’°å¢ƒã®è§£ä½“ã¾ã§ã‚‚ãŸã‚‰ã—ã€éŽç–ŽéŽå¯†åŒ–ã¯é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
è‡ªç„¶ç’°å¢ƒãŒã©ã‚“ã©ã‚“ç ´å£Šã•ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
å±±å²³åœ°åŸŸã‚’å›½éš›ç´›äº‰ã®æ¸©åºŠã«ã›ã¬ãŸã‚ã«ã¯ã€ä½æ°‘ã®ç¦ç¥‰å‘ä¸Šã“ãæœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚
ãƒãƒ‘ãƒ¼ãƒ«å±±æ‘ã®æ´»æ€§åŒ–ã«å½¹ç«‹ã¤è¿‘ä»£æ–‡æ˜Žã®éºç”£ã«ã¤ã„ã¦ã¯ã€ä½æ°‘ã‚ˆã‚Šç§ã®æ–¹ãŒè©³ã—ã„ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰å†…æ”¿å¹²æ¸‰ã¯å¥½ã¾ãšã€ãƒãƒ‘ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã§ãã‚‹ã“ã¨ã¯æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ä½æ°‘ã®ç”Ÿæ´»è‹¦ã‚’è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
å±±ä¸­ã®æ‘ã€…ã®è‡ªåŠ›æ›´ç”Ÿã«ã‚ˆã‚‹æ´»æ€§åŒ–ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
ä½æ°‘ã®åŠ›ã§é»’å­—ã®äº‹æ¥­ã¨ã—ã¦ç¶­æŒã§ãã‚‹ã€æœ€ã‚‚åŠ¹æžœçš„ãªæŠ€è¡“å”åŠ›ã‹ã‚‰å§‹ã‚ãŸã„ã€‚
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«ã®äººå£ã¯æ€¥å¢—ã—ã¦ã„ã‚‹ãŒã€ã©ã†ã‚„ã£ã¦äººã€…ã¯é£Ÿã£ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ã€‚
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€åœ°ç†å­¦ãƒ»æ°‘æ—å­¦ã§ã®çµŒé¨“ã‚’æ´»ã‹ã™ã“ã¨ã ã€‚
ä½æ°‘ã¨ä¸€ç·’ã«ãªã£ã¦æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
å±±å²³åœ°ã®æ‘ã€…ã«ã¯ã€ç´ æœ´ãªæ´»åŠ›ãŒã‚ã‚Šãã†ã ã€‚

### Output:
ã‚°ãƒ«ãƒ¼ãƒ—1:
ãƒãƒ‘ãƒ¼ãƒ«å±±ä¸­ã«è»Šé“ã®ã¿ç™ºé”ã•ã›å€‹ã€…ã®æ‘ã®æ´»æ€§åŒ–ãŒãªã„ã¨ã€ç­‹è‚‰ã‚’å¿˜ã‚Œè¡€ç®¡ã®ã¿å¤ªã‚‰ã›ãŸã®ã¨åŒã˜ãã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã®åž‹é€šã‚Šã®æŠ¼ã—ã¤ã‘ã§ãªãã€ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã¹ãã ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—2:
è¿‘ä»£åŒ–ã®ã‚‚ã¨ã§ã€éŽç–ŽåŒ–ã¯ä¼çµ±çš„ãªæ–‡åŒ–ã¨ç’°å¢ƒã®è§£ä½“ã¾ã§ã‚‚ãŸã‚‰ã—ã€éŽç–ŽéŽå¯†åŒ–ã¯é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
è‡ªç„¶ç’°å¢ƒãŒã©ã‚“ã©ã‚“ç ´å£Šã•ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«ã®äººå£ã¯æ€¥å¢—ã—ã¦ã„ã‚‹ãŒã€ã©ã†ã‚„ã£ã¦äººã€…ã¯é£Ÿã£ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—3:
ä½æ°‘ã¨ä¸€ç·’ã«ãªã£ã¦æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
å±±å²³åœ°ã®æ‘ã€…ã«ã¯ã€ç´ æœ´ãªæ´»åŠ›ãŒã‚ã‚Šãã†ã ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—4:
ãƒãƒ‘ãƒ¼ãƒ«å±±æ‘ã®æ´»æ€§åŒ–ã«å½¹ç«‹ã¤è¿‘ä»£æ–‡æ˜Žã®éºç”£ã«ã¤ã„ã¦ã¯ã€ä½æ°‘ã‚ˆã‚Šç§ã®æ–¹ãŒè©³ã—ã„ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰å†…æ”¿å¹²æ¸‰ã¯å¥½ã¾ãšã€ãƒãƒ‘ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã§ãã‚‹ã“ã¨ã¯æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€åœ°ç†å­¦ãƒ»æ°‘æ—å­¦ã§ã®çµŒé¨“ã‚’æ´»ã‹ã™ã“ã¨ã ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—5:
å±±ä¸­ã®æ‘ã€…ã®è‡ªåŠ›æ›´ç”Ÿã«ã‚ˆã‚‹æ´»æ€§åŒ–ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
ä½æ°‘ã®åŠ›ã§é»’å­—ã®äº‹æ¥­ã¨ã—ã¦ç¶­æŒã§ãã‚‹ã€æœ€ã‚‚åŠ¹æžœçš„ãªæŠ€è¡“å”åŠ›ã‹ã‚‰å§‹ã‚ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—6:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—7:
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—8:
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—9:
å±±å²³åœ°åŸŸã‚’å›½éš›ç´›äº‰ã®æ¸©åºŠã«ã›ã¬ãŸã‚ã«ã¯ã€ä½æ°‘ã®ç¦ç¥‰å‘ä¸Šã“ãæœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—10:
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—11:
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—12:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ä½æ°‘ã®ç”Ÿæ´»è‹¦ã‚’è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚

### Input:
"""
    grouping3 = f"""
### Instruction:
{theme}
Please group all of these items with those that are closer in deeper underlying meaning.

### Condition:
Please write in Japanese.
Each group should have at most 3 items. Items that cannot be grouped should be listed as is.
Items with conflicting content should be grouped separately.

### Input:
#### Theme:
ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã«æŠ€è¡“å”åŠ›ã™ã‚‹ã«ã¯ï¼Ÿ
#### Data:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
å±±å²³åœ°åŸŸã‚’å›½éš›ç´›äº‰ã®æ¸©åºŠã«ã›ã¬ãŸã‚ã«ã¯ã€ä½æ°‘ã®ç¦ç¥‰å‘ä¸Šã“ãæœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ä½æ°‘ã®ç”Ÿæ´»è‹¦ã‚’è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã®åž‹é€šã‚ŠãªæŠ¼ã—ã¤ã‘ã§ãªãã€ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã‚‹ã®ã§ãªã‘ã‚Œã°ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
äººå£æ€¥å¢—ã‚’ä¼´ã†è¿‘ä»£åŒ–ã®ç›´æŽ¥é–“æŽ¥ã®å½±éŸ¿ä¸‹ã«ã€ç”Ÿæ´»å•é¡Œã‚’ã‚ãã‚‹å…¨ä½“çŠ¶æ³ã®å¤‰åŒ–ã§éŽç–ŽéŽå¯†åŒ–ãŒé€²ã¿ã€ã²ã„ã¦ã¯ä¼çµ±çš„ãªæ–‡åŒ–ãƒ»ç’°å¢ƒãŒè§£ä½“ã•ã‚Œã€é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
å±±åœ°ã®æ‘ã€…ãŒæŒã¤ã‚‰ã—ã„ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ã€ä½æ°‘ã¨ä¸€ä½“ã«ãªã‚Šåœ°åŸŸã®æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
ç§ã«ã§ãã‚‹ã“ã¨ã¯è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’æ´»ç”¨ã—ã€ãã“ã§åŸ¹ã‚ã‚ŒãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚
å±±ä¸­ã®æ‘ã€…ãŒé»’å­—ã§è‡ªåŠ›æ›´ç”Ÿã§ãæ´»æ€§åŒ–ã™ã‚‹ã“ã¨ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’ã‚„ã‚Šã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚

### Output:
ã‚°ãƒ«ãƒ¼ãƒ—1:
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã®åž‹é€šã‚ŠãªæŠ¼ã—ã¤ã‘ã§ãªãã€ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã‚‹ã®ã§ãªã‘ã‚Œã°ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—2:
å±±åœ°ã®æ‘ã€…ãŒæŒã¤ã‚‰ã—ã„ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ã€ä½æ°‘ã¨ä¸€ä½“ã«ãªã‚Šåœ°åŸŸã®æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—3:
ç§ã«ã§ãã‚‹ã“ã¨ã¯è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’æ´»ç”¨ã—ã€ãã“ã§åŸ¹ã‚ã‚ŒãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—4:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ä½æ°‘ã®ç”Ÿæ´»è‹¦ã‚’è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
å±±ä¸­ã®æ‘ã€…ãŒé»’å­—ã§è‡ªåŠ›æ›´ç”Ÿã§ãæ´»æ€§åŒ–ã™ã‚‹ã“ã¨ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’ã‚„ã‚Šã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—5:
äººå£æ€¥å¢—ã‚’ä¼´ã†è¿‘ä»£åŒ–ã®ç›´æŽ¥é–“æŽ¥ã®å½±éŸ¿ä¸‹ã«ã€ç”Ÿæ´»å•é¡Œã‚’ã‚ãã‚‹å…¨ä½“çŠ¶æ³ã®å¤‰åŒ–ã§éŽç–ŽéŽå¯†åŒ–ãŒé€²ã¿ã€ã²ã„ã¦ã¯ä¼çµ±çš„ãªæ–‡åŒ–ãƒ»ç’°å¢ƒãŒè§£ä½“ã•ã‚Œã€é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—6:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚
ã‚°ãƒ«ãƒ¼ãƒ—7:
å±±å²³åœ°åŸŸã‚’å›½éš›ç´›äº‰ã®æ¸©åºŠã«ã›ã¬ãŸã‚ã«ã¯ã€ä½æ°‘ã®ç¦ç¥‰å‘ä¸Šã“ãæœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚

### Input:
"""

    if lines >= 20:
        prompt_ptrn = grouping1
    elif 13 <= lines < 20:
        prompt_ptrn = grouping2
    else:
        prompt_ptrn = grouping3
    return prompt_ptrn

def prompt_labeling(number_of_items, break_point, style):

    if style == "formal":
        labeling1 = f"""
### Instructions:
Please summarize the items of groups in one concise sentence with a deeper meaning.

### Conditions:
Please write in Japanese.
{sytle_prompt}

###Input:
æˆåŠŸã—ãŸå®Ÿä¾‹ã¯åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã™åŠ¹æžœãŒã‚ã‚ã†ã€‚
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã¨ã„ã†å®Ÿä¾‹ã‚’ã€å°åœ°åŸŸã§å®Ÿç¾ã—ãŸã„ã€‚
###Output:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚

###Input:
ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ‰ãˆã€ãã‚Œã‚’æ´»ç”¨ã—ãŸã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã‚’ãã®ã¾ã¾æŠ¼ã—ä»˜ã‘ã‚‹ã®ã¯ç–‘å•ã€‚
###Output:
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã®åž‹é€šã‚Šã®æŠ¼ã—ã¤ã‘ã§ãªãã€ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã¹ãã ã€‚

###Input:
æ£®æž—ãŒã©ã‚“ã©ã‚“å¤±ã‚ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
åœ°ã™ã¹ã‚ŠãŒé »ç™ºã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚
###Output:
è‡ªç„¶ç’°å¢ƒãŒã©ã‚“ã©ã‚“ç ´å£Šã•ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚

###Input:
å±±å²³åœ°åŸŸã®ç¤¾ä¼šã¯ç—…æ°—ã«ã‹ã‹ã£ã¦ã„ã‚‹ã®ã§ã€ãã®åŽŸå› ã‚’çªãæ­¢ã‚ã‚ˆã†ã€‚
ä¼çµ±çš„ãªæš®ã‚‰ã—æ–¹ã‚’ã€ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ãã†ã€‚
ã¾ãšç¾åœ°ã®è‡ªç„¶ãƒ»æ–‡åŒ–ãƒ»äººé–“ã‹ã‚‰ã§ãã‚‹ã ã‘å­¦ã¶ã“ã¨ã ã€‚
###Output:
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚

###Input:
å¤–å›½äººã®ç§ã«ã‚‚ã§ãã‚‹ã“ã¨ã¯ã€æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰ã€å†…æ”¿ã«ã¯å¹²æ¸‰ã—ãŸããªã„ã€‚
###Output:
ç§ã¯å¤–å›½äººã ã‹ã‚‰å†…æ”¿å¹²æ¸‰ã¯å¥½ã¾ãšã€ãƒãƒ‘ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã§ãã‚‹ã“ã¨ã¯æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚

###Input:
å±±ä¸­ã®æ‘ã€…ãŒè‡ªåŠ›æ›´ç”Ÿã§æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’æ¿€åŠ±ã—ãŸã„ã€‚
æŠ€è¡“å”åŠ›ã®çµæžœã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
###Output:
å±±ä¸­ã®æ‘ã€…ã®è‡ªåŠ›æ›´ç”Ÿã«ã‚ˆã‚‹æ´»æ€§åŒ–ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚

### Input:
"""

        labeling2 = f"""
### Instructions:
Please summarize the items of groups in one concise sentence with a deeper meaning.

### Conditions:
Please write in Japanese.
{sytle_prompt}

###Input:
ãƒãƒ‘ãƒ¼ãƒ«å±±ä¸­ã«è»Šé“ã®ã¿ç™ºé”ã•ã›å€‹ã€…ã®æ‘ã®æ´»æ€§åŒ–ãŒãªã„ã¨ã€ç­‹è‚‰ã‚’å¿˜ã‚Œè¡€ç®¡ã®ã¿å¤ªã‚‰ã›ãŸã®ã¨åŒã˜ãã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã®åž‹é€šã‚Šã®æŠ¼ã—ã¤ã‘ã§ãªãã€ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã¹ãã ã€‚
###Output:
è¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã®åž‹é€šã‚ŠãªæŠ¼ã—ã¤ã‘ã§ãªãã€ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã‚‹ã®ã§ãªã‘ã‚Œã°ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚

###Input:
è¿‘ä»£åŒ–ã®ã‚‚ã¨ã§ã€éŽç–ŽåŒ–ã¯ä¼çµ±çš„ãªæ–‡åŒ–ã¨ç’°å¢ƒã®è§£ä½“ã¾ã§ã‚‚ãŸã‚‰ã—ã€éŽç–ŽéŽå¯†åŒ–ã¯é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
è‡ªç„¶ç’°å¢ƒãŒã©ã‚“ã©ã‚“ç ´å£Šã•ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«ã®äººå£ã¯æ€¥å¢—ã—ã¦ã„ã‚‹ãŒã€ã©ã†ã‚„ã£ã¦äººã€…ã¯é£Ÿã£ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ã€‚
###Output:
äººå£æ€¥å¢—ã‚’ä¼´ã†è¿‘ä»£åŒ–ã®ç›´æŽ¥é–“æŽ¥ã®å½±éŸ¿ä¸‹ã«ã€ç”Ÿæ´»å•é¡Œã‚’ã‚ãã‚‹å…¨ä½“çŠ¶æ³ã®å¤‰åŒ–ã§éŽç–ŽéŽå¯†åŒ–ãŒé€²ã¿ã€ã²ã„ã¦ã¯ä¼çµ±çš„ãªæ–‡åŒ–ãƒ»ç’°å¢ƒãŒè§£ä½“ã•ã‚Œã€é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚

###Input:
ä½æ°‘ã¨ä¸€ç·’ã«ãªã£ã¦æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
å±±å²³åœ°ã®æ‘ã€…ã«ã¯ã€ç´ æœ´ãªæ´»åŠ›ãŒã‚ã‚Šãã†ã ã€‚
###Output:
å±±åœ°ã®æ‘ã€…ãŒæŒã¤ã‚‰ã—ã„ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ã€ä½æ°‘ã¨ä¸€ä½“ã«ãªã‚Šåœ°åŸŸã®æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚

###Input:
ãƒãƒ‘ãƒ¼ãƒ«å±±æ‘ã®æ´»æ€§åŒ–ã«å½¹ç«‹ã¤è¿‘ä»£æ–‡æ˜Žã®éºç”£ã«ã¤ã„ã¦ã¯ã€ä½æ°‘ã‚ˆã‚Šç§ã®æ–¹ãŒè©³ã—ã„ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰å†…æ”¿å¹²æ¸‰ã¯å¥½ã¾ãšã€ãƒãƒ‘ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã§ãã‚‹ã“ã¨ã¯æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€åœ°ç†å­¦ãƒ»æ°‘æ—å­¦ã§ã®çµŒé¨“ã‚’æ´»ã‹ã™ã“ã¨ã ã€‚
###Output:
ç§ã«ã§ãã‚‹ã“ã¨ã¯è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’æ´»ç”¨ã—ã€ãã“ã§åŸ¹ã‚ã‚ŒãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚

###Input:
å±±ä¸­ã®æ‘ã€…ã®è‡ªåŠ›æ›´ç”Ÿã«ã‚ˆã‚‹æ´»æ€§åŒ–ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
ä½æ°‘ã®åŠ›ã§é»’å­—ã®äº‹æ¥­ã¨ã—ã¦ç¶­æŒã§ãã‚‹ã€æœ€ã‚‚åŠ¹æžœçš„ãªæŠ€è¡“å”åŠ›ã‹ã‚‰å§‹ã‚ãŸã„ã€‚
###Output:
å±±ä¸­ã®æ‘ã€…ãŒé»’å­—ã§è‡ªåŠ›æ›´ç”Ÿã§ãæ´»æ€§åŒ–ã™ã‚‹ã“ã¨ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’ã‚„ã‚Šã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚

### Input:
"""

        labeling3 = f"""
### Instructions:
Please summarize the items of groups in one concise sentence with a deeper meaning.

### Conditions:
Please write in Japanese.
{sytle_prompt}

###Input:
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã®åž‹é€šã‚ŠãªæŠ¼ã—ã¤ã‘ã§ãªãã€ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã‚‹ã®ã§ãªã‘ã‚Œã°ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
###Output:
ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’ç„¡è¦–ã—ã€çµŒæ¸ˆè‡³ä¸Šä¸»ç¾©ãã®ä»–ã®å¼Šå®³ã‚’æŒã£ãŸè¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã‚’åž‹é€šã‚ŠæŠ¼ã—ã¤ã‘ã‚‹ã®ã§ã¯ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’é™¤ã„ãŸæœ¬ç‰©ã®æŠ€è¡“å”åŠ›ã¯ã§ããªã„ã€‚

###Input:
å±±åœ°ã®æ‘ã€…ãŒæŒã¤ã‚‰ã—ã„ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ã€ä½æ°‘ã¨ä¸€ä½“ã«ãªã‚Šåœ°åŸŸã®æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚
###Output:
å®Ÿæ…‹æŠŠæ¡ã«ã‚ˆã‚‹å±±å²³åœ°ç”Ÿæ…‹ç³»ã®è¨ºæ–­ã¨ã€ä½æ°‘ã®ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ãŸç›¸äº’å‚ç”»ã¨ãŒã€äº’ã„ã«å¼·ã‚ã‚ã£ã¦ã“ãã€åœ°åŸŸã®æ´»æ€§åŒ–ã«é€šãšã‚‹æŠ€è¡“å”åŠ›ã«æˆåŠŸã—ã‚ˆã†ã€‚

###Input:
ç§ã«ã§ãã‚‹ã“ã¨ã¯è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’æ´»ç”¨ã—ã€ãã“ã§åŸ¹ã‚ã‚ŒãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
###Output:
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€å°è³‡æœ¬ã§è¶³ã‚Šã‚‹å¯¾è±¡ã‚’é¸ã³ã€è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’ç”Ÿã‹ã—ã€èº«ã«ã¤ã‘ãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚

###Input:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ä½æ°‘ã®ç”Ÿæ´»è‹¦ã‚’è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
å±±ä¸­ã®æ‘ã€…ãŒé»’å­—ã§è‡ªåŠ›æ›´ç”Ÿã§ãæ´»æ€§åŒ–ã™ã‚‹ã“ã¨ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’ã‚„ã‚Šã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
###Output:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ãã®æ‘ã€…ãŒé»’å­—ã®è‡ªåŠ›æ›´ç”Ÿã§ç”Ÿæ´»è‹¦ã‚’é™¤ãã€æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚

### Input:
"""
        
        symbol = """
### Instructions:
Paraphrase each group of sentences in a couple of words that can be understood instantaneously.

### Conditions:
Please write in Japanese.
Rephrase it with an adjective, verb or metaphor with creativity.

###Input:
ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’ç„¡è¦–ã—ã€çµŒæ¸ˆè‡³ä¸Šä¸»ç¾©ãã®ä»–ã®å¼Šå®³ã‚’æŒã£ãŸè¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã‚’åž‹é€šã‚ŠæŠ¼ã—ã¤ã‘ã‚‹ã®ã§ã¯ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’é™¤ã„ãŸæœ¬ç‰©ã®æŠ€è¡“å”åŠ›ã¯ã§ããªã„ã€‚
###Output:
ã‚¢ãƒ†ãƒãƒ¡ã¯å¤±æ•—

###Input:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚
###Output:
ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ

###Input:
äººå£æ€¥å¢—ã‚’ä¼´ã†è¿‘ä»£åŒ–ã®ç›´æŽ¥é–“æŽ¥ã®å½±éŸ¿ä¸‹ã«ã€ç”Ÿæ´»å•é¡Œã‚’ã‚ãã‚‹å…¨ä½“çŠ¶æ³ã®å¤‰åŒ–ã§éŽç–ŽéŽå¯†åŒ–ãŒé€²ã¿ã€ã²ã„ã¦ã¯ä¼çµ±çš„ãªæ–‡åŒ–ãƒ»ç’°å¢ƒãŒè§£ä½“ã•ã‚Œã€é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
###Output:
éŽç–ŽéŽå¯†

###Input:
å±±å²³åœ°åŸŸã‚’å›½éš›ç´›äº‰ã®æ¸©åºŠã«ã›ã¬ãŸã‚ã«ã¯ã€ä½æ°‘ã®ç¦ç¥‰å‘ä¸Šã“ãæœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
###Output:
å›½éš›ç´›äº‰ã®é˜²æ­¢

###Input:
å®Ÿæ…‹æŠŠæ¡ã«ã‚ˆã‚‹å±±å²³åœ°ç”Ÿæ…‹ç³»ã®è¨ºæ–­ã¨ã€ä½æ°‘ã®ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ãŸç›¸äº’å‚ç”»ã¨ãŒã€äº’ã„ã«å¼·ã‚ã‚ã£ã¦ã“ãã€åœ°åŸŸã®æ´»æ€§åŒ–ã«é€šãšã‚‹æŠ€è¡“å”åŠ›ã«æˆåŠŸã—ã‚ˆã†ã€‚
###Output:
å®Ÿæ…‹æŠŠæ¡ã¨å‚ç”»

###Input:
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€å°è³‡æœ¬ã§è¶³ã‚Šã‚‹å¯¾è±¡ã‚’é¸ã³ã€è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’ç”Ÿã‹ã—ã€èº«ã«ã¤ã‘ãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚
###Output:
å°ã•ãªãƒ¢ãƒ‡ãƒ«ã‚’ï¼

###Input:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ãã®æ‘ã€…ãŒé»’å­—ã®è‡ªåŠ›æ›´ç”Ÿã§ç”Ÿæ´»è‹¦ã‚’é™¤ãã€æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
###Output:
è‡ªç«‹ã‚’åŠ±ã¾ã™

### Input:
"""

    else:
        labeling1 = f"""
### Instructions:
Please summarize the items of groups in one concise sentence with a deeper meaning.

### Conditions:
Please write in Japanese.
{sytle_prompt}

###Input:
æˆåŠŸã—ãŸå®Ÿä¾‹ã¯åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã™åŠ¹æžœãŒã‚ã‚ã†ã€‚
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã¨ã„ã†å®Ÿä¾‹ã‚’ã€å°åœ°åŸŸã§å®Ÿç¾ã—ãŸã„ã€‚
###Output:
äººé‡Œé›¢ã‚ŒãŸå ´æ‰€ã§ã‚‚è‰¯ããªã‚‹æ–¹æ³•ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã‚’ã€å°ã•ã„åœ°åŸŸã§æˆåŠŸã•ã›ã¦ã€åŒã˜ã‚ˆã†ãªå ´æ‰€ã«ä½ã‚€ãŸãã•ã‚“ã®äººã‚’å…ƒæ°—ã¥ã‘ãŸã„ã€‚

###Input:
ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ‰ãˆã€ãã‚Œã‚’æ´»ç”¨ã—ãŸã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã‚’ãã®ã¾ã¾æŠ¼ã—ä»˜ã‘ã‚‹ã®ã¯ç–‘å•ã€‚
###Output:
æ–°ã—ã„æ™‚ä»£ã®ã‚„ã‚Šæ–¹ã‚’ãã®ã¾ã¾æŠ¼ã—ä»˜ã‘ã‚‹ã®ã§ã¯ãªãã€ãã®å ´æ‰€ãªã‚‰ã§ã¯ã®ç‰¹å¾´ã‚’ç”Ÿã‹ã™ã¹ãã€‚

###Input:
æ£®æž—ãŒã©ã‚“ã©ã‚“å¤±ã‚ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
åœ°ã™ã¹ã‚ŠãŒé »ç™ºã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚
###Output:
è‡ªç„¶ç’°å¢ƒãŒã©ã‚“ã©ã‚“ç ´å£Šã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã€‚

###Input:
å±±å²³åœ°åŸŸã®ç¤¾ä¼šã¯ç—…æ°—ã«ã‹ã‹ã£ã¦ã„ã‚‹ã®ã§ã€ãã®åŽŸå› ã‚’çªãæ­¢ã‚ã‚ˆã†ã€‚
ä¼çµ±çš„ãªæš®ã‚‰ã—æ–¹ã‚’ã€ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ãã†ã€‚
ã¾ãšç¾åœ°ã®è‡ªç„¶ãƒ»æ–‡åŒ–ãƒ»äººé–“ã‹ã‚‰ã§ãã‚‹ã ã‘å­¦ã¶ã“ã¨ã ã€‚
###Output:
ã¾ãšã¯ç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±ã§ã®ç”Ÿæ´»ã‚’ç”Ÿæ…‹ç³»ã®ãªã‹ã§ç†è§£ã—ã€ãã®ä»•çµ„ã¿ãŒã†ã¾ãã„ã‹ãªã„åŽŸå› ã‚’è¦‹ã¤ã‘å‡ºã™ã€‚

###Input:
å¤–å›½äººã®ç§ã«ã‚‚ã§ãã‚‹ã“ã¨ã¯ã€æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰ã€å†…æ”¿ã«ã¯å¹²æ¸‰ã—ãŸããªã„ã€‚
###Output:
ç§ã¯å¤–å›½äººãªã®ã§ã€ä»–ã®å›½ã®æ”¿æ²»ã«å£å‡ºã—ã™ã‚‹ã®ã¯æŽ§ãˆã¦ã€æŠ€è¡“æ”¯æ´ã§ãƒãƒ‘ãƒ¼ãƒ«ã‚’åŠ©ã‘ã‚‹ã€‚

###Input:
å±±ä¸­ã®æ‘ã€…ãŒè‡ªåŠ›æ›´ç”Ÿã§æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’æ¿€åŠ±ã—ãŸã„ã€‚
æŠ€è¡“å”åŠ›ã®çµæžœã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
###Output:
å±±ä¸­ã®æ‘ãŒè‡ªåˆ†ãŸã¡ã®åŠ›ã§å…ƒæ°—ã«ãªã‚Œã‚‹ã‚ˆã†ãªæŠ€è¡“æ”¯æ´ã‚’è¡Œã„ã€ä½æ°‘ãŸã¡ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚

### Input:
"""

        labeling2 = f"""
### Instructions:
Please summarize the items of groups in one concise sentence with a deeper meaning.

### Conditions:
Please write in Japanese.
{sytle_prompt}

###Input:
ãƒãƒ‘ãƒ¼ãƒ«å±±ä¸­ã«è»Šé“ã®ã¿ç™ºé”ã•ã›å€‹ã€…ã®æ‘ã®æ´»æ€§åŒ–ãŒãªã„ã¨ã€ç­‹è‚‰ã‚’å¿˜ã‚Œè¡€ç®¡ã®ã¿å¤ªã‚‰ã›ãŸã®ã¨åŒã˜ãã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
è¿‘ä»£æ–‡æ˜Žã®ã‚„ã‚Šæ–¹ã®åž‹é€šã‚Šã®æŠ¼ã—ã¤ã‘ã§ãªãã€ç¾åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã¹ãã ã€‚
###Output:
æ–°ã—ã„æ™‚ä»£ã®é–‹ç™ºã®ã‚„ã‚Šæ–¹ã‚’ãã®ã¾ã¾å¼·è¦ã™ã‚‹ã®ã§ã¯ãªãã€ãƒãƒ‘ãƒ¼ãƒ«ã®å±±å²³åœ°åŸŸã®ç‰¹åˆ¥ãªç‰¹å¾´ã‚’ç”Ÿã‹ã•ãªã„ã¨ã€éŽç–Žã®å•é¡Œã‚’æ‚ªåŒ–ã•ã›ã‚‹ã ã‘ã€‚

###Input:
è¿‘ä»£åŒ–ã®ã‚‚ã¨ã§ã€éŽç–ŽåŒ–ã¯ä¼çµ±çš„ãªæ–‡åŒ–ã¨ç’°å¢ƒã®è§£ä½“ã¾ã§ã‚‚ãŸã‚‰ã—ã€éŽç–ŽéŽå¯†åŒ–ã¯é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
è‡ªç„¶ç’°å¢ƒãŒã©ã‚“ã©ã‚“ç ´å£Šã•ã‚Œã¤ã¤ã‚ã‚‹ã‚‰ã—ã„ã€‚
ãƒãƒ‘ãƒ¼ãƒ«ã®äººå£ã¯æ€¥å¢—ã—ã¦ã„ã‚‹ãŒã€ã©ã†ã‚„ã£ã¦äººã€…ã¯é£Ÿã£ã¦ã„ã‘ã°è‰¯ã„ã®ã‹ã€‚
###Output:
äººå£æ€¥å¢—ã¨è¿‘ä»£åŒ–ã®å½±éŸ¿ã§ã€ç”Ÿæ´»ã‚’å·¡ã‚‹çŠ¶æ³ãŒå¤‰ã‚ã‚Šã€äººå£ãŒæ¸›ã‚‹å ´æ‰€ã¨å¢—ãˆã‚‹å ´æ‰€ãŒã§ãã€çµæžœã¨ã—ã¦ã€æ˜”ã‹ã‚‰ã®æ–‡åŒ–ã‚„è‡ªç„¶ãŒå£Šã‚Œå¤§ããªå•é¡Œã«ãªã£ã¦ã„ã‚‹ã€‚

###Input:
ä½æ°‘ã¨ä¸€ç·’ã«ãªã£ã¦æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
å±±å²³åœ°ã®æ‘ã€…ã«ã¯ã€ç´ æœ´ãªæ´»åŠ›ãŒã‚ã‚Šãã†ã ã€‚
###Output:
å±±ã®æ‘ã€…ãŒè‡ªç„¶ã«æŒã£ã¦ã„ã‚‹æ´»åŠ›ã‚’å¤§åˆ‡ã«ã€ä½æ°‘ãŸã¡ã¨ä¸€ç·’ã«ãªã£ã¦åœ°åŸŸã‚’å…ƒæ°—ã«ã™ã‚‹ã“ã¨ãŒæˆåŠŸã®å¤§äº‹ãªãƒã‚¤ãƒ³ãƒˆã€‚

###Input:
ãƒãƒ‘ãƒ¼ãƒ«å±±æ‘ã®æ´»æ€§åŒ–ã«å½¹ç«‹ã¤è¿‘ä»£æ–‡æ˜Žã®éºç”£ã«ã¤ã„ã¦ã¯ã€ä½æ°‘ã‚ˆã‚Šç§ã®æ–¹ãŒè©³ã—ã„ã€‚
ç§ã¯å¤–å›½äººã ã‹ã‚‰å†…æ”¿å¹²æ¸‰ã¯å¥½ã¾ãšã€ãƒãƒ‘ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã§ãã‚‹ã“ã¨ã¯æŠ€è¡“å”åŠ›ã§ã‚ã‚‹ã€‚
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€åœ°ç†å­¦ãƒ»æ°‘æ—å­¦ã§ã®çµŒé¨“ã‚’æ´»ã‹ã™ã“ã¨ã ã€‚
###Output:
ç§ãŒã§ãã‚‹ã®ã¯ã€è¿‘ä»£ã®è‰¯ã„é¢ã‚’ä½¿ã£ã¦ã€åœ°åŸŸã‚’ã‚ˆãç†è§£ã™ã‚‹å°‚é–€ã®çµŒé¨“ã‚’æ´»ã‹ã—ã€æ”¿æ²»ã«å£ã‚’å‡ºã•ãªã„ã‚ˆã†ã«ã—ãªãŒã‚‰æŠ€è¡“æ”¯æ´ã‚’ã™ã‚‹ã“ã¨ã€‚

###Input:
å±±ä¸­ã®æ‘ã€…ã®è‡ªåŠ›æ›´ç”Ÿã«ã‚ˆã‚‹æ´»æ€§åŒ–ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
ä½æ°‘ã®åŠ›ã§é»’å­—ã®äº‹æ¥­ã¨ã—ã¦ç¶­æŒã§ãã‚‹ã€æœ€ã‚‚åŠ¹æžœçš„ãªæŠ€è¡“å”åŠ›ã‹ã‚‰å§‹ã‚ãŸã„ã€‚
###Output:
å±±ã®ä¸­ã®æ‘ã€…ãŒè‡ªåˆ†ãŸã¡ã®åŠ›ã§ãŠé‡‘ã‚’ç¨¼ãŽã€å…ƒæ°—ã«ãªã‚Œã‚‹ã‚ˆã†ã«æ‰‹ä¼ã„ã€ãã®çµæžœã€ä½æ°‘ãŸã¡ãŒå¬‰ã—ãã†ã«ã™ã‚‹é¡”ã‚’è¦‹ãŸã„ã€‚

### Input:
"""

        labeling3 = f"""
### Instructions:
Please summarize the items of groups in one concise sentence with a deeper meaning.

### Conditions:
Please write in Japanese.
{sytle_prompt}

###Input:
è¿‘ä»£æ–‡æ˜Žã«ã¯ãƒãƒ‘ãƒ¼ãƒ«å±±æ°‘ã«ã¨ã£ã¦æœ‰å®³ãªé¢ã‚‚å¤šãã‚ã‚‹ã€‚
çµŒæ¸ˆçš„å‘ä¸Šã¯ç¦ç¥‰å‘ä¸Šã®å¿…è¦æ¡ä»¶ã ãŒååˆ†æ¡ä»¶ã§ã¯ãªã„ã€‚
è¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã®åž‹é€šã‚ŠãªæŠ¼ã—ã¤ã‘ã§ãªãã€ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’æ´»ç”¨ã™ã‚‹ã®ã§ãªã‘ã‚Œã°ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’ã‚‚ãŸã‚‰ã™ã®ã¿ã€‚
###Output:
ãƒãƒ‘ãƒ¼ãƒ«ã®å±±å²³åœ°åŸŸã®ç‰¹åˆ¥ãªæ€§è³ªã‚’ç„¡è¦–ã—ã¦ã€ãŸã ãŠé‡‘ãŒä¸€ç•ªå¤§äº‹ã¨ã„ã£ãŸæ‚ªå½±éŸ¿ã‚’æŒã¤è€ƒãˆæ–¹ãªã©ã€æ–°ã—ã„æ™‚ä»£ã®é–‹ç™ºæ–¹æ³•ã‚’ãã®ã¾ã¾æŠ¼ã—ä»˜ã‘ã‚‹ã®ã§ã¯ã€éŽç–ŽåŒ–å•é¡Œã«æœ¬å½“ã«å½¹ç«‹ã¤æŠ€è¡“æ”¯æ´ã¯ã§ããªã„ã€‚

###Input:
å±±åœ°ã®æ‘ã€…ãŒæŒã¤ã‚‰ã—ã„ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ã€ä½æ°‘ã¨ä¸€ä½“ã«ãªã‚Šåœ°åŸŸã®æ´»æ€§åŒ–ã‚’å›³ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã€‚
ã¾ãšç¾åœ°ã‹ã‚‰å­¦ã³ã€å±±å²³åœ°å¸¯ã§ã®æš®ã‚‰ã—æ–¹ã‚’ç”Ÿæ…‹ç³»ã¨ã—ã¦æ‰ãˆç›´ã—ã€ãã®ç”Ÿæ…‹ç³»ã®ç—…å› ã‚’ã¤ãã¨ã‚ã‚ˆã†ã€‚
###Output:
å±±ã®è‡ªç„¶çŠ¶æ…‹ã‚’ã—ã£ã‹ã‚Šç†è§£ã—ã€ä½ã‚“ã§ã„ã‚‹äººãŸã¡ã®è‡ªç„¶ãªæ´»åŠ›ã‚’å¤§åˆ‡ã«ã—ã¦ã€äº’ã„ã«åŠ©ã‘åˆã„ãªãŒã‚‰ä¸€ç·’ã«å–ã‚Šçµ„ã‚€ã“ã¨ãŒã€æŠ€è¡“æ”¯æ´ã§ãã®åœ°åŸŸã‚’ç››ã‚Šä¸Šã’ã‚‹ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆã ã€‚

###Input:
ç§ã«ã§ãã‚‹ã“ã¨ã¯è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’æ´»ç”¨ã—ã€ãã“ã§åŸ¹ã‚ã‚ŒãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚
æœ€åˆã‹ã‚‰å¤§ããªè³‡æœ¬æŠ•ä¸‹ã‚’ã™ã‚‹ã®ã¯ã€ç§ã®åŠ›ã§ã¯åŠã°ãªã„ã€‚
###Output:
ç§ãŒã§ãã‚‹ã“ã¨ã¯ã€å°‘ã—ã®è³‡æœ¬ã§ã§ãã‚‹ã“ã¨ã‚’é¸ã‚“ã§è¿‘ä»£ã®è‰¯ã„ã¨ã“ã‚ã‚’æ´»ç”¨ã—ã¤ã¤ã€åœ°åŸŸã®ã“ã¨ã‚’ã‚ˆãç†è§£ã™ã‚‹å°‚é–€ã®çŸ¥è­˜ã‚’ä½¿ã£ã¦ã€æ”¿æ²»ã«å£ã‚’å‡ºã•ãªã„ã‚ˆã†ã«ã—ãªãŒã‚‰æŠ€è¡“æ”¯æ´ã‚’ã™ã‚‹ã“ã¨ã ã€‚

###Input:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ä½æ°‘ã®ç”Ÿæ´»è‹¦ã‚’è¦‹ã‚‹ã«å¿ã³ãªã„ã€‚
å±±ä¸­ã®æ‘ã€…ãŒé»’å­—ã§è‡ªåŠ›æ›´ç”Ÿã§ãæ´»æ€§åŒ–ã™ã‚‹ã“ã¨ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’ã‚„ã‚Šã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
###Output:
ãƒ’ãƒžãƒ©ãƒ¤ã®åœŸåœ°ã¨ãã“ã«ä½ã‚€äººãŸã¡ãŒå¥½ããªã®ã§ã€ãã®æ‘ã€…ãŒè‡ªåˆ†ãŸã¡ã®åŠ›ã§ãŠé‡‘ã‚’ç¨¼ãŽã€ç”Ÿæ´»ã®è‹¦ã—ã•ã‚’ç„¡ãã™ã‚ˆã†æ‰‹ä¼ã£ã¦ã€ä½æ°‘ãŸã¡ãŒå¬‰ã—ãã†ãªé¡”ã‚’ã™ã‚‹ã®ã‚’è¦‹ãŸã„ã€‚

### Input:
"""

        symbol = f"""
### Instructions:
Paraphrase each group of sentences in a couple of words that can be understood instantaneously.

### Conditions:
Please write in Japanese.
Rephrase it with an adjective, verb or metaphor with creativity.
{sytle_prompt}

###Input:
ãƒãƒ‘ãƒ¼ãƒ«å±±åœ°ã®ç‹¬è‡ªãªåœ°åŸŸæ€§ã‚’ç„¡è¦–ã—ã€çµŒæ¸ˆè‡³ä¸Šä¸»ç¾©ãã®ä»–ã®å¼Šå®³ã‚’æŒã£ãŸè¿‘ä»£æ–‡æ˜Žã®é–‹ç™ºåŠ›ã‚’åž‹é€šã‚ŠæŠ¼ã—ã¤ã‘ã‚‹ã®ã§ã¯ã€éŽç–ŽåŒ–ã®å¼Šå®³ã‚’é™¤ã„ãŸæœ¬ç‰©ã®æŠ€è¡“å”åŠ›ã¯ã§ããªã„ã€‚
###Output:
ã‚¢ãƒ†ãƒãƒ¡ã¯ã†ã¾ãã„ã‹ãªã„

###Input:
åƒ»åœ°ã§ã‚‚æ´»æ€§åŒ–ã®é“ã¯ã‚ã‚‹ã“ã¨ã‚’å°åœ°åŸŸã§æˆåŠŸã•ã›ã€åŒã˜åƒ»åœ°ã®åºƒåŸŸã®äººã€…ã‚’åŠ±ã¾ã—ãŸã„ã€‚
###Output:
ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ

###Input:
äººå£æ€¥å¢—ã‚’ä¼´ã†è¿‘ä»£åŒ–ã®ç›´æŽ¥é–“æŽ¥ã®å½±éŸ¿ä¸‹ã«ã€ç”Ÿæ´»å•é¡Œã‚’ã‚ãã‚‹å…¨ä½“çŠ¶æ³ã®å¤‰åŒ–ã§éŽç–ŽéŽå¯†åŒ–ãŒé€²ã¿ã€ã²ã„ã¦ã¯ä¼çµ±çš„ãªæ–‡åŒ–ãƒ»ç’°å¢ƒãŒè§£ä½“ã•ã‚Œã€é‡å¤§å•é¡ŒåŒ–ã—ã¦ã„ã‚‹ã€‚
###Output:
äººå£ã®å¢—æ¸›

###Input:
å±±å²³åœ°åŸŸã‚’å›½éš›ç´›äº‰ã®æ¸©åºŠã«ã›ã¬ãŸã‚ã«ã¯ã€ä½æ°‘ã®ç¦ç¥‰å‘ä¸Šã“ãæœªç„¶ã®é˜²æ­¢ç­–ã§ã‚ã‚‹ã€‚
###Output:
ä¸–ç•Œã®ã‘ã‚“ã‹ã‚’æ­¢ã‚ã‚‹

###Input:
å®Ÿæ…‹æŠŠæ¡ã«ã‚ˆã‚‹å±±å²³åœ°ç”Ÿæ…‹ç³»ã®è¨ºæ–­ã¨ã€ä½æ°‘ã®ç´ æœ´ãªæ´»åŠ›ã‚’ä¿¡é ¼ã—ãŸç›¸äº’å‚ç”»ã¨ãŒã€äº’ã„ã«å¼·ã‚ã‚ã£ã¦ã“ãã€åœ°åŸŸã®æ´»æ€§åŒ–ã«é€šãšã‚‹æŠ€è¡“å”åŠ›ã«æˆåŠŸã—ã‚ˆã†ã€‚
###Output:
ã—ã£ã‹ã‚Šç†è§£ã—ã¦ã€å‚åŠ 

###Input:
ç§ã«ã§ãã‚‹ã“ã¨ã¯ã€å°è³‡æœ¬ã§è¶³ã‚Šã‚‹å¯¾è±¡ã‚’é¸ã³ã€è¿‘ä»£æ–‡æ˜Žã®éºç”£ã‚’ç”Ÿã‹ã—ã€èº«ã«ã¤ã‘ãŸåœ°åŸŸç†è§£ã«ã¤ã„ã¦ã®å°‚é–€å®¶çš„çµŒé¨“ã‚’ã‚‚ã¨ã«ã€å†…æ”¿å¹²æ¸‰ã«ãªã‚‰ã¬æŠ€è¡“å”åŠ›ã‚’è¡Œã†ã“ã¨ã€‚
###Output:
å°ã•ãªãŠæ‰‹æœ¬ã‚’ï¼

###Input:
ãƒ’ãƒžãƒ©ãƒ¤å±±ä¸­ã®åœŸåœ°ã¨äººã¨ãŒå¥½ããªã®ã§ã€ãã®æ‘ã€…ãŒé»’å­—ã®è‡ªåŠ›æ›´ç”Ÿã§ç”Ÿæ´»è‹¦ã‚’é™¤ãã€æ´»æ€§åŒ–ã™ã‚‹ã®ã‚’åŠ±ã¾ã™ã‚ˆã†ãªæŠ€è¡“å”åŠ›ã‚’è¡Œã„ã€ä½æ°‘ã®å–œã¶é¡”ã‚’è¦‹ãŸã„ã€‚
###Output:
è‡ªç«‹ã‚’å¿œæ´ã™ã‚‹

### Input:
"""

    if number_of_items >= 20:
        prompt_ptrn = labeling1
    elif 13 <= number_of_items < 20:
        prompt_ptrn = labeling2
    elif 0 < number_of_items < 13:
        prompt_ptrn = labeling3
    else:
        prompt_ptrn = symbol
    return prompt_ptrn

# embeddings ã¸å¤‰æ›
def to_emb(model, text, prefix="query: "):
    return model.encode([prefix + text], normalize_embeddings=True)

def set_state(i):
    st.session_state.stage = i

def init_page():
    st.set_page_config(
        page_title="KJ-GPT",
        page_icon="ðŸ•µï¸â€â™‚ï¸"
    )
    st.header("KJ-GPT ðŸ•µï¸â€â™‚ï¸")
    st.sidebar.title("ã‚ªãƒ—ã‚·ãƒ§ãƒ³")

def init_messages():
    clear_button = st.sidebar.button("å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆ", key="clear", on_click=set_state, args=[0])
    if clear_button or "messages" not in st.session_state:

        st.session_state.messages = [
            SystemMessage(content="")
        ]

        # st.session_state.messages = [
        #     SystemMessage(content=labeling4)
        # ]

        # st.session_state.messages = [
        #     SystemMessage(content=symbol)
        # ]

        st.session_state.costs = []

        # st.session_state["openai_api_key"] = ""

        st.session_state["miro_api_key"] = ""

        st.session_state["model_name"] = ""

        st.session_state["user_input_random"] = ""

        st.session_state["labeling_pair"] = ""

        st.session_state["edited_labeling_pair"] = []

        st.session_state["saved_content"] = []

        st.session_state["grouping_table"] = []

        st.session_state["grouped_tables"] = []

        st.session_state["no_grouped_table"] = []

        st.session_state["number_of_items"] = ""

        st.session_state["labeling_table"] = []

        st.session_state["working_markdown_text"] = ""

        st.session_state["markdown_text"] = ""

        st.session_state["user_theme"] = ""

        st.session_state["translated_theme"] = ""

        st.session_state["summarized_data"] = ""

def select_model(openai_api_key):
    model = st.sidebar.radio("ãƒ¢ãƒ‡ãƒ«:", ("GPT-3.5-16k", "GPT-4-Turbo", "GPT-4o"),index=2)
    if model == "GPT-3.5-16k":
        model_name = "gpt-3.5-turbo-16k-0613"
    elif model == "GPT-4-Turbo":
        model_name = "gpt-4-1106-preview"
    else:
        model_name = "gpt-4o-2024-05-13"
    st.session_state["model_name"] = model_name
    
    # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’è¿½åŠ ã—ã€temperatureã‚’0ã‹ã‚‰1ã¾ã§ã®ç¯„å›²ã§é¸æŠžå¯èƒ½ã«ã™ã‚‹
    # åˆæœŸå€¤ã¯0.0ã€åˆ»ã¿å¹…ã¯0.1ã¨ã™ã‚‹
    # temperature = st.sidebar.slider("Temperature:", min_value=0.0, max_value=1.0, value=0.7, step=0.01)
    temperature = 0.7
    
    return ChatOpenAI(openai_api_key=openai_api_key, temperature=temperature, model_name=model_name)

def get_answer(llm, messages):
    with get_openai_callback() as cb:
        answer = llm(messages)
    return answer.content, cb.total_cost

def count_newlines(text):
    # æ”¹è¡Œæ–‡å­—ã‚’å«ã‚€æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©
    pattern = r"\r\n|\n|\r"
    # ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒžãƒƒãƒã™ã‚‹éƒ¨åˆ†ã‚’æŠ½å‡ºã—ã€ãã®æ•°ã‚’è¿”ã™
    return len(re.findall(pattern, text))

def split_lines_to_list(data):
    lines = data.strip().split("\n")
    return lines

def get_list(data):
    # ãƒ‡ãƒ¼ã‚¿ã‚’è¡Œã”ã¨ã«åˆ†å‰²
    lines = data.strip().split("\n")
    # å„è¦ç´ ã‹ã‚‰ "- " ã‚’å‰Šé™¤
    lines = [item.lstrip('- ') for item in lines]
    # å„è¦ç´ ã‹ã‚‰ å†’é ­ã®æ•°å­— ã‚’å‰Šé™¤
    lines = [re.sub(r'^\d+\.\s*', '', item) for item in lines]

    result = []
    temp = []

    for line in lines:
        # â€ã‚°ãƒ«ãƒ¼ãƒ—â€ã‚‚ã—ãã¯"å˜ç‹¬"ã¾ãŸã¯"å˜å“"ã®è¡Œã®å ´åˆã€tempã‚’ãƒªã‚»ãƒƒãƒˆ
        if "ã‚°ãƒ«ãƒ¼ãƒ—" in line or "å˜ç‹¬" in line or "å˜å“" in line:
            if temp:
                if len(temp) == 1:
                    result.append(temp[0])
                else:
                    result.append(temp)
                temp = []
        # è¡Œã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã®ã¿è¿½åŠ 
        elif line:
            temp.append(line)
    # æœ€å¾Œã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
    if temp:
        if len(temp) == 1:
            result.append(temp[0])
        else:
            result.append(temp)
    # ""ã®ç©ºç™½è¦ç´ ã‚’å‰Šé™¤
    result = [item for item in result if item != ""]
    
    return result

def parse_dict_from_string(string):
    """æ–‡å­—åˆ—ã‹ã‚‰è¾žæ›¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹é–¢æ•°"""
    try:
        # æ–‡å­—åˆ—ãŒè¾žæ›¸å½¢å¼ãªã‚‰è¾žæ›¸ã«å¤‰æ›
        if string.startswith("{") and string.endswith("}"):
            return ast.literal_eval(string)
        else:
            # è¾žæ›¸å½¢å¼ã§ãªã„å ´åˆã¯ãã®ã¾ã¾è¿”ã™
            return string
    except ValueError as e:
        # print(f"Error converting string to dictionary: {e}")
        return string  # å¤‰æ›ã«å¤±æ•—ã—ãŸå ´åˆã‚‚å…ƒã®æ–‡å­—åˆ—ã‚’è¿”ã™

def add_markdown_entry(level, text):
    """ä¸Žãˆã‚‰ã‚ŒãŸãƒ¬ãƒ™ãƒ«ã«åŸºã¥ã„ã¦ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹é–¢æ•°"""
    return f"{'#' * level} {text}\n"

def find_sub_items(key, level, dict_items):
    """ã‚µãƒ–ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŽ¢ã—ã€ãã®è¦‹å‡ºã—ã‚’ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§è¿”ã™é–¢æ•°"""
    markdown = ""
    for dict_item in dict_items:
        if isinstance(dict_item, dict) and key in dict_item:
            for sub_item in dict_item[key]:
                if sub_item:  # ç©ºã®æ–‡å­—åˆ—ã§ãªã„å ´åˆã«ã‚µãƒ–è¦‹å‡ºã—ã‚’è¿½åŠ 
                    markdown += add_markdown_entry(level, sub_item)
                    # å†å¸°çš„ã«ä¸‹ã®ãƒ¬ãƒ™ãƒ«ã®é …ç›®ã‚’æŽ¢ã™
                    if level < 6:  # 6æ¬¡è¦‹å‡ºã—ã¾ã§ç¶šã‘ã‚‹
                        markdown += find_sub_items(sub_item, level + 1, dict_items)
    return markdown

def headline_to_list(markdown_text):
    """ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã•ã‚ŒãŸè¦‹å‡ºã—ã‚’ãƒªã‚¹ãƒˆç®‡æ¡æ›¸ãå½¢å¼ã«å¤‰æ›ã—ã¦è¿”ã™é–¢æ•°"""

    # ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã«åˆ†å‰²ã—ã¾ã™ã€‚
    lines = markdown_text.strip().split("\n")
    
    # å¤‰æ›ã•ã‚ŒãŸãƒªã‚¹ãƒˆã‚’ä¿æŒã™ã‚‹ãŸã‚ã®ãƒªã‚¹ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
    converted_list = []

    # å„è¡Œã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦å‡¦ç†ã—ã¾ã™ã€‚
    for line in lines:

        if "**" in line:
            converted_list.append("\n" + line + "\n")

        else:
            # è¦‹å‡ºã—ã®ãƒ¬ãƒ™ãƒ«ã‚’æ±ºå®šã—ã¾ã™ï¼ˆ#ã®æ•°ã§æ±ºã¾ã‚Šã¾ã™ï¼‰ã€‚
            level = line.count("#")
            
            # è¦‹å‡ºã—ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã—ã¾ã™ã€‚
            text = line.replace("#", "").strip()
            
            # ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æ±ºå®šã—ã¾ã™ã€‚
            # ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã¯è¦‹å‡ºã—ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦å¢—ã‚„ã—ã¾ã™ã€‚
            indent = '    ' * (level - 1)
            
            # å¤‰æ›ã•ã‚ŒãŸãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¾ã™ã€‚
            converted_list.append(f"{indent}- {text}")

    # ãƒªã‚¹ãƒˆå½¢å¼ã«å¤‰æ›ã•ã‚ŒãŸãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’çµåˆã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚
    converted_markdown = "\n".join(converted_list)

    return converted_markdown

def segmented_by_three(markdown_input):
    """ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã•ã‚ŒãŸè¦‹å‡ºã—ã‚’3è¡Œã”ã¨ã«åˆ†å‰²ã—ã¦è¿”ã™é–¢æ•°"""
    # ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã«åˆ†å‰²ã—ã¾ã™ã€‚
    lines = markdown_input.strip().split("\n")

    # 3è¡Œã”ã¨ã«åŒºåˆ‡ã£ã¦ãƒªã‚¹ãƒˆåŒ–ã—ã¾ã™ã€‚
    segmented_markdown = []
    for i in range(0, len(lines), 3):
        segment = lines[i:i + 3]
        segmented_markdown.append("\n".join(segment))

    return segmented_markdown

def split_sections(text):
    """æ®µè½ã”ã¨ã«åˆ†å‰²ã—ã¦è¿”ã™é–¢æ•°"""
    # å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®ãƒªã‚¹ãƒˆ
    sections = []
    # ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®å¤‰æ•°
    current_section = []
    
    # ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã”ã¨ã«åˆ†å‰²ã—ã¦å‡¦ç†
    for line in text.strip().split("\n"):
        # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ¤œå‡ºã—ãŸå ´åˆã€
        # ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹
        if line.startswith("**"):
            if current_section:
                sections.append("\n".join(current_section))
                current_section = []
        current_section.append(line)
    
    # æœ€å¾Œã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
    if current_section:
        sections.append("\n".join(current_section))
    
    return sections

def split_by_hashes(text):
    """#ã®ä¸Šä½ä¸‹ä½ã”ã¨ã«ã‚»ãƒƒãƒˆã«ã—ã¦è¾žæ›¸åž‹ãƒªã‚¹ãƒˆã‚’è¿”ã™é–¢æ•°ï¼ˆBasic Data for Abductionï¼‰"""
    # "#" ã§å§‹ã¾ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
    pattern_hashes = [r"(^" + "#"*i + " [^\n]*(?:\n(?!#).*)*)" for i in range(1, 7)]

    # ãƒžãƒƒãƒãƒ³ã‚°çµæžœã‚’ãƒªã‚¹ãƒˆã«æ ¼ç´
    matches_hashes = [re.findall(p, text, re.MULTILINE) for p in pattern_hashes]

    # '**' ã§æŒŸã¾ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ "(æ•°å­—)" ã‚’é™¤å¤–ã—ã¦æŠ½å‡ºã™ã‚‹æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
    pattern_bold_text_excluding_numbers = r"\*\*\(\d+\) (.+?)\*\*"

    # ãƒžãƒƒãƒãƒ³ã‚°çµæžœã‚’ãƒªã‚¹ãƒˆã«æ ¼ç´
    matches_bold_text_excluding_numbers = re.findall(pattern_bold_text_excluding_numbers, text)

    # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¾žæ›¸ã¨ã—ã¦é–¢é€£ä»˜ã‘ã‚‹
    related_sections = {}

    # ã‚‚ã—ä¸€ç•ªä¸Šä½ã®é …ç›®ã—ã‹ãªã„ä¸€åŒ¹ç‹¼ã®å ´åˆã¯ã€ãã®é …ç›®ã®ã¿è¾žæ›¸ã«å…¥ã‚Œã‚‹ã€‚
    if matches_hashes[1] == []:
        # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’keyã€ä¸€åŒ¹ç‹¼ã®ãƒ©ãƒ™ãƒ«ã‚’valueã¨ã—ã¦è¾žæ›¸ã«ç™»éŒ²
        symbol_mark = matches_bold_text_excluding_numbers[0]
        related_sections[symbol_mark] = matches_hashes[0]

    # å„ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«é–¢é€£ä»˜ã‘ã‚’è¡Œã†
    for level in range(len(matches_hashes) - 1, -1, -1):
        # matches_hashes[level]ã®è¦ç´ ã‚’å¾Œã‚ã‹ã‚‰ãƒ«ãƒ¼ãƒ—
        for section in reversed(matches_hashes[level]):
            # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹
            section_start_index = text.index(section)
            # ã“ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚ˆã‚Šå‰ã®ã™ã¹ã¦ã®ä¸Šä½ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
            for upper_level in range(level - 1, -1, -1):
                previous_sections = [s for s in matches_hashes[upper_level] if text.index(s) < section_start_index]
                # ã‚‚ã£ã¨ã‚‚è¿‘ã„ä¸Šä½ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠžã™ã‚‹
                if previous_sections:
                    nearest_section = previous_sections[-1]
                    # ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ¼ã¨ã—ã¦è¾žæ›¸ã«è¿½åŠ 
                    if nearest_section in related_sections:
                        related_sections[nearest_section].append(section.strip())
                    else:
                        related_sections[nearest_section] = [section.strip()]
                    break

    return related_sections

def split_by_hashes_chart(text):
    # ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã”ã¨ã«åˆ†å‰²
    lines = text.split('\n')
    lines = [item for item in lines if item != ""]
    numbers_of_lines = len(lines)

    # æ•´ç†ã•ã‚ŒãŸæ§‹é€ ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®è¾žæ›¸
    organized_structure = {}

    # numbers_of_lines ãŒ 2 ä»¥ä¸‹ã®å ´åˆã®ç‰¹åˆ¥ãªå‡¦ç†
    if numbers_of_lines <= 2:
        if lines:
            bold_section = lines[0].strip('*')
            header = lines[1] if len(lines) > 1 else None
            organized_structure[bold_section] = header if header else bold_section
        return organized_structure

    # ç¾åœ¨ã®ãƒœãƒ¼ãƒ«ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®å¤‰æ•°
    current_bold_section = None
    current_headers = [None] * 7  # 7ãƒ¬ãƒ™ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«å¯¾å¿œ

    # å„è¡Œã‚’ç¹°ã‚Šè¿”ã—å‡¦ç†
    for line in lines:
        # ãƒœãƒ¼ãƒ«ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒã‚§ãƒƒã‚¯
        if line.startswith('**') and line.endswith('**'):
            current_bold_section = line.strip('*')
            organized_structure[current_bold_section] = {}
            current_headers = [None] * 7  # ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
        elif current_bold_section:
            # ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤å®š
            header_level = line.count('#')
            if header_level > 0:
                current_headers[header_level - 1] = line
                for i in range(header_level, 7):
                    current_headers[i] = None

                for i in range(header_level - 2, -1, -1):
                    if current_headers[i]:
                        if current_headers[i] not in organized_structure[current_bold_section]:
                            organized_structure[current_bold_section][current_headers[i]] = []
                        organized_structure[current_bold_section][current_headers[i]].append(line)
                        break

    return organized_structure

def parse_markdown_with_bold(md_text):
    """ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è§£æžã—ã€ãƒ¬ãƒ™ãƒ«æ•°ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°"""
    lines = md_text.strip().split("\n")
    parsed_content = []

    for line in lines:
        # å¤ªå­—ã§æ›¸ã‹ã‚ŒãŸè¡Œã‚’è­˜åˆ¥ï¼ˆãƒ¬ãƒ™ãƒ«0ï¼‰
        if line.startswith("**") and line.endswith("**"):
            content = line.strip("* ").strip()
            parsed_content.append((0, content))
        # è¦‹å‡ºã—ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤å®š
        elif line.startswith("#"):
            level = line.count("#")
            content = line.strip("# ").strip()
            parsed_content.append((level, content))
    
    return parsed_content

def add_shape(api_key, board_id, level, text, x, y, shape_width, shape_height):
    url = f"https://api.miro.com/v2/boards/{board_id}/shapes"

    if level == 0:
        style = {
                "borderOpacity": "0",
                "fontSize": "90",
                "borderColor": "#000000"
            }
    elif level == 1:
        style = {
                "borderOpacity": "0",
                "fontSize": "64",
                "borderColor": "#000000"
            }

    elif level == 2:
        style = {
                "fontSize": "50",
                "fillColor": "#ffffff",
                "fillOpacity": "1",
                "borderColor": "#000000",
                "borderWidth": "14.0"
            }

    elif level == 3:
        style = {
                "fontSize": "40",
                "fillColor": "#ffffff",
                "fillOpacity": "1",
                "borderColor": "#000000",
                "borderWidth": "10.0"
            }
    elif level == 4:
        style = {
                "fontSize": "30",
                "fillColor": "#ffffff",
                "fillOpacity": "1",
                "borderColor": "#000000",
                "borderWidth": "6.0"
            }
    else:
        style = {
                "fontSize": "18",
                "borderColor": "#000000",
                "borderWidth": "2.0"
            }

    payload = {
        "data": {
            "content": text,
            "shape": "rectangle"
        },
        "style": style,
        "position": {
            "x": x,
            "y": y
        },
        "geometry": {
            "width": shape_width,
            "height": shape_height
        }
    }
    headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": f"Bearer {api_key}"
    }

    response = requests.post(url, json=payload, headers=headers)

def add_rounded_rectangle(api_key, board_id, x, y, width, height, level):
    url = f"https://api.miro.com/v2/boards/{board_id}/shapes"

    payload = {
        "data": {
            "shape": "round_rectangle"
        },
        "position": {
            "x": x,
            "y": y
        },
        "geometry": {
            "width": width,
            "height": height
        },
        "style": {
            "borderOpacity": "1",
            "borderColor": "#000000",
            "borderWidth": 10 / level,
        }
    }
    headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": f"Bearer {api_key}"
    }

    response = requests.post(url, json=payload, headers=headers)

    # print(response.text)
    # print(f"è§’ä¸¸å››è§’å½¢ã®ã‚·ã‚§ã‚¤ãƒ—ãŒä½ç½®({x}, {y})ã«å¹…{width}ã€é«˜ã•{height}ã§ä½œæˆã•ã‚Œã¾ã—ãŸ")


def add_shape_to_miro(api_key, board_id, text, x, y):
    url = f"https://api.miro.com/v2/boards/{board_id}/shapes"

    payload = {
        "data": {
            "content": text,
            "shape": "rectangle"
        },
        "position": {
            "x": x,
            "y": y
    }
    }
    headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": f"Bearer {api_key}"
    }

    response = requests.post(url, json=payload, headers=headers)

    # print(response.text)

def text_to_lines_list(input_text):
  """#ã§å§‹ã¾ã‚‹ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ç®‡æ¡æ›¸ãã‚’ã€è¡Œã”ã¨ã«åˆ†å‰²ã—ã¦ãƒªã‚¹ãƒˆåŒ–ã™ã‚‹é–¢æ•°"""
  # ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã«åˆ†å‰²
  lines = input_text.strip().split('\n')

  # å‡ºåŠ›ã‚’æ•´å½¢
  lines_output = []
  current_text = ""
  for line in lines:
      # æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹ã‚’æ¤œå‡º
      if line.startswith('#'):
          # ç¾åœ¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’é–‹å§‹
          if current_text:
              lines_output.append(current_text.strip())
              current_text = ""
      current_text += line + "\n"
  # æœ€å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
  if current_text:
      lines_output.append(current_text.strip())
  return lines_output

def list_to_BDA(list):
  """#ã§å§‹ã¾ã‚‹ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆã‚’ã€ã¤ã¥ã‘ãŸ2ã¤ã®éšŽå±¤ã”ã¨ã«BDAã¸å¤‰æ›ã™ã‚‹é–¢æ•°"""
  # æŒ‡å®šã•ã‚ŒãŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
  result = []
  current_section = None
  current_subsection = None
  current_subsubsection = None
  current_subsubsubsection = None
  current_subsubsubsubsection = None
  current_subsubsubsubsubsection = None

  # å‡¦ç†é–‹å§‹
  for text in list:
      if text.startswith("# "):  # éšŽå±¤1ã®è¦ç´ 
          if current_section is not None:
              result.append(current_section)
          current_section = {"title": text, "subsections": []}
          current_subsection = None
          current_subsubsection = None
          current_subsubsubsection = None
          current_subsubsubsubsection = None
          current_subsubsubsubsubsection = None
      elif text.startswith("## ") and current_section is not None:  # éšŽå±¤2ã®è¦ç´ 
          current_subsection = {"title": text, "subsubsections": []}
          current_section["subsections"].append(current_subsection)
          current_subsubsection = None
          current_subsubsubsection = None
          current_subsubsubsubsection = None
          current_subsubsubsubsubsection = None
      elif text.startswith("### ") and current_subsection is not None:  # éšŽå±¤3ã®è¦ç´ 
          current_subsubsection = {"title": text, "subsubsubsections": []}
          current_subsection["subsubsections"].append(current_subsubsection)
          current_subsubsubsection = None
          current_subsubsubsubsection = None
          current_subsubsubsubsubsection = None
      elif text.startswith("#### ") and current_subsubsection is not None:  # éšŽå±¤4ã®è¦ç´ 
          current_subsubsubsection = {"title": text, "subsubsubsubsections": []}
          current_subsubsection["subsubsubsections"].append(current_subsubsubsection)
          current_subsubsubsubsection = None
          current_subsubsubsubsubsection = None
      elif text.startswith("##### ") and current_subsubsubsection is not None:  # éšŽå±¤5ã®è¦ç´ 
          current_subsubsubsubsection = {"title": text, "subsubsubsubsubsections": []}
          current_subsubsubsection["subsubsubsubsections"].append(current_subsubsubsubsection)
          current_subsubsubsubsubsection = None
      elif text.startswith("###### ") and current_subsubsubsubsection is not None:  # éšŽå±¤6ã®è¦ç´ 
          current_subsubsubsubsubsection = {"title": text, "content": []}
          current_subsubsubsubsection["subsubsubsubsubsections"].append(current_subsubsubsubsubsection)

  # æœ€å¾Œã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆã‚‚ã—å­˜åœ¨ã™ã‚‹å ´åˆï¼‰
  if current_section is not None:
      result.append(current_section)

  # çµæžœã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
  output_list = []

  # ç¬¬1éšŽå±¤ç›®
  joined_text_list = []
  joined_text=""

  for section in result:
    joined_text_list.append(section["title"])
    if current_subsection:
      for subsection in section["subsections"]:
          joined_text_list.append(subsection["title"])
    joined_text = "\n".join(joined_text_list)
    output_list.append(joined_text)
    joined_text_list = []

  # ç¬¬2éšŽå±¤ç›®
  joined_text_list = []
  joined_text=""

  for subsection in section["subsections"]:
    joined_text_list.append(subsection['title'])
    if current_subsubsection:
      for subsubsection in subsection["subsubsections"]:
          joined_text_list.append(subsubsection["title"])
          joined_text = "\n".join(joined_text_list)
    output_list.append(joined_text)
    joined_text_list = []

  # ç¬¬3éšŽå±¤ç›®
  joined_text_list = []
  joined_text=""

  if current_subsection:
    for subsubsection in subsection["subsubsections"]:
      joined_text_list.append(subsubsection['title'])
      if current_subsubsubsection:
        for subsubsubsection in subsubsection["subsubsubsections"]:
          joined_text_list.append(subsubsubsection["title"])
          joined_text = "\n".join(joined_text_list)
      output_list.append(joined_text)
      joined_text_list = []

  # ç¬¬4éšŽå±¤ç›®
  joined_text_list = []
  joined_text=""

  if current_subsubsubsection:
    for subsubsubsection in subsubsection["subsubsubsections"]:
      joined_text_list.append(subsubsubsection['title'])
      if current_subsubsubsubsection:
        for subsubsubsubsection in subsubsubsection["subsubsubsubsections"]:
          joined_text_list.append(subsubsubsubsection["title"])
          joined_text = "\n".join(joined_text_list)
      output_list.append(joined_text)
      joined_text_list = []

  # ãƒªã‚¹ãƒˆå†…ã®ç©ºè¦ç´ ã‚’å‰Šé™¤
  output_list_cleaned = [a for a in output_list if a != ""]
  return output_list_cleaned

def sentence_generating(llm,group,translated_theme,summarized_list,openai_api_key,style):
    combined_list = []
    # simplified_list = []
    # summarized_list = []

    if summarized_list:
        last_answer = st.session_state.messages[-1].content
    else:
        last_answer = ""
    
    if last_answer:
        last_answer_summarized = summarize(last_answer,openai_api_key,style)
    else:
        last_answer_summarized = ""

    if style == "formal":
        sentence = f"""
### Instructions:
{translated_theme}
Act as an introspective person who excels at looking deep into his or her own mind.
Make bulleted items into creative sentences by supplementing them with conjunctions.

### Condition:
Please write in Japanese.
Any additional explanations should be enclosed in parentheses.
Please unify the writing style in the Japanese standard form, like as "ã€œã " or "ã€œã§ã‚ã‚‹".

### Input:
ï¼ˆå­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãå¤§äººã®æ•™è‚²ã‚‚å¿…è¦ã ã¨æ€ã†ï¼‰
## ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§ã¯ãªãã€å°†æ¥ã®ç¤¾ä¼šã«æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã‚’ã—ãŸã„
### å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œ
### æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„

### Output:
ã¨ã«ã‹ãå®¿é¡ŒãŒå¤šã™ãŽã¦ã€è€ƒãˆã‚‹ä½™è£•ãŒãªãã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œã ã€‚ï¼ˆç­”ãˆã®ã‚ã‚‹å•é¡Œã‚’ãŸã å¼·åˆ¶çš„ã«è§£ç­”ã•ã›ã‚‰ã‚Œã‚‹ã®ã¯ç„¡é§„ã ã¨æ€ã†ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚„ChatGPTãªã©ãŒæ€¥é€Ÿã«ç™ºå±•ã—ã¦ã„ã‚‹ã®ã§ã€ãã†ã„ã£ãŸå˜ãªã‚‹æš—è¨˜ã‚„è«–ç†è¨ˆç®—ã¯ã€ãã®ã†ã¡äººé–“ãŒã‚„ã‚‹å¿…è¦ã¯ãªããªã‚‹ã¨æ€ã†ã€‚ãã‚Œãªã®ã«ã€ã“ã®ã¾ã¾åå·®å€¤è‡³ä¸Šä¸»ç¾©ã®è©°ã‚è¾¼ã¿æ•™è‚²ã§ä»Šå¾Œã‚‚ã‚„ã£ã¦ã„ããªã‚‰ã°ã€ä½•ã®å½¹ã«ã‚‚ç«‹ãŸãªã„å¤§äººã‚’è‚²ã¦ã‚‹ã“ã¨ã«ãªã‚‹ã ã‚ã†ã€‚ï¼‰ãã†ã§ã¯ãªãã¦ã€ã‚‚ã£ã¨æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ã«é›†ä¸­ã§ããŸã‚‰ã©ã‚“ãªã«è‰¯ã„ã ã‚ã†ã‹ã€‚ï¼ˆç­”ãˆã®ãªã„å•ã„ã«è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ç«‹ã¡å‘ã‹ã£ãŸã‚Šã€è‡ªåˆ†ã ã‘ã®ç‰¹åˆ¥ãªèˆˆå‘³é–¢å¿ƒã‚’è‚²ã¦ã¦å°‚é–€æ€§ã‚’é«˜ã‚ãŸã‚Šã™ã‚‹å‹‰å¼·ã®æ–¹ãŒä»Šå¾Œæ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã¯æ˜Žã‚‰ã‹ã ã€‚å¤§äººã‚‚è‡ªåˆ†ã®èˆˆå‘³é–¢å¿ƒã¨ã‚¹ã‚­ãƒ«ã‚’çµã³ã¤ã‘ã‚‹ã“ã¨ãŒä»•äº‹ã§æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã ã€‚ï¼‰ã¤ã¾ã‚Šã€ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã®ä½œæ¥­ã¯æ‡²ã‚Šæ‡²ã‚Šã§ã€å°†æ¥ã®ç¤¾ä¼šã®ã“ã¨ã‚’è€ƒãˆã¦ã‚‚ã£ã¨æœ‰æ„ç¾©ãªå­¦ã³ã‚’ã—ãŸã„ã¨ã„ã†ã“ã¨ã€‚

### Input:
ï¼ˆ{last_answer_summarized}ï¼‰
"""
    else:
        sentence = f"""
### Instructions:
{translated_theme}
Act as an introspective person who excels at looking deep into his or her own mind.
Make bulleted items into creative sentences by supplementing them with conjunctions.

### Condition:
Please write in Japanese.
Any additional explanations should be enclosed in parentheses.
Please write in a simple, easy-to-understand manner for junior high school students.

### Input:
# æœªæ¥ã«ã¨ã£ã¦æ„å‘³ã®ã‚ã‚‹æœ¬å½“ã®å­¦ã³ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãèª°ã«ã§ã‚‚é‡è¦ã 
## å­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãå¤§äººã®æ•™è‚²ã‚‚å¿…è¦ã ã¨æ€ã†
## ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§ã¯ãªãã€å°†æ¥ã®ç¤¾ä¼šã«æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã‚’ã—ãŸã„
### å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œ
### æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„

### Output:
å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œã ã€‚ï¼ˆç­”ãˆãŒã‚ã‹ã£ã¦ã‚‹å•é¡Œã‚’ã¨ã‘ã£ã¦è¨€ã‚ã‚Œã‚‹ã®ã€ãƒžã‚¸ãªã„ã¨æ€ã†ã€‚ãƒãƒƒãƒˆã¨ã‹ChatGPTã¨ã‹ä»Šã®æ™‚ä»£ã‚ã£ã¡ã‚ƒã‚ã‚‹ã—ã€‚ãã‚Œä½¿ãˆã°ä¸€çž¬ã ã‹ã‚‰ã€‚ãã‚“ãªã“ã¨ã‚ã–ã‚ã–äººé–“ãŒã‚„ã‚‹å¿…è¦ãªãã­ï¼Ÿã“ã®ã¾ã¾ã€Œåå·®å€¤ã€ã°ã£ã‹è¨€ã£ã¦è©°ã‚è¾¼ã¿ã¾ãã£ãŸã‚‰ã€å°†æ¥å½¹ã«ç«‹ãŸãªã„å¤§äººã«ãªã‚‹ã§ã—ã‚‡ã€‚ï¼‰
ã ã‹ã‚‰ã€ã‚‚ã£ã¨æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„ã€‚ï¼ˆç­”ãˆãŒæ±ºã¾ã£ã¦ãªã„å•é¡Œã‚’ã‚ã£ã¡ã‚ƒè€ƒãˆãŸã‚Šã€è‡ªåˆ†ã ã‘èˆˆå‘³ãŒã‚ã‚‹åˆ†é‡Žã‚’æŽ˜ã‚Šä¸‹ã’ãŸã‚Šã—ãŸæ–¹ãŒã‚ã£ã¡ã‚ƒæ¥½ã—ã„ã¨æ€ã†ã—ã€ãã‚ŒãŒã“ã‚Œã‹ã‚‰ã¯å¤§åˆ‡ã€‚ï¼‰ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§ã¯ãªãã€å°†æ¥ã®ç¤¾ä¼šã«æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã‚’ã—ãŸã„ã¨ã„ã†ã“ã¨ã€‚ãã—ã¦ãã®ãŸã‚ã«ã¯ã€å­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãå¤§äººã®æ•™è‚²ã‚‚å¿…è¦ã ã¨æ€ã†ã€‚
ï¼ˆã¦ã„ã†ã‹ã€å…ˆç”Ÿè‡ªä½“ãŒå¤ã„è©°ã‚è¾¼ã¿ã‚­ãƒ§ãƒ¼ã‚¤ã‚¯ã•ã‚Œã¦ãã¦ã‚‹ã‚“ã ã‹ã‚‰ã€ãã®æ„è­˜ã‚’å¤‰ãˆãªã„ã¨ãƒ€ãƒ¡ã§ã—ã‚‡ã€‚å…ˆç”ŸãŒè‡ªåˆ†ã§ã‚„ã£ã¦ãªã„ã®ã«ã€ç”Ÿå¾’ã«æŽ¢ç©¶å­¦ç¿’ã‚’ã—ã‚ã¨ã‹è¨€ã£ã¦ã‚‚éŸ¿ã‹ãªã„ã—ã€‚ã†ã‚“ã€‚ã†ã¡ã®è¦ªã‚‚ãã†ã˜ã‚ƒã‚“ã€‚å¤§å­¦è©¦é¨“ã®é¢æŽ¥ã«å¿…è¦ã ã‹ã‚‰ã£ã¦å¡¾ã®ã‚„ã£ã¦ã‚‹ä¼æ¥­ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã®ãƒãƒ©ã‚·æŒã£ã¦ãã‚‹ã‘ã©ã€è‡ªåˆ†ã¯ä»•äº‹ã§ä½•ã‹ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã—ã‚ˆã†ã¨ã—ã¦ã‚“ã®ã‹ãªã€‚æŽ¢ç©¶ã£ã¦ã„ã¤ã‚‚ã®ç”Ÿæ´»ã®ä¸­ã§è¦‹ã¤ã‘ã¦ã„ãã‚‚ã®ã˜ã‚ƒã‚“ã€‚å®¶ã§éŽã”ã™ã¨ãã«ãã†ã„ã£ãŸç’°å¢ƒã«ãªã„ã¨ã€ã„ãã‚‰å­¦æ ¡ã¨ã‹å¡¾ã§ã‚„ã£ã¦ã‚‚ãŠã‚“ãªã˜ã˜ã‚ƒã‚“ã€‚å…ˆç”Ÿã‚‚è¦ªã‚‚è‡ªåˆ†ãŸã¡ã§æŽ¢ç©¶å­¦ç¿’ã£ã¦ã®ã‚’ã‚„ã‚Œã°ã€ä»•äº‹ã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚‚ãƒŽãƒªã«ä¹—ã£ã¦ã„ã„æ„Ÿã˜ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿãã‚ŒãŒåˆ†ã‹ã£ã¦ã‹ã‚‰ã˜ã‚ƒãªã„ã¨ã€å­ã©ã‚‚ãŸã¡ã«ã‚‚æ•™ãˆã‚‹ã“ã¨ãŒã§ããªã„ã¨æ€ã†ã‘ã©â€¦ã€‚ï¼‰ä½•ãŒè¨€ã„ãŸã‹ã£ãŸã‹ã£ã¦ã„ã†ã¨ã€ã¤ã¾ã‚Šã€æœªæ¥ã«ã¨ã£ã¦æ„å‘³ã®ã‚ã‚‹æœ¬å½“ã®å­¦ã³ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãèª°ã«ã§ã‚‚é‡è¦ãªã‚“ã ã£ã¦ã“ã¨ã€‚

### Input:
ï¼ˆ{last_answer_summarized}ï¼‰
"""

    st.session_state.messages.append(SystemMessage(content=sentence))
    st.session_state.messages.append(HumanMessage(content=group))

    # #ã®ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’å‰Šé™¤ã—ãŸBDAã‚’ãƒªã‚¹ãƒˆã«ã—ã¦ç”»é¢ä¸Šã¸è¡¨ç¤º
    simplyfied_group = re.sub("\#+ ","",group)
    simplyfied_group_list = simplyfied_group.split()
    simplyfied_group_list[0] = "**" + str(simplyfied_group_list[0]) + "**"
    st.table(simplyfied_group_list)

    last_3_messages = st.session_state.messages[-3:]
    ai_messages = []
    for message in last_3_messages:
        if isinstance(message, AIMessage):
            ai_messages.append(message)
    last_messages = ai_messages + st.session_state.messages[-2:]
    with st.spinner("KJ-GPTãŒæ–‡ç« åŒ–ã—ã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, last_messages)
    combined_list.append(answer)
    st.session_state.messages.append(AIMessage(content=answer))
    st.session_state.costs.append(cost)

    # st.session_state.messages.append(SystemMessage(content=simplifying_sentence))
    # st.session_state.messages.append(HumanMessage(content=answer))
    # with st.spinner("KJ-GPTãŒæ–‡ç« åŒ–ã—ã¦ã„ã¾ã™ ..."):
    #     simplified_answer, cost = get_answer(llm, st.session_state.messages[-2:])
    # simplified_list.append(simplified_answer)
    # st.session_state.messages.append(AIMessage(content=simplified_answer))

    # st.session_state.messages.append(SystemMessage(content=summarized_sentence))
    # st.session_state.messages.append(HumanMessage(content=simplified_answer))
    # with st.spinner("KJ-GPTãŒæ–‡ç« åŒ–ã—ã¦ã„ã¾ã™ ..."):
    #     summarized_answer, cost = get_answer(llm, st.session_state.messages[-2:])
    # summarized_list.append(summarized_answer)
    # st.session_state.messages.append(AIMessage(content=summarized_answer))

    combined_sentences = "".join(combined_list)
    # simplified_sentences = "\n".join(simplified_list)
    # summarized_sentences = "\n".join(summarized_list)
    st.markdown(combined_sentences)
    if last_answer_summarized:
        return last_answer_summarized
    else:
        return answer
    # st.markdown(simplified_sentences)
    # st.markdown(summarized_sentences)
    # return combined_sentences, simplified_sentences

def sumarized_sentence_generating(llm,group,translated_theme,style):
    combined_list = []

    if style == "formal":
        sentence = f"""
### Instructions:
{translated_theme}
Act as an introspective person who excels at looking deep into his or her own mind.
Connect the following bullet points and write in a creative tone.

### Condition:
Please write in Japanese.
Please supplement the conjunctions so that the places separated by line breaks are logically connected.

### Input Example:
æ²–ç¸„ã®æš–ã‹ã•ã‚„ç¦å³¶ã®è‡ªç„¶ã¸ã®æ„›æƒ…ã¯ã€è‡ªåˆ†ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨çµã³ã¤ã„ã¦ã„ã‚‹ã€‚åœ°åŸŸã®ç‰¹è‰²ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨ã¯ã€æ–‡åŒ–ã‚„ä¼çµ±ã‚’å‘³ã‚ã†ã“ã¨ã«ã‚‚ç¹‹ãŒã‚‹ã€‚
åœ°åŸŸã®è‡ªç„¶ã¨ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’æ´»ã‹ã—ãŸã‚¹ã‚¤ãƒ¼ãƒ„ã§ç¦å³¶çœŒã‚’æ´»æ€§åŒ–ã—ã€åœ°åŸŸæ„›ã‚„ç’°å¢ƒã¸ã®é…æ…®ã€é£Ÿå“ãƒ­ã‚¹å‰Šæ¸›ã«è²¢çŒ®ã—ãŸã„ã¨æ€ã†ã€‚
ç„¡é§„ã®ãªã„ã€åœ°åŸŸã«æ ¹ä»˜ã„ãŸé£Ÿæ–‡åŒ–ã®é‡è¦æ€§ã‚’æ„Ÿã˜ã¦ãŠã‚Šã€ãã‚Œã‚’é€šã˜ã¦æŒç¶šå¯èƒ½ãªç¤¾ä¼šã¥ãã‚Šã«è²¢çŒ®ã—ãŸã„ã€‚ã¾ãŸã€åœ°åŸŸã®äº¤é€šã‚¤ãƒ³ãƒ•ãƒ©æ•´å‚™ã‚‚é‡è¦ãªèª²é¡Œã§ã‚ã‚‹ã¨è€ƒãˆã€è‹¥è€…ã¨ã—ã¦ç©æ¥µçš„ã«è­°è«–ã«å‚åŠ ã—ãŸã„ã€‚
éŽç–ŽåŒ–ã¨äº¤é€šå•é¡Œã‚’å…‹æœã—ã€ç¦å³¶ã®é£Ÿæ–‡åŒ–ã‚’æ´»ã‹ã—ãŸåœ°åŸŸæ´»æ€§åŒ–ã®ãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã¤ã“ã¨ãŒã€åœ°åŸŸã®äººã€…ã®å”åŠ›ã«ã‚ˆã‚ŠéŽç–ŽåŒ–ã‚’é£Ÿã„æ­¢ã‚ã€ã‚ˆã‚Šè‰¯ã„æœªæ¥ã‚’å‰µã‚‹éµã ã¨è€ƒãˆã¦ã„ã‚‹ã€‚
å½¼å¥³ã®æ­´å²ã¸ã®èˆˆå‘³ã‚’å…±æœ‰ã—ã€äº¬éƒ½ã§ã®åº§ç¦…ä½“é¨“ã‚„å¤ã„ç”ºä¸¦ã¿ã‚’é€šã—ã¦ã€ã‚ˆã‚Šæ·±ã„çµ†ã‚’è‚²ã‚€ã“ã¨ãŒé‡è¦ã ã¨è€ƒãˆã¦ã„ã‚‹ã€‚
æ­´å²ã‚„åœ°åŸŸæ–‡åŒ–ã«è§¦ã‚Œã‚‹ã“ã¨ã§ã€ç§ãŸã¡ã®ç”Ÿãæ–¹ã‚’è¦‹ã¤ã‚ç›´ã—ã€ã‚ˆã‚Šäººé–“ã‚‰ã—ã•ã«å›žå¸°ã—å…±ã«æˆé•·ã—ã¦ã„ãã“ã¨ãŒé‡è¦ã ã¨æ„Ÿã˜ã¦ã„ã‚‹ã€‚
ç§ã¯ç”Ÿã¾ã‚Œè‚²ã£ãŸåœ°åŸŸã¸ã®æ·±ã„æ„›æƒ…ã‚’æŒã£ã¦ãŠã‚Šã€åœ°å…ƒã®æ–‡åŒ–ã‚„ä¼çµ±ã€ç¥­ã‚Šã‚„è¡Œäº‹ã¸ã®å‚åŠ ã‚’é€šã˜ã¦å…±åŒä½“ã®ä¸€å“¡ã¨ã—ã¦ã®çµ†ã‚’æ„Ÿã˜ã‚‹ã€‚åœ°åŸŸæ„›ã¯ã€ç§ãŸã¡ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è‚²ã¿ã€æœªæ¥ã¸ç¹‹ã’ã¦ã„ãã¹ãä¾¡å€¤ã§ã‚ã‚‹ã€‚
iPadã‚’ä½¿ã£ãŸã‚¤ãƒ©ã‚¹ãƒˆã®æ‰èƒ½ã‚’æ´»ã‹ã—ã€åŽŸä½œã®é­…åŠ›ã‚’æãªã‚ãšã«æ„Ÿå‹•ã‚’ä¸Žãˆã‚‹ä½œå“ã‚’å‰µé€ ã—ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹ã€‚
åŽŸä½œã®æ„Ÿå‹•ã‚’ã‚¢ãƒ‹ãƒ¡ã§ã©ã†è¡¨ç¾ã™ã‚‹ã‹ã¯å¤§ããªèª²é¡Œã ãŒã€ãƒ‡ã‚¸ã‚¿ãƒ«ã®åˆ©ç‚¹ã‚’æ´»ã‹ã—å‰µé€ çš„ãªè©¦ã¿ã«ã‚ˆã‚Šæ–°ã—ã„é­…åŠ›ã‚’åŠ ãˆã€åŽŸä½œã¸ã®æ•¬æ„ã‚’ä¿ã¡ã¤ã¤æ„Ÿå‹•ã‚’å†å‰µé€ ã—ãŸã„ã€‚
ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠã¨ãƒ­ã‚·ã‚¢ã®æˆ¦äº‰è§£æ±ºã«ã¯ã€å›½éš›ç¤¾ä¼šå…¨ä½“ã®å¹³å’Œé¡˜æœ›ã‚’é‡ã‚“ã˜ã€å®Ÿè¡Œå¯èƒ½ãªå¯¾è©±ã¨è§£æ±ºç­–ã‚’æ¨¡ç´¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
æœªæ¥ã®ç¤¾ä¼šã«è²¢çŒ®ã™ã‚‹æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã¸ã®æ¸‡æœ›ã¯ã€å˜ãªã‚‹æ„Ÿæƒ…ã§ã¯ãªãã€å†…é¢ã‹ã‚‰ã®å¼·ã„æ¬²æ±‚ã ã€‚ç¾æ•™è‚²ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ç–‘å•ã¨å®¿é¡Œã®å¤šã•ã¸ã®ä¸æº€ã¯ã€æ•™è‚²ã®æœ¬è³ªã‚’è¦‹ç›´ã™å¿…è¦æ€§ã‚’ç¤ºå”†ã—ã¦ã„ã‚‹ã€‚
å­ã©ã‚‚ã‚‚å¤§äººã‚‚ã€å¹´é½¢ã«é–¢ã‚ã‚‰ãšã€å¸¸ã«æ–°ã—ã„ã“ã¨ã‚’å­¦ã³ç¶šã‘ã‚‹ã“ã¨ãŒå¿…è¦ã ã€‚
éšœç¢è€…ã‚‚å«ã‚ãŸã™ã¹ã¦ã®äººã€…ãŒã€ç¤¾ä¼šã«ãŠã„ã¦å°Šé‡ã•ã‚Œã€è‡ªã‚‰ã®èƒ½åŠ›ã‚’ç™ºæ®ã§ãã‚‹ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ã®é‡è¦æ€§ã‚’èªè­˜ã—ã€å…±ç”Ÿç¤¾ä¼šã‚’ç›®æŒ‡ã™ã¹ãã§ã‚ã‚‹ã€‚
å…±ç”Ÿç¤¾ä¼šã«ãŠã„ã¦ã¯ã€éšœå®³è€…ã‚’å«ã‚å…¨ã¦ã®äººãŒã€è‡ªå·±ã®èƒ½åŠ›ã‚’ç™ºæ®ã—å°Šé‡ã•ã‚Œã‚‹ç’°å¢ƒãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚ãã‚Œã«ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãæ„ç¾©ã‚ã‚‹å­¦ã³ãŒå¿…è¦ã§ã‚ã‚Šã€ãã‚ŒãŒå…±ç”Ÿç¤¾ä¼šã®æ§‹ç¯‰ã«ä¸å¯æ¬ ã§ã‚ã‚‹ã€‚
ã‚¹ãƒãƒ¼ãƒ„ã®ãƒ—ãƒ­ã¨ã‚¢ãƒžã¯ã€æŠ€è¡“åŠ›ã ã‘ã§ãªãã€çµŒæ¸ˆçš„å ±é…¬ã€ç²¾ç¥žåŠ›ã€å°‚é–€çŸ¥è­˜ã®é¢ã§ã‚‚ç•°ãªã‚‹ã€‚ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«ã‚‚ãã®å·®ãŒç¾ã‚Œã€ãƒ—ãƒ­ã¯æ´—ç·´ã•ã‚ŒãŸã‚‚ã®ã‚’ç”¨ã„ã€ã‚¢ãƒžã¯å®Ÿç”¨æ€§ã‚„ã‚³ã‚¹ãƒˆã‚’é‡è¦–ã™ã‚‹å‚¾å‘ã«ã‚ã‚‹ã€‚

### Output Example:
æ²–ç¸„ã®æš–ã‹ã•ã‚„ç¦å³¶ã®è‡ªç„¶ã¸ã®æ„›æƒ…ã¯ã€è‡ªåˆ†ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨æ·±ãçµã³ã¤ã„ã¦ãŠã‚Šã€åœ°åŸŸã®ç‰¹è‰²ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨ã¯æ–‡åŒ–ã‚„ä¼çµ±ã‚’å‘³ã‚ã†ã“ã¨ã¸ã¨ç¹‹ãŒã‚‹ã€‚ãã®ãŸã‚ã€åœ°åŸŸã®è‡ªç„¶ã¨ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’æ´»ã‹ã—ãŸã‚¹ã‚¤ãƒ¼ãƒ„ã§ç¦å³¶çœŒã‚’æ´»æ€§åŒ–ã™ã‚‹ã“ã¨ã‚„ã€åœ°åŸŸæ„›ã‚„ç’°å¢ƒã¸ã®é…æ…®ã€é£Ÿå“ãƒ­ã‚¹å‰Šæ¸›ãªã©ã«èˆˆå‘³ãŒã‚ã‚‹ã€‚ç„¡é§„ã®ãªã„ã€åœ°åŸŸã«æ ¹ä»˜ã„ãŸé£Ÿæ–‡åŒ–ã®é‡è¦æ€§ã‚’æ„Ÿã˜ã€æŒç¶šå¯èƒ½ãªç¤¾ä¼šã‚’å®Ÿç¾ã—ãŸã„ã¨è€ƒãˆã¦ãŠã‚Šã€ãã®ãŸã‚ã«ã¯åœ°åŸŸã®äº¤é€šã‚¤ãƒ³ãƒ•ãƒ©æ•´å‚™ã‚‚é‡è¦ãªèª²é¡Œã§ã‚ã‚‹ã€‚è‹¥è€…ã¨ã—ã¦ã€ã“ã‚Œã‚‰ã®è­°è«–ã«ç©æ¥µçš„ã«å‚åŠ ã—ãŸã„ã¨æ€ã†ã€‚\n
ã“ã®ã‚ˆã†ã«ã€éŽç–ŽåŒ–ã¨äº¤é€šå•é¡Œã‚’å…‹æœã—ã€ç¦å³¶ã®é£Ÿæ–‡åŒ–ã‚’æ´»ã‹ã—ãŸåœ°åŸŸæ´»æ€§åŒ–ã®ãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã¤ã“ã¨ã¯ã€åœ°åŸŸã®äººã€…ã¨å”åŠ›ã—éŽç–ŽåŒ–ã‚’é£Ÿã„æ­¢ã‚ã€ã‚ˆã‚Šè‰¯ã„æœªæ¥ã‚’å‰µã‚‹éµã ã¨ç¢ºä¿¡ã—ã¦ã„ã‚‹ã€‚ã¾ãŸã€å½¼å¥³ã®æ­´å²ã¸ã®èˆˆå‘³ã‚’å…±æœ‰ã—ã€äº¬éƒ½ã§ã®åº§ç¦…ä½“é¨“ã‚„å¤ã„ç”ºä¸¦ã¿ã‚’é€šã˜ã¦ã€ã‚ˆã‚Šæ·±ã„çµ†ã‚’è‚²ã‚€ã“ã¨ã‚‚é‡è¦ã ã¨è€ƒãˆã¦ã„ã‚‹ã€‚æ­´å²ã‚„åœ°åŸŸæ–‡åŒ–ã«è§¦ã‚Œã‚‹ã“ã¨ã¯ã€ç§ãŸã¡ã®ç”Ÿãæ–¹ã‚’è¦‹ã¤ã‚ç›´ã—ã€ã‚ˆã‚Šäººé–“ã‚‰ã—ã•ã«å›žå¸°ã—å…±ã«æˆé•·ã™ã‚‹æ©Ÿä¼šã‚’æä¾›ã™ã‚‹ã€‚ç§è‡ªèº«ã€ç”Ÿã¾ã‚Œè‚²ã£ãŸåœ°åŸŸã¸ã®æ·±ã„æ„›æƒ…ã‚’æŒã¡ã€åœ°å…ƒã®æ–‡åŒ–ã‚„ä¼çµ±ã€ç¥­ã‚Šã‚„è¡Œäº‹ã¸ã®å‚åŠ ã‚’é€šã˜ã¦å…±åŒä½“ã®ä¸€å“¡ã¨ã—ã¦ã®çµ†ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã€‚ã“ã®åœ°åŸŸæ„›ã¯ã€ç§ãŸã¡ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è‚²ã¿ã€æœªæ¥ã¸ç¹‹ã’ã¦ã„ãã¹ãä¾¡å€¤ã ã¨ç†è§£ã—ã¦ã„ã‚‹ã€‚\n
ã¾ãŸiPadã‚’ä½¿ã£ãŸã‚¤ãƒ©ã‚¹ãƒˆã®æ‰èƒ½ã‚’æ´»ã‹ã—ã€åŽŸä½œã®é­…åŠ›ã‚’æãªã‚ãšã«æ„Ÿå‹•ã‚’ä¸Žãˆã‚‹ä½œå“ã‚’å‰µé€ ã—ãŸã„ã¨ã®æ€ã„ã‚’æŒã£ã¦ã„ã‚‹ã€‚åŽŸä½œã®æ„Ÿå‹•ã‚’ã‚¢ãƒ‹ãƒ¡ã§ã©ã†è¡¨ç¾ã™ã‚‹ã‹ã¯å¤§ããªèª²é¡Œã§ã‚ã‚‹ãŒã€ãƒ‡ã‚¸ã‚¿ãƒ«ã®åˆ©ç‚¹ã‚’æ´»ã‹ã—å‰µé€ çš„ãªè©¦ã¿ã«ã‚ˆã‚Šæ–°ã—ã„é­…åŠ›ã‚’åŠ ãˆã€åŽŸä½œã¸ã®æ•¬æ„ã‚’ä¿ã¡ã¤ã¤æ„Ÿå‹•ã‚’å†å‰µé€ ã—ãŸã„ã€‚ãã‚ŒãŒä½•ã‚‰ã‹ã®å½¢ã§åœ°åŸŸæ„›ã®è‚²æˆã«ã¤ãªãŒã‚Œã°å¬‰ã—ã„ã€‚\n
å›½éš›ç¤¾ä¼šã«ç›®ã‚’å‘ã‘ã‚Œã°ã€ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠã¨ãƒ­ã‚·ã‚¢ã®æˆ¦äº‰è§£æ±ºã¯ã€å…¨ä½“ã®å¹³å’Œé¡˜æœ›ã‚’é‡ã‚“ã˜ã€å®Ÿè¡Œå¯èƒ½ãªå¯¾è©±ã¨è§£æ±ºç­–ã‚’æ¨¡ç´¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚æœªæ¥ã®ç¤¾ä¼šã«è²¢çŒ®ã™ã‚‹æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã¸ã®æ¸‡æœ›ã¯ã€å˜ãªã‚‹æ„Ÿæƒ…ã§ã¯ãªãã€å†…é¢ã‹ã‚‰ã®å¼·ã„æ¬²æ±‚ã§ã‚ã‚Šã€ç¾æ•™è‚²ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ç–‘å•ã¨å®¿é¡Œã®å¤šã•ã¸ã®ä¸æº€ã¯ã€æ•™è‚²ã®æœ¬è³ªã‚’è¦‹ç›´ã™å¿…è¦æ€§ã‚’ç¤ºå”†ã—ã¦ã„ã‚‹ã€‚å­ã©ã‚‚ã‚‚å¤§äººã‚‚ã€å¹´é½¢ã«é–¢ã‚ã‚‰ãšã€å¸¸ã«æ–°ã—ã„ã“ã¨ã‚’å­¦ã³ç¶šã‘ã‚‹ã“ã¨ãŒå¿…è¦ã§ã‚ã‚Šã€éšœå®³è€…ã‚‚å«ã‚ãŸã™ã¹ã¦ã®äººã€…ãŒç¤¾ä¼šã«ãŠã„ã¦å°Šé‡ã•ã‚Œã€èƒ½åŠ›ã‚’ç™ºæ®ã§ãã‚‹ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ã®é‡è¦æ€§ã‚’èªè­˜ã—ã¦ã„ã‚‹ã€‚ãã†ã—ãŸç¤¾ä¼šã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ã§ã€å¹³å’Œãªä¸–ç•Œã‚’å–ã‚Šæˆ»ã™ã“ã¨ãŒã§ãã‚‹ã¨è€ƒãˆã¦ã„ã‚‹ã€‚\n
å…±ç”Ÿç¤¾ä¼šã«ãŠã„ã¦ã¯ã€éšœå®³è€…ã‚’å«ã‚å…¨ã¦ã®äººãŒã€è‡ªå·±ã®èƒ½åŠ›ã‚’ç™ºæ®ã—å°Šé‡ã•ã‚Œã‚‹ç’°å¢ƒãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚ãã‚Œã«ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãæ„ç¾©ã‚ã‚‹å­¦ã³ãŒå¿…è¦ã§ã‚ã‚Šã€ãã‚ŒãŒå…±ç”Ÿç¤¾ä¼šã®æ§‹ç¯‰ã«ä¸å¯æ¬ ã§ã‚ã‚‹ã€‚ã‚¹ãƒãƒ¼ãƒ„ã®ä¸–ç•Œã§ã‚‚ã€ãƒ—ãƒ­ã¨ã‚¢ãƒžã®é•ã„ã¯æŠ€è¡“åŠ›ã ã‘ã§ã¯ãªãã€çµŒæ¸ˆçš„å ±é…¬ã€ç²¾ç¥žåŠ›ã€å°‚é–€çŸ¥è­˜ã®é¢ã§ã‚‚ç•°ãªã‚Šã€ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«ã‚‚ãã®å·®ãŒç¾ã‚Œã¦ã„ã‚‹ã€‚ãƒ—ãƒ­ã¯æ´—ç·´ã•ã‚ŒãŸã‚‚ã®ã‚’ç”¨ã„ã€ã‚¢ãƒžã¯å®Ÿç”¨æ€§ã‚„ã‚³ã‚¹ãƒˆã‚’é‡è¦–ã™ã‚‹å‚¾å‘ã«ã‚ã‚‹ã€‚\n
ã“ã‚Œã‚‰ã®è¦–ç‚¹ã‹ã‚‰ã€ç§ãŸã¡ã¯ç”Ÿæ´»ã®æ§˜ã€…ãªå´é¢ã«ãŠã„ã¦ã€å…±ç”Ÿç¤¾ä¼šã‚’ç›®æŒ‡ã—ã€ç‹¬è‡ªã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è‚²ã¿ã€åœ°åŸŸæ„›ã‚’å¤§äº‹ã«ã—ãªãŒã‚‰ã€æŒç¶šå¯èƒ½ãªæœªæ¥ã‚’å‰µé€ ã™ã‚‹ãŸã‚ã«åŠªåŠ›ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚‹ã€‚

### Input:
"""
    else:
        sentence = f"""
### Instructions:
{translated_theme}
Act as an introspective person who excels at looking deep into his or her own mind.
Connect the following bullet points and write in a creative tone.

### Condition:
Please write in Japanese.
Please supplement the conjunctions so that the places separated by line breaks are logically connected.
Please write in a simple, easy-to-understand manner for junior high school students.

### Input Example:
æ²–ç¸„ã¨ç¦å³¶ã®ãã‚Œãžã‚Œã®é­…åŠ›ã«å¿ƒæƒ¹ã‹ã‚Œã€åœ°å…ƒã®ç‰¹å¾´ã‚’æ´»ã‹ã—ãŸã‚¹ã‚¤ãƒ¼ãƒ„ã«ãƒ­ãƒžãƒ³ã‚’æ„Ÿã˜ã‚‹ã€‚
ç¦å³¶ã®è‡ªç„¶ã¨ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’æ´»ã‹ã—ãŸã”å½“åœ°ã‚¹ã‚¤ãƒ¼ãƒ„ã§åœ°åŸŸã‚’ç››ã‚Šä¸Šã’ã€æ–°é®®ã§ç‹¬ç‰¹ãªå‘³ã‚ã„ã‚’å…±æœ‰ã—ã€è¨ªã‚Œã‚‹äººã‚’å¢—ã‚„ã—ãŸã„ã€‚é£Ÿå“ãƒ­ã‚¹å‰Šæ¸›ã®æ–¹æ³•ã‚‚è€ƒãˆã€åœ°å…ƒã®è‰¯ã•ã‚’åºƒã‚ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚
åœ°åŸŸã®é£Ÿæã‚’æ´»ç”¨ã—é£Ÿå“ãƒ­ã‚¹ã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã€ç¦å³¶ã®é­…åŠ›ã‚’ä¼ãˆãŸã„ã€‚ã¾ãŸã€äº¤é€šæ‰‹æ®µãŒå¢—ãˆã‚Œã°ã€åœ°å…ƒã‚’ã‚‚ã£ã¨æ¥½ã—ã‚€ã“ã¨ãŒã§ãã‚‹ã€‚
éŽç–ŽåŒ–ã¨äº¤é€šå•é¡Œã‚’è§£æ±ºã—ã€é£Ÿã‚’é€šã˜ã¦ç¦å³¶ã®é­…åŠ›ã‚’ä¼ãˆã€åœ°åŸŸæ´»æ€§åŒ–ã‚’å›³ã‚ŠãŸã„ã€‚
å½¼å¥³ãŒæ­´å²ã‚’æ„›ã™ã‚‹ã‚†ãˆã«ã€äº¬éƒ½ã§ã®åº§ç¦…ä½“é¨“ã‚„å¤ã„ç”ºä¸¦ã¿ã‚’æ­©ãã“ã¨ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã‚‹ã€‚
æ²–ç¸„ã®è‡ªç„¶ã‚„æ–‡åŒ–ã‚’å¤§åˆ‡ã«ã—ãªãŒã‚‰ã€æ­´å²ã¸ã®æ„›ã¨åœ°åŸŸæ´»æ€§åŒ–ã¸ã®æƒ…ç†±ã‚’æŒã£ã¦ã€æ„›ã™ã‚‹äººã¨ã®çµ†ã‚’æ·±ã‚ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹ã€‚
iPadã§ã‚¤ãƒ©ã‚¹ãƒˆã‚’æãã“ã¨ã®è‡ªç”±ã•ã‚’æ„›ã—ã€å¿ƒã‚’å‹•ã‹ã™æ¼«ç”»ã«æ·±ã„æ€ã„å…¥ã‚Œã‚’æŒã¤ã€‚åŽŸä½œã®é­…åŠ›ã‚’å¤§åˆ‡ã«ã—ã€ã‚¢ãƒ‹ãƒ¡åŒ–ã™ã‚‹éš›ã‚‚ãã®ç²¾ç¥žã‚’ç¶­æŒã™ã¹ãã ã¨è€ƒãˆã‚‹ã€‚
ã‚¢ãƒ‹ãƒ¡åŒ–ã™ã‚‹éš›ã«ã¯åŽŸä½œã®é­…åŠ›ã‚’å°Šé‡ã—ã¤ã¤ã€ãƒ‡ã‚¸ã‚¿ãƒ«ã®åˆ©ç‚¹ã‚’æ´»ã‹ã—ãŸæ–°ã—ã„è¡¨ç¾ã‚’å–ã‚Šå…¥ã‚ŒãŸã„ã€‚
å¹³å’Œã‚’æœ›ã‚€å¿ƒã¯å…±é€šã—ã¦ã„ã‚‹ãŒã€ãã‚Œã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ãŸã é¡˜ã†ã ã‘ã§ãªãã€å…·ä½“çš„ãªè¡Œå‹•ãŒå¿…è¦ã ã€‚ãã‚ŒãŒæœªæ¥ã®ãŸã‚ã®æ„å‘³ã‚ã‚‹å­¦ã³ã«ç¹‹ãŒã‚‹ã€‚
å®¿é¡Œã«è¿½ã‚ã‚Œã‚‹ç¾çŠ¶ã«åç™ºã—ã€è‡ªåˆ†ã®å†…é¢ã‚’è¦‹ã¤ã‚ãªãŒã‚‰æœªæ¥ã«è²¢çŒ®ã™ã‚‹å­¦ã³ã‚’æ±‚ã‚ã¦ã„ã‚‹ã€‚
å­¦ã³ã¯ä¸€ç”Ÿæ¶¯ã«ã‚ãŸã‚‹å¤§åˆ‡ãªã‚‚ã®ã§ã€å­ã©ã‚‚ã ã‘ã§ãªãå¤§äººã«ã‚‚å¿…è¦ã ã€‚ç”Ÿãã‚‹åŠ›ã‚„å°†æ¥ã«å½¹ç«‹ã¤çŸ¥è­˜ã‚’æŒã¤ã“ã¨ãŒã€æœ¬è³ªçš„ãªæ•™è‚²ã®ç›®çš„ã ã¨æ„Ÿã˜ã‚‹ã€‚
éšœç¢è€…ã‚‚ç¤¾ä¼šã§æ´»èºã—ã€å¹³ç­‰ãªå ±é…¬ã‚’å¾—ã‚‹æ¨©åˆ©ãŒã‚ã‚‹ã€‚å…¨å“¡ãŒè‡ªèº«ã®å¯èƒ½æ€§ã‚’æœ€å¤§é™ã«ç™ºæ®ã—ã€æ•™è‚²ãŒãã®éµã§ã‚ã‚‹ã¨è€ƒãˆã‚‹ã€‚

### Output Example:
æ²–ç¸„ã¨ç¦å³¶ãŒå¥½ãã§ã€åœ°å…ƒã®åç”£ã‚’æ´»ã‹ã—ãŸã‚¹ã‚¤ãƒ¼ãƒ„ã«ãªã‚“ã¨ãªããƒ­ãƒžãƒ³ã‚’æ„Ÿã˜ã‚‹ã‚“ã ã‚ˆã­ã€‚ã ã‹ã‚‰ã€ç¦å³¶ã®è‡ªç„¶ã¨ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ã¤ã‹ã£ãŸã”å½“åœ°ã‚¹ã‚¤ãƒ¼ãƒ„ã§åœ°åŸŸã‚’ã‚‚ã‚Šã‚ã’ãŸã„ã€‚ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå‘³ã‚ã„ã§ã€è¦³å…‰å®¢ã‚‚åœ°å…ƒã®äººã‚‚ã‚ˆã‚ã“ã°ã›ãŸã„ã€‚åœ°å…ƒã§ç²ã‚ŒãŸã‚‚ã®ã‚’åœ°å…ƒã§é£Ÿã¹ã¦ã€é£Ÿå“ãƒ­ã‚¹ã‚’æ¸›ã‚‰ã™ã®ãŒå¤§äº‹ãªã‚“ã ã€‚ãã®æ™‚ã«äº¤é€šæ‰‹æ®µãŒå¢—ãˆã‚Œã°ã€ä½ã‚“ã§ã„ã‚‹ç”ºã®äººã‚‚ã‚‚ã£ã¨æ¥½ã—ã‚€ã“ã¨ãŒã§ãã‚‹ã€‚ã“ã®ã‚ˆã†ã«ã€éŽç–Žã¨äº¤é€šã®å•é¡Œã‚’ãªã‚“ã¨ã‹ã—ãªãŒã‚‰ã€é£Ÿã¹ã‚‚ã®ã§ç¦å³¶ã®é­…åŠ›ã‚’ä¼ãˆã¦ã€åœ°åŸŸã‚’ã«ãŽã‚„ã‹ã«ã§ãã‚Œã°ã„ã„ãªã€‚\n
ãã‚Œã«ã€æ­´å²ãŒå¥½ããªå½¼å¥³ã¨ä¸€ç·’ã«ã€äº¬éƒ½ã§åº§ç¦…ä½“é¨“ã‚’ã—ãŸã‚Šã€å¤ã„ç”ºä¸¦ã¿ã‚’æ­©ã„ãŸã‚Šã™ã‚‹ã®ãŒæ¥½ã—ã¿ã€‚ã“ã‚“ãªã“ã¨è¨€ã†ã®æ¥ãšã‹ã—ã„ã‘ã©ã€æ­´å²ã¨åœ°åŸŸã®æƒ…ç†±ã‚’ã„ã‹ã—ã¦ã€å½¼å¥³ã®ã“ã¨ã‚’ã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„ã‚“ã ã‚ˆã­ã€‚\n
ã‚ã¨ã€iPadã§ã‚¤ãƒ©ã‚¹ãƒˆã‚’æãã“ã¨ãŒå¥½ãã§ã€å¿ƒã‚’å‹•ã‹ã™æ¼«ç”»ã«ä»Šãƒãƒžã£ã¦ã„ã‚‹ã€‚ã‚¢ãƒ‹ãƒ¡åŒ–ã™ã‚‹æ™‚ã‚‚åŽŸä½œã®è‰¯ã•ã‚’ã¡ã‚ƒã‚“ã¨è¡¨ç¾ã—ãŸæ–¹ãŒã„ã„ã¨æ€ã†ã€‚ãã®ä¸Šã§ã€ãƒ‡ã‚¸ã‚¿ãƒ«ã®åˆ©ç‚¹ã‚’æ´»ã‹ã—ãŸæ–°ã—ã„è¡¨ç¾ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã¹ããªã‚“ã˜ã‚ƒãªã„ã‹ãªã€‚\n
æ„Ÿå‹•ã™ã‚‹ä½œå“ã¯ã¨ãã«å¹³å’Œãªä¸–ç•Œã«ã¤ãªãŒã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã€‚ãã†ã„ã£ãŸæˆ¦äº‰ã®ãªã„ä¸–ç•Œã‚’æœ›ã‚€å¿ƒã¯ã¿ã‚“ãªã¨åŒã˜ã ã‘ã©ã€å¤§åˆ‡ãªã®ã¯ãŸã é¡˜ã†ã ã‘ã˜ã‚ƒãªãã¦å…·ä½“çš„ãªè¡Œå‹•ã‚’ã™ã‚‹ã“ã¨ã€‚ãã‚ŒãŒæœªæ¥ã®ãŸã‚ã®æ„å‘³ã‚ã‚‹å­¦ã³ã«ã¤ãªãŒã£ã¦ã„ãã€‚ã§ã‚‚ã€ä»Šã®å®¿é¡Œã«è¿½ã‚ã‚Œã¦ã‚‹çŠ¶æ³ã«ã¯æ­£ç›´ã†ã‚“ã–ã‚Šã—ã¦ã„ã¦ã€ã‚‚ã£ã¨è‡ªåˆ†ã®å†…é¢ã‚’è¦‹ã¤ã‚ãªãŒã‚‰å°†æ¥ã«ã¤ãªãŒã‚‹å‹‰å¼·ãŒã—ãŸã„ã€‚å­¦ã³ã¯ä¸€ç”Ÿç¶šãå¤§åˆ‡ãªã‚‚ã®ã§ã€å­ã©ã‚‚ã ã‘ã§ãªãå¤§äººã«ã‚‚å¿…è¦ã ã‚‚ã®ã€‚ç”Ÿãã‚‹åŠ›ã‚„å°†æ¥ã«å½¹ç«‹ã¤çŸ¥è­˜ãŒã€æœ¬è³ªçš„ãªæ•™è‚²ã®ç›®çš„ã ã¨æ€ã†ã­ã€‚\n
ãã†ã™ã‚‹ã“ã¨ã§ã€éšœç¢è€…ã‚‚æ´»èºã§ãã¦å¹³ç­‰ãªå ±é…¬ã‚’å¾—ã‚‹ã‚ˆã†ãªã€ã—ã‚ã‚ã›ãªç¤¾ä¼šãŒå®Ÿç¾ã™ã‚‹ã¨æ€ã†ã€‚ã¿ã‚“ãªãŒè‡ªåˆ†ã®å¯èƒ½æ€§ã‚’æœ€å¤§é™ã«ç™ºæ®ã™ã‚‹ãŸã‚ã«ã¯ã€æ•™è‚²ãŒãã®åœŸå°ã«ãªã‚‹ã¨æ€ã†ã‚“ã ã€‚

### Input:
"""

    st.session_state.messages.append(SystemMessage(content=sentence))
    st.session_state.messages.append(HumanMessage(content=group))
    with st.spinner("KJ-GPTãŒæ–‡ç« åŒ–ã—ã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-2:])
    combined_list.append(answer)
    st.session_state.messages.append(AIMessage(content=answer))
    st.session_state.costs.append(cost)

    combined_sentences = "".join(combined_list)
    return combined_sentences

def related_sentence_generating(llm,contexts,wiki_text,translated_theme,wiki_extract):

    sentence = f"""
### Instructions:
{translated_theme}
You are a poet par excellence.
Write an abstract poem, referring to the Wikipedia content and summary text.

### Condition:
Please write in Japanese.
Explain the poem in a clear and simple way.
Please include plenty of line breaks in your poem to make it easier to read.

### Summary:
{contexts}

### Wikipedia:
{wiki_text}
"""

    # print("prompt:", sentence)

    st.session_state.messages.append(SystemMessage(content=sentence))
    with st.spinner("æ¤œç´¢ä¸­ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-1:])
    st.session_state.messages.append(AIMessage(content=answer))
    st.session_state.costs.append(cost)
    return answer

def related_gal_sentence_generating(llm,contexts,wiki_text,translated_theme,wiki_extract):

    sentence = f"""
### Instructions:
{translated_theme}
You are a Japanese gal attending a vocational school.
Read the text summarising the questioner's concerns and advise on the next steps to take, based on information from Wikipedia.

### Condition:
Please write in Japanese.
Use the same style of writing as in the examples.
Please include three or four of the following emojis in the text in any combination of two of the following emojis.
ðŸ™‡ðŸ» ðŸ’¦ â•ã€€ðŸ™ðŸ» ðŸ‘ðŸ» ðŸ’• âœ¨ ðŸ¤ ðŸ¹ ðŸ‘¼ðŸ» ðŸ’— ðŸŒ· ðŸ‘€ ðŸ’• ðŸš¶ðŸ» ðŸ’¨ ðŸ¤¦ðŸ»â€â™€ï¸ ðŸ’ž ðŸ¥º ðŸ¤­ ðŸ’¡ ðŸ’– ðŸ™ˆ ðŸ’¦ ðŸ˜½ âœŒðŸ» ðŸƒðŸ» âž° ðŸ˜¿ ðŸŒ€ â¤ï¸Ž â€¼ï¸ ðŸ‘ðŸ» ðŸ•ºðŸ» âœ¨ ðŸ‘©ðŸ»â€â¤ï¸â€ðŸ‘©ðŸ» ðŸ’ž

### Example:
ç›¸è«‡è€…ã•ã‚“ã¸ðŸŒ·
è³ªå•ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ðŸ¥º
ã‚ã£ã¡ã‚ƒã„ã„ã“ã¨è€ƒãˆã¦ã¦ãƒªã‚¹ãƒšã‚¯ãƒˆðŸ«¶ðŸ»
è¿”ä¿¡ãŠãã‚ŒãŸã‘ã©ã‚†ã‚‹ã—ã¦ãƒ
ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢ã¯åˆãƒŠãƒ¼ã‚¹ã¡ã‚ƒã‚“ã ã‚ˆðŸ–¤
ã¯ãšã‹ã—ãã¦å®¶ã§ä¸€çž¬ç€ãŸã ã‘(ï¼¾ï¼¾)
ç›¸è«‡è€…ã•ã‚“ã¯ãƒãƒ­ã‚¦ã‚£ãƒ³ã©ã£ã‹ã„ã£ãŸï¼Ÿï¼Ÿ

### Summary:
{contexts}

### Wikipedia:
{wiki_extract}
{wiki_text}
"""
    # print("prompt:", sentence)

    st.session_state.messages.append(SystemMessage(content=sentence))
    # st.session_state.messages.append(HumanMessage(content=group))
    with st.spinner("è¿”ä¿¡ã‚’å¾…ã£ã¦ã„ã¾ã™ ..."):
        answer, cost = get_answer(llm, st.session_state.messages[-1:])
    st.session_state.messages.append(AIMessage(content=answer))
    st.session_state.costs.append(cost)
    return answer

@st.cache_resource
def load_wiki():
    # wikipedia æ—¥æœ¬èªžãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ãƒ­ãƒ¼ãƒ‰
    wikija_dataset = load_dataset(
        path="singletongue/wikipedia-utils",
        name="passages-c400-jawiki-20230403",
        split="train",
    )
    # faiss index ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    dm = DownloadManager()
    index_local_path = dm.download(
        f"https://huggingface.co/datasets/hotchpotch/wikipedia-passages-jawiki-embeddings/resolve/main/faiss_indexes/passages-c400-jawiki-20230403/sup-simcse-ja-base/index_IVF2048_PQ192.faiss"
    )
    # faiss index ã®ãƒ­ãƒ¼ãƒ‰
    faiss_index = faiss.read_index(index_local_path)

    # embeddings ã¸å¤‰æ›ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰
    model = SentenceTransformer("cl-nagoya/sup-simcse-ja-base")
    model.max_seq_length = 512

    return wikija_dataset, faiss_index, model

def messages_init():
    st.session_state.messages = [
        SystemMessage(content=""),
        HumanMessage(content=""),
        AIMessage(content="")
    ]

if 'stage' not in st.session_state:
    st.session_state.stage = 0

def button_disable():
    # next_roundãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹
    st.session_state["disable_button"] = True

def main():
    init_page()
    init_messages()
    llm = ""
    group_list = ""
    answer = ""
    number_of_items = ""
    break_point = ""
    grouped_tables = []
    labeling_pair = []
    labeling_df = pd.DataFrame([{"è¡¨æœ­": ""}])
    labeled_data_df = pd.DataFrame([{"ä¸­èº«": ""}]).reset_index()
    edited_labels_list = []
    edited_labeling_pair = [] # ä¿®æ­£å¾Œã®è¡¨æœ­ã¨ãƒ©ãƒ™ãƒ«ã®è¾žæ›¸åž‹ãƒšã‚¢ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆ
    edited_labeling_pairs = []
    edited_labeling_pair_added_solos = [] # ä¿®æ­£å¾Œã®è¡¨æœ­ã¨ãƒ©ãƒ™ãƒ«ã®è¾žæ›¸åž‹ãƒšã‚¢ã€å˜ç‹¬ãƒ©ãƒ™ãƒ«ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆ

    style = select_style()

    if not OPENAI_API_KEY:
        # OpenAI API Keyã®å…¥åŠ›
        with st.form("my_api_key", clear_on_submit=True):
            openai_api_key = st.text_input("OpenAI API Key", type="password")
            api_key_button = st.form_submit_button(label="Enter")
        
            if api_key_button and openai_api_key:
                st.session_state["openai_api_key"] = openai_api_key
    else:
        openai_api_key = OPENAI_API_KEY
        st.session_state["openai_api_key"] = openai_api_key

    st.session_state["miro_api_key"] = MIRO_API_KEY
    
    if openai_api_key:
        llm = select_model(st.session_state["openai_api_key"])

    translated_theme = None

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ç›£è¦–
    theme_container = st.container()
    with theme_container:
        with st.form(key="my_theme", clear_on_submit=False):
            user_theme = st.text_area(label="ãƒ†ãƒ¼ãƒž: ", key="theme_input", height=50)
            st.text("ã«ã¤ã„ã¦")
            theme_button = st.form_submit_button(label="æ±ºå®š")
        if theme_button and user_theme:
            st.session_state["user_theme"] = user_theme
            translated_theme = theme_translate(user_theme,st.session_state["openai_api_key"])

    if 'user_input' not in st.session_state:
        st.session_state.user_input = ""

    if st.session_state.stage == 0:

        tab1, tab2 = st.tabs(["åˆã‚ã‹ã‚‰", "ç¶šãã‹ã‚‰"])

        with tab1:
            user_input = st.text_area(label="é …ç›®ãƒ©ãƒ™ãƒ«: ", key="input", height=300)

        with tab2:
            continueing = st.text_area(label="ç¶šãã‹ã‚‰: ", key="continueing", height=300)

        grouping_button = st.button(label="ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°", on_click=set_state, args=[1])
        if not continueing:
            st.session_state.user_input = user_input
        else:
            # ç¾åœ¨ã®æœ€ä¸Šä½ã®å³¶ã®ãƒ‡ãƒ¼ã‚¿ã¨ã€ãã‚Œã¾ã§ã®éšŽå±¤æ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†ã‘ã¦ãƒªã‚¹ãƒˆåŒ–
            continueing_split = continueing.split("\n\n--------------------------------\n\n")
            # éšŽå±¤æ§‹é€ ãŒå…¥ã£ãŸãƒªã‚¹ãƒˆã®2ç•ªç›®ã®è¦ç´ ã‚’ãƒªã‚¹ãƒˆåŒ–
            continueing_list = continueing_split[1].split("\n")
            # æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆã‚’å®Ÿéš›ã®è¾žæ›¸ã®ãƒªã‚¹ãƒˆã«å¤‰æ›
            result_list = [parse_dict_from_string(item) for item in continueing_list]

            # éšŽå±¤æ§‹é€ ã®è¾žæ›¸ãƒªã‚¹ãƒˆã§ã€edited_labeling_pairã®å€¤ã‚’æ›´æ–°
            st.session_state["edited_labeling_pair"] = result_list
            # æœ€ä¸Šä½ã®å³¶ãƒ©ãƒ™ãƒ«ã‚’user_inputã¸
            st.session_state.user_input = continueing_split[0]
        
    if st.session_state.stage == 1:

        grouped_tables = []  # grouped_table ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆã‚’åˆæœŸåŒ–

        # session_stateå†…ã®ä»¥å‰ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
        st.session_state["grouping_table"] = []

        first_group_list = split_lines_to_list(st.session_state.user_input)

        user_input_random_order_list = random.sample(first_group_list, len(first_group_list))

        user_input_random = "\n".join(user_input_random_order_list)

        st.session_state["user_input_random"] = user_input_random

        number_of_first_items = len(first_group_list)
        labeling_pair = []
        dict = {}
        count = 1
        break_point = 7
        if number_of_first_items <= 20:
            break_point = 5
        if not number_of_items:
            number_of_items = number_of_first_items

        # ãƒ©ãƒ™ãƒ«é›†ã‚ã®ãŸã‚ã®llmã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°
        model_name_grouping = st.session_state["model_name"]
        llm_group = ChatOpenAI(openai_api_key=openai_api_key, temperature=0.3, model_name=model_name_grouping)

        # é …ç›®æ•°ãŒbreak_pointã‚ˆã‚Šå°‘ãªããªã‚‹ã¾ã§ãƒ©ãƒ™ãƒ«é›†ã‚ã‚’ãƒ«ãƒ¼ãƒ—ã™ã‚‹
        # lines = count_newlines(user_input)
        if translated_theme is None:
            translated_theme = theme_translate(user_theme,st.session_state["openai_api_key"])
        prompt_ptrn = prompt_grouping(number_of_items, translated_theme)
        st.session_state.messages.append(SystemMessage(content=prompt_ptrn))
        st.session_state.messages.append(HumanMessage(content=st.session_state["user_input_random"]))
        with st.spinner(f"KJ-GPTãŒãƒ©ãƒ™ãƒ«ã‚’é›†ã‚ã¦ã„ã¾ã™ï¼ˆæ®‹ã‚Šãƒ©ãƒ™ãƒ«æ•°{number_of_items}ï¼‰ ..."):
            answer, cost = get_answer(llm_group, st.session_state.messages[-2:])

            # answerã®tokenæ•°ã‚’è¨ˆç®—
            tiktoken_encoding = tiktoken.encoding_for_model(model_name_grouping)
            encoded = tiktoken_encoding.encode(answer)
            token_count = len(encoded)

            # ç›´å‰ã®answerã‚’ãƒªã‚¹ãƒˆåŒ–
            answer_list = split_lines_to_list(answer)

            # å…¥åŠ›ã¨å‡ºåŠ›ã®ã‚°ãƒ«ãƒ¼ãƒ—æ•°ã‚’æ¯”è¼ƒ
            # å…¥åŠ›ã®ã‚°ãƒ«ãƒ¼ãƒ—æ•°
            input_data_len = len(first_group_list)
            # å‡ºåŠ›ã®ã‚°ãƒ«ãƒ¼ãƒ—æ•°
            # "ã‚°ãƒ«ãƒ¼ãƒ—:"ã®å…¥ã£ãŸè¦ç´ ã¨ç©ºè¦ç´ ã‚’å‰Šé™¤
            filtered_answer_list = [item for item in answer_list if not re.match(r'(^|#+\s*)ã‚°ãƒ«ãƒ¼ãƒ—\d+:', item) and item != '']
            output_data_len = len(filtered_answer_list)
            if input_data_len != output_data_len:
                print("æœ€åˆã®ãƒ‡ãƒ¼ã‚¿æ•°ã¨å‡ºåŠ›ã®æ•°ãŒé•ã„ã¾ã™ï¼")
                # é‡è¤‡ã‚’å‰Šé™¤
                unique_answer_list = list(dict.fromkeys(answer_list))
                # "- "ã‚’å‰Šé™¤
                unique_answer_list = [item.lstrip('- ') for item in unique_answer_list]
                # å†’é ­ã®æ•°å­—ã‚’å‰Šé™¤
                unique_answer_list = [re.sub(r'^\d+\.\s*', '', item) for item in unique_answer_list]
                # å…¥åŠ›ã¨å‡ºåŠ›ã®ã©ã¡ã‚‰ã‹ä¸€æ–¹ã«ã ã‘å«ã¾ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
                generated_data_set = set(first_group_list) ^ set(unique_answer_list)
                generated_data_list = list(generated_data_set)
                # "ã‚°ãƒ«ãƒ¼ãƒ—:"ã®å…¥ã£ãŸè¦ç´ ã¨ç©ºè¦ç´ ã‚’å‰Šé™¤
                generated_data_list = [item for item in generated_data_list if not re.match(r'(^|#+\s*)ã‚°ãƒ«ãƒ¼ãƒ—\d+:', item) and item != '']
                # generated_data_listã‹ã‚‰é‡è¤‡ã‚’å‰Šé™¤
                generated_data_list = list(set(generated_data_list))
                # ã©ã¡ã‚‰ã‹ä¸€æ–¹ã«ã ã‘å«ã¾ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
                for item in generated_data_list:
                    if item in first_group_list: # å…¥åŠ›ã«ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ©ãƒ™ãƒ«é›†ã‚ã§æ¼ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’åˆ¤æ–­ã—ã¦è¿½åŠ 
                        unique_answer_list.append(f"å˜ç‹¬ï¼š\n{item}")
                    elif item not in first_group_list and item in unique_answer_list: # å…¥åŠ›ã«ã¯ç„¡ãã¦å‡ºåŠ›ã®ã¿ã«å«ã¾ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ©ãƒ™ãƒ«é›†ã‚ã§æ··å…¥ã—ãŸãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’åˆ¤æ–­ã—ã¦å‰Šé™¤
                        unique_answer_list.remove(item)
                
                answer = "\n".join(unique_answer_list)

            # answerã®tokenæ•°ãŒä¸Šé™ï¼ˆ4069tokensï¼‰ã‚’è¶…ãˆãŸå ´åˆã®å‡¦ç†
            if token_count >= 4096:

                # ç›´å‰ã®answerã‚’ãƒªã‚¹ãƒˆåŒ–
                answer_list = split_lines_to_list(answer)
                # answerã‹ã‚‰ã€Œã‚°ãƒ«ãƒ¼ãƒ—ï¼šã€ã€Œå˜ç‹¬ï¼šã€ã‚„ç©ºè¦ç´ ã‚’å‰Šé™¤
                cleaned_answer_list = [item for item in answer_list if not re.match(r'(^|#+\s*)ã‚°ãƒ«ãƒ¼ãƒ—\d+:', item) and item != '']
                cleaned_answer_list = [item for item in cleaned_answer_list if not re.match(r'^å˜ç‹¬ï¼š', item)]
                # æœ€åˆã®å…ƒãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆã‹ã‚‰answerã§ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã•ã‚ŒãŸã‚‚ã®ã‚’é™¤ã„ãŸungrouped_listã‚’ä½œæˆ
                ungrouped_list = set(first_group_list) - set(cleaned_answer_list)

                if ungrouped_list:
                    # ungrouped_listã‚’stråž‹ã¸å¤‰æ›
                    ungrouped_data = "\n".join(ungrouped_list)

                    # ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã•ã‚Œã¦ã„ãªã„æ®‹ã‚Šãƒ©ãƒ™ãƒ«ã«ã¤ã„ã¦ã€å†ã³ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘
                    st.session_state.messages.append(SystemMessage(content=prompt_ptrn))
                    st.session_state.messages.append(HumanMessage(content=ungrouped_data))
                    # æœªã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã®ãƒ‡ãƒ¼ã‚¿ã€systemãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’apiã«æ¸¡ã™
                    conti_answer, cost = get_answer(llm_group, st.session_state.messages[-2:])

                    # æœ€åˆã®ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã¨ãã®ç¶šãã®ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘çµæžœã‚’çµåˆ
                    answer += conti_answer
        
        st.session_state.messages.append(AIMessage(content=answer))
        st.session_state.costs.append(cost)

        set_state(2)

    if st.session_state.stage == 2:

        grouped_data_list = get_list(st.session_state.messages[-1].content)
        no_grouped_items = []  # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãªã„å˜ç‹¬ãƒ‡ãƒ¼ã‚¿ ã‚’æ ¼ç´ã™ã‚‹ãƒªã‚¹ãƒˆã‚’åˆæœŸåŒ–
        for i, item in enumerate(grouped_data_list):
            if isinstance(item, str):
                no_grouped_items.append(item)
            else:
                number_of_groups = i + 1
                st.write(f"ã‚°ãƒ«ãƒ¼ãƒ—{number_of_groups}")
                grouped_table = st.data_editor(item, key=f"group{number_of_groups}", num_rows="dynamic", use_container_width=True)
                grouped_tables.append(grouped_table)
                st.session_state["grouping_table"].append(grouped_table)
        st.write("å˜ç‹¬")
        if not no_grouped_items:
            no_grouped_items.append(" ")
        no_grouped_table = st.data_editor(no_grouped_items, key="no_grouped_items", num_rows="dynamic", use_container_width=True)
        # grouped_tables.append(no_grouped_table)

        # if st.session_state["no_grouped_items"] != st.session_state["no_grouped_items"]:
        #     st.session_state["grouped_tables"] = grouped_tables
        
        # st.session_state["grouping_table"].append(no_grouped_table)

        for i, group in enumerate(grouped_tables):
            if len(group) < 2: # ãƒ©ãƒ™ãƒ«ãŒ1ã¤ã—ã‹ãªã„å ´åˆ
                no_grouped_table.append(group[0]) # å˜ç‹¬ã®ãƒ©ãƒ™ãƒ«ç¾¤ã¸è¿½åŠ 
                del grouped_tables[i] # ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤

        st.session_state["grouped_tables"] = grouped_tables
        grouped_tables_length = len(st.session_state["grouped_tables"])
        st.session_state["no_grouped_tables"] = no_grouped_table
        # å˜ç‹¬ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒå°‘ãªãã¨ã‚‚1ã¤ã‚ã‚‹å ´åˆã¯ã€ãã®å€‹æ•°ã‚’æ•°ãˆã‚‹
        if len(no_grouped_table) != 0 and no_grouped_table[0] != " ":
            no_grouped_tables_length = len(st.session_state.no_grouped_tables)
        else:
            no_grouped_tables_length = 0
        st.session_state["number_of_items"] = grouped_tables_length + no_grouped_tables_length

        st.button(label="è¡¨æœ­ã‚’ã¤ãã‚‹", on_click=set_state, args=[3])

    if st.session_state.stage == 3:

        print("è¡¨æœ­ã‚’ä½œã‚‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ")

        cleaned_group_list = []
        group_list = st.session_state["grouped_tables"]
        cleaned_no_group_list = []
        no_group_list = st.session_state["no_grouped_tables"]
        number_of_items = st.session_state["number_of_items"]
        if not break_point:
            first_group_list = split_lines_to_list(st.session_state.user_input)
            number_of_first_items = len(first_group_list)
            if number_of_first_items <= 20:
                break_point = 5
            else:
                break_point = 7
        
        # ç©ºã®è¦ç´ ã‚’å‰Šé™¤
        for each_group in group_list:
            cleaned_group_a = list(filter(None, each_group))
            cleaned_group_b = [item for item in cleaned_group_a if item != "" ]
            cleaned_group_list.append(cleaned_group_b)

        for item in no_group_list:
            if item is not None and item != "":
                cleaned_no_group_list.append(item)
        st.session_state["no_grouped_tables"] = cleaned_no_group_list

        for group in cleaned_group_list:    
            if isinstance(group, list) and len(group) >= 2:

                # å„ãƒ©ãƒ™ãƒ«ã‹ã‚‰ã€ã€Œæ•°å­—ï¼‹.ã€ãŠã‚ˆã³ã€Œã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼‹æ•°å­—ï¼‹.ã€ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‰Šé™¤
                cleaned_group_list = [re.sub(r'^[a-zA-Z]?\d+\.', '', text) for text in group]

                group_string = "\n".join(cleaned_group_list)

                # ãƒ©ãƒ™ãƒ«é›†ã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                prompt_ptrn = prompt_labeling(number_of_items,break_point,style)

                # è¡¨æœ­ã¥ãã‚Šã®ãŸã‚ã®llmã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°
                llm_label = ChatOpenAI(openai_api_key=openai_api_key, temperature=0.7, model_name=st.session_state["model_name"])

                st.session_state.messages.append(SystemMessage(content=prompt_ptrn))
                st.session_state.messages.append(HumanMessage(content=group_string))
                with st.spinner("KJ-GPTãŒè¡¨æœ­ã‚’è€ƒãˆã¦ã„ã¾ã™ ..."):
                    answer, cost = get_answer(llm_label, st.session_state.messages[-2:])
                group_list.append(answer)
                dict = {answer: group}
                labeling_pair.append(dict)
                st.session_state.messages.append(AIMessage(content=answer))
                st.session_state.costs.append(cost)
            elif isinstance(group, list) and len(group) == 1:
                added_no_grouped_table = st.session_state["no_grouped_tables"]
                added_no_grouped_table.append(group[0])
                st.session_state["no_grouped_tables"] = added_no_grouped_table

        group_list = [item for item in group_list if not isinstance(item, list)]
        # print(labeling_pair)
        group_list_str = "\n".join(group_list)
        user_input = group_list_str
        # result = st.text_area(label=f"{count}å›žç›®ã®çµæžœ: ", key=f"result{count}", value=group_list_str, height=300)
        number_of_items = len(group_list)

        # ãƒ©ãƒ™ãƒ«ã®ãƒšã‚¢ã‚’session_stateã«æ ¼ç´
        st.session_state["labeling_pair"] = labeling_pair
        
        set_state(4)

    if st.session_state.stage == 4:

        st.markdown("**ã‚°ãƒ«ãƒ¼ãƒ—**")
        for i, item in enumerate(st.session_state["labeling_pair"]):
            new_item = {}
            for key, value in item.items():
                edited_labeling_df = st.data_editor([key], column_config={"value": st.column_config.Column(f"è¡¨æœ­{i+1}")}, use_container_width=True)
                edited_labels_list.append(edited_labeling_df[0])
                for value in item.values():
                    # edited_labeled_df = st.data_editor(value, column_config={"value": st.column_config.Column("ãƒ©ãƒ™ãƒ«",width=None)}, use_container_width=True, key=f"values{i}")
                    st.table(value) #ã€€è¡¨ç¤ºç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«
                st.write("--")
                new_item[edited_labeling_df[0]] = list(value)
                edited_labeling_pair.append(new_item)
        edited_labeling_pair_added_solos = edited_labeling_pair

        st.markdown("**å˜ä½“**")
        edited_labeled_solo_df = st.data_editor(st.session_state["no_grouped_tables"], column_config={"value": st.column_config.Column("ãƒ©ãƒ™ãƒ«")}, use_container_width=True)
        for solo_item in list(edited_labeled_solo_df):
            if solo_item is not None and solo_item != "":
                edited_labels_list.append(solo_item)
                edited_labeling_pair_added_solos.append(solo_item)

        # ãƒœã‚¿ãƒ³ã®disabledçŠ¶æ…‹ã‚’è¨­å®š
        should_disable_button = st.session_state.get("disable_button", False)

        # æ¡ä»¶ã«å¿œã˜ãŸãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã§ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        next_round_button = st.button(label="ã“ã®è¡¨æœ­ã§æ±ºå®š", disabled=should_disable_button, on_click=button_disable)

        if next_round_button:

            st.session_state.user_input = "\n".join(edited_labels_list)
            st.session_state["edited_labeling_pair"].extend(edited_labeling_pair)

            if "saved_content" not in st.session_state:
                st.session_state["saved_content"] = []
            if "wip_saved_content" not in st.session_state:
                st.session_state["wip_saved_content"] = []

            st.session_state["wip_saved_content"].extend(edited_labeling_pair_added_solos)

            # ãƒ©ãƒ™ãƒ«ã®ãƒšã‚¢ãƒªã‚¹ãƒˆã®è¦ç´ ã‚’æ”¹è¡Œã§é€£çµã—ã¦ä¸€ã¤ã®æ–‡å­—åˆ—ã«ã™ã‚‹
            if isinstance(st.session_state["edited_labeling_pair"], list):
                edited_labeling_pair_txt = "\n".join(str(item) for item in st.session_state["edited_labeling_pair"])
            else:
                edited_labeling_pair_txt = st.session_state["edited_labeling_pair"]
            st.session_state["saved_content"] = st.session_state.user_input + "\n\n--------------------------------\n\n" + edited_labeling_pair_txt
            wip_user_theme = st.session_state["user_theme"]

            st.button(label="ã“ã®ã¾ã¾ãƒ©ãƒ™ãƒ«é›†ã‚ã‚’ç¶šã‘ã‚‹ðŸ‘‰", on_click=set_state, args=[1])

            st.download_button("ä¿å­˜ðŸ’¾ï¼†ãƒ©ãƒ™ãƒ«é›†ã‚ã‚’ç¶šã‘ã‚‹ðŸ‘‰", st.session_state["saved_content"], f"{dt_now_formatted}_{wip_user_theme}", on_click=set_state, args=[1])
            
            st.download_button("å®Œäº†ã—ã¦ã‚·ãƒ³ãƒœãƒ«ã‚’ä½œã‚‹ðŸ‘Œ", st.session_state["saved_content"], f"{dt_now_formatted}_{wip_user_theme}", on_click=set_state, args=[5])

            # next_roundãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹ã«ã™ã‚‹
            st.session_state['disable_button'] = False

        # symbol_button = st.button(label="ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’ä½œã‚‹")

        # if symbol_button:
        #     st.session_state.user_input = "\n".join(edited_labels_list)
        #     st.session_state["edited_labeling_pair"].extend(edited_labeling_pair)
        #     set_state(5)
        #     st.rerun()

    if st.session_state.stage == 5:

        edited_labeling_pairs = st.session_state["edited_labeling_pair"]
        
        # symbol_input_list = get_list(user_input)
        # print("symbol_input_list:", symbol_input_list)
        top_items = []
        symbol_sets = []
        symbol_dict = {}
        symbol_count = 0

        # æœ€ä¸Šä½ã®å³¶ã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        highest_level_labels = st.session_state["user_input"]
        highest_level_labels_list = highest_level_labels.split("\n")
        symbol_list_length = len(highest_level_labels_list)

        # æœ€ä¸Šä½ã®å³¶ã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’ä½œæˆ
        for item in highest_level_labels_list:
            
            # ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã®ç·æ•°ã‹ã‚‰ãƒ«ãƒ¼ãƒ—ã”ã¨ã«1ãšã¤æ¸›ã‚‰ã—ãŸæ•°
            # symbol_reversed_count = symbol_list_length - symbol_count

            item_str = str(item)

            prompt_ptrn = prompt_labeling(0,break_point,style)

            st.session_state.messages.append(SystemMessage(content=prompt_ptrn))
            st.session_state.messages.append(HumanMessage(content=item_str))
            with st.spinner("KJ-GPTãŒã‚·ãƒ³ãƒœãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã™ ..."):
                symbol_answer, cost = get_answer(llm, st.session_state.messages[-2:])
            symbol_set = symbol_answer + "ï¼š" + item_str
            symbol_title = "**" + f"({symbol_count + 1}) " +  symbol_answer + "**"
            symbol_dict["# " + item_str] = symbol_title + "\n" + "# " + item_str
            # print("symbol_set", symbol_set)
            top_items.append(item_str)
            symbol_sets.append(symbol_set)
            st.session_state.messages.append(AIMessage(content=answer))
            st.session_state.costs.append(cost)

            symbol_count += 1

        symbol_str = "\n".join(symbol_sets)

        markdown_text = ""

        # top_itemsã®ãƒªã‚¹ãƒˆã‚’é€†é †ã§å‡¦ç†
        # reversed_top_items = list(reversed(top_items))

        # reversed_top_itemsãƒªã‚¹ãƒˆã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦æœ€ä¸Šä½ã®è¦‹å‡ºã—ã‚’å‡¦ç†ã—ã¾ã™ã€‚
        for top_item in highest_level_labels_list:
            # top_text = top_item.split("ï¼š")[1].strip()
            markdown_text += add_markdown_entry(1, top_item)  # æœ€ä¸Šä½ã®è¦‹å‡ºã—ã‚’é€†é †ã§èª­ã¿è¾¼ã‚“ã§è¿½åŠ 
            markdown_text += find_sub_items(top_item, 2, edited_labeling_pairs)  # ã‚µãƒ–ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŽ¢ã—ã¦è¿½åŠ 
        for key, value in symbol_dict.items():
            markdown_text = markdown_text.replace(key, value)

        st.session_state["markdown_text"] = markdown_text

        converted_markdown = headline_to_list(st.session_state["markdown_text"])
        st.markdown(converted_markdown)

        set_state(6)

    # ä½œæ¥­ä¸­ã®ç®‡æ¡æ›¸ãã‚’è¡¨ç¤º
    if st.session_state["saved_content"] and st.session_state.stage != 6:

        wip_container = st.container(border=True)
        with wip_container:
            st.write("ä½œæ¥­ä¸­ã®çµæžœ")

            st.code(st.session_state["saved_content"], language="python")

            working_markdown_text = ""
            working_highest_level_labels = st.session_state["user_input"]
            working_highest_level_labels_list = working_highest_level_labels.split("\n")

            for top_item in working_highest_level_labels_list:
                # top_text = top_item.split("ï¼š")[1].strip()
                working_markdown_text += add_markdown_entry(1, top_item)  # æœ€ä¸Šä½ã®è¦‹å‡ºã—ã‚’é€†é †ã§èª­ã¿è¾¼ã‚“ã§è¿½åŠ 
                working_markdown_text += find_sub_items(top_item, 2, st.session_state["wip_saved_content"])  # ã‚µãƒ–ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŽ¢ã—ã¦è¿½åŠ 
            # for key, value in st.session_state["saved_content"].items():
            #     working_markdown_text = working_markdown_text.replace(key, value)

            st.session_state["working_markdown_text"] = working_markdown_text

            converted_working_markdown = headline_to_list(working_markdown_text)
            st.markdown(converted_working_markdown)

    if st.session_state.stage == 6:

        # ä½œæ¥­ä¸­ã®ç®‡æ¡æ›¸ãã‚’å‰Šé™¤
        converted_working_markdown = ""

        chart_container = st.container()
        with chart_container:
            with st.form(key="my_chart", clear_on_submit=False):
                if "markdown_text" not in st.session_state:
                    st.session_state["markdown_text"] = ""
                labels_all = st.text_area(label="ãƒ©ãƒ™ãƒ«ã®ãƒšã‚¢: ", key="labels_all", value=st.session_state["markdown_text"], height=300)
                miro_teamId = st.text_input("Miro ãƒãƒ¼ãƒ ID", type="password")
                boardId = st.text_input("Miro ãƒœãƒ¼ãƒ‰ID")
                sentence_button = st.form_submit_button(label="ãƒ‡ãƒ¼ã‚¿ã‚’å›³è§£åŒ–")


            if sentence_button and labels_all and miro_teamId and boardId:

                parsed_markdown = parse_markdown_with_bold(labels_all)

                api_token = st.session_state["miro_api_key"]
                
                # å„è¦ç´ ã®ãƒ¬ãƒ™ãƒ«ã¨ãã®xyåº§æ¨™ã‚’ä¿ç®¡ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
                element_positions = []

                # ã‚·ã‚§ã‚¤ãƒ—ã‚’ãƒœãƒ¼ãƒ‰ã«è¿½åŠ 
                x_position = 0
                y_position = 0
                previous_level = -1
                previous_x_position = 0  # å‰ã®è¦ç´ ã®xåº§æ¨™
                previous_width = 0
                highest_level = 0
                level_y_positions = {0: 0, 1: 350, 2: 1100, 3: 1400, 4: 1700, 5: 1900, 6: 2100, 8: 2400}  # å„ãƒ¬ãƒ™ãƒ«ã®æœ€æ–°ã®yåº§æ¨™
                width_by_level =  {0: 800, 1: 3000, 2: 500, 3: 275, 4: 175, 5: 175, 6: 175, 8: 175}  # å„ãƒ¬ãƒ™ãƒ«ã”ã¨ã®ã‚·ã‚§ã‚¤ãƒ—ã®å¹…
                height_by_level =  {0: 100, 1: 450, 2: 250, 3: 100, 4: 75, 5: 75, 6: 75, 8: 75}  # å„ãƒ¬ãƒ™ãƒ«ã”ã¨ã®ã‚·ã‚§ã‚¤ãƒ—ã®é«˜ã•

                for level, text in parsed_markdown:

                    # ã‚·ã‚§ã‚¤ãƒ—ã®å¹…ã¨é«˜ã•ã‚’ãƒ¬ãƒ™ãƒ«ã«ã‚ˆã£ã¦æ±ºã‚ã‚‹
                    shape_width = width_by_level[level]
                    shape_height = height_by_level[level]

                    if level > highest_level:
                        highest_level = level
                    if level > previous_level:
                        # éšŽå±¤ãŒæ·±ããªã£ãŸå ´åˆã€ãƒ¬ãƒ™ãƒ«ãŒ1ä»¥ä¸‹ã®æ™‚ã¯å‰ã®è¦ç´ ã®xåº§æ¨™ã‚’ãã®ã¾ã¾å¼•ãç¶™ãŽã€ãã‚Œä»¥å¤–ã®æ™‚ã¯å‰ã®è¦ç´ ã®å¹…ã®4åˆ†ã®ä½ç½®å·¦ã«ãšã‚‰ã™
                        if level == 1:
                            x_position = previous_x_position + 1000
                        else:
                            x_position = previous_x_position - ( previous_width / 4 )
                        # yåº§æ¨™ã‚’æ›´æ–°        
                        y_position = level_y_positions[level]

                    elif level < previous_level:
                        if level != 0:
                            # ã‚ˆã‚Šæµ…ã„éšŽå±¤ã«ç§»å‹•ã—ãŸã‚‰ã€å‰ã®è¦ç´ ã®xåº§æ¨™ã‹ã‚‰ã‚·ã‚§ã‚¤ãƒ—ã®å¹…åˆ†ãƒ—ãƒ©ã‚¹240å‹•ã‹ã™
                            x_position = previous_x_position + shape_width + 240
                        else:
                            # ãƒ¬ãƒ™ãƒ«0ã¸ç§»å‹•ã—ãŸã‚‰ã€å‰ã®è¦ç´ ã®xåº§æ¨™ã‹ã‚‰ã‚·ã‚§ã‚¤ãƒ—ã®å¹…åˆ†ãƒ—ãƒ©ã‚¹1200å‹•ã‹ã™
                            x_position = previous_x_position + shape_width + 1200
                        # yè»¸ã¯åž‚ç›´ã«ç§»å‹•ã™ã‚‹
                        y_position = level_y_positions[level]
                    elif level == previous_level: # åŒã˜ãƒ¬ãƒ™ãƒ«ã®å ´åˆ
                        # xåº§æ¨™ã®ã¿120å¢—ã‚„ã™
                        x_position = previous_x_position + shape_width + 120

                    # ã‚·ã‚§ã‚¤ãƒ—ã‚’ä½œæˆ
                    add_shape(api_token, boardId, level, text, x_position, y_position, shape_width, shape_height)

                    # ã“ã®è¦ç´ ã®æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ 
                    element_positions.append({"level": level, "x": x_position, "y": y_position})

                    # xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                    level_y_positions[level] = y_position
                    previous_x_position = x_position
                    previous_level = level
                    previous_width = shape_width


                # print("element_positions >>>>", element_positions)
                # çµæžœã®è¡¨ç¤º
                # for element in element_positions:
                #     print(f"ãƒ¬ãƒ™ãƒ« {element['level']} ã®è¦ç´ ãŒä½ç½® ({element['x']}, {element['y']}) ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚")

                # ãƒ¬ãƒ™ãƒ«0ã”ã¨ã®å››è§’å½¢ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
                start_x = 0
                max_y = 0
                max_x = 0

                # å„ãƒ¬ãƒ™ãƒ«0ã”ã¨ã«å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                # for element in element_positions:
                #     level = element['level']
                #     x, y = element['x'], element['y']

                #     # æœ€å¤§ã®xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                #     max_x = max(max_x, x)
                #     max_y = max(max_y, y)

                #     print("max_xã¯ã€", max_x, "start_xã¯", start_x)

                #     if level == 0 and x != start_x:
                #         # å‰ã®ãƒ¬ãƒ™ãƒ«0ã‹ã‚‰ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«0ã¾ã§ã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—
                #         width = max_x - start_x - 700
                #         height = max_y + 360
                #         frame_x = start_x + ( width - 1700 ) / 2 
                #         frame_y = ( height - 360 ) / 2

                #         # å››è§’å½¢ã‚’è¿½åŠ 
                #         add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                #         # æ–°ã—ã„ãƒ¬ãƒ™ãƒ«0ã®é–‹å§‹ç‚¹ã‚’è¨­å®š
                #         start_x = x
                #         max_x = x
                #         max_y = 0

                # # æœ€å¾Œã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                # width = max_x - start_x + 1200
                # height = max_y + 360
                # frame_x = start_x + ( width - 1700 ) / 2 
                # frame_y = ( height - 360 ) / 2
                # add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)


                # ãƒ¬ãƒ™ãƒ«1ã”ã¨ã®å››è§’å½¢ã‚’ä½œæˆ
                # 1ä»¥ä¸Šã®è¦ç´ ã®ã¿æŠ½å‡º
                level_1_or_higher = [item for item in parsed_markdown if item[0] >= 1]

                # levelã®å€¤ãŒ1ä»¥ä¸Šã®è¦ç´ ã‚’æŠ½å‡º
                elements_level_1_or_higher = [item for item in element_positions if item['level'] >= 1]

                # ãƒªã‚¹ãƒˆã‚’ã‚¿ãƒ—ãƒ«ã®å½¢ã«å¤‰æ›
                tuple_list_positions_1_or_higher = [(item['level'], item['x'], item['y']) for item in elements_level_1_or_higher]

                if highest_level == 2:
                    # 2ãŒå‡ºç¾ã™ã‚‹æœ€å¾Œã®é …ç›®ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
                    last_two_index = None
                    for i, (level, _, _) in enumerate(tuple_list_positions_1_or_higher):
                        if level == 2:
                            last_two_index = i

                    # last_two_indexãŒNoneã§ãªã‘ã‚Œã°ã€æœ€å¾Œã®2ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ã‚¹ãƒ©ã‚¤ã‚¹ã™ã‚‹
                    if last_two_index is not None:
                        result_list = tuple_list_positions_1_or_higher[:last_two_index + 1]
                    else:
                        result_list = tuple_list_positions_1_or_higher  # 2ãŒãªã„å ´åˆã¯å…ƒã®ãƒªã‚¹ãƒˆã‚’ãã®ã¾ã¾ä½¿ç”¨

                    tuple_list_positions_1_or_higher = result_list

                # ãƒ¬ãƒ™ãƒ«1ã”ã¨ã®å››è§’å½¢ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
                level1_start_x = 0
                level1_max_x = 0
                level1_max_y = 0

                # å„ãƒ¬ãƒ™ãƒ«1ã”ã¨ã«å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                for level, x, y in tuple_list_positions_1_or_higher:
                    # æœ€å¤§ã®xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                    if level >= 1:
                        level1_max_x = max(level1_max_x, x)
                        level1_max_y = max(level1_max_y, y)

                    if level == 1 and x != level1_start_x:
                        # ãƒ¬ãƒ™ãƒ«1ã®åŒºé–“ã®å››è§’å½¢ã‚’è¨ˆç®—
                        width = level1_max_x - level1_start_x - 240
                        height = level1_max_y - 650 + 960  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯650
                        frame_x = level1_start_x + ( width - 3600 ) / 2
                        frame_y = 650 + ( height - 600 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—

                        # å­è¦ç´ ãŒã‚ã‚‹å ´åˆã®ã¿å››è§’å½¢ã‚’è¿½åŠ ï¼ˆå››è§’å½¢ã®é«˜ã•ãŒ450ã®å ´åˆã¯è¿½åŠ ã—ãªã„ï¼‰
                        if height != 450:
                            # å››è§’å½¢ã‚’è¿½åŠ 
                            add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height, level)

                        # æ–°ã—ã„ãƒ¬ãƒ™ãƒ«1ã®é–‹å§‹ç‚¹ã‚’è¨­å®š
                        level1_start_x = x
                        level1_max_x = x
                        level1_max_y = 960  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

                # æœ€å¾Œã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ ï¼ˆãƒ¬ãƒ™ãƒ«1ãŒæœ€å¾Œã«ç¾ã‚ŒãŸå ´åˆï¼‰
                if level1_max_x > level1_start_x:
                    width = level1_max_x - level1_start_x + 2100
                    height = level1_max_y - 650 + 960  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯650
                    frame_x = level1_start_x + ( width - 3200 ) / 2
                    frame_y = 650 + ( height - 600 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—
                    add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height, 1)


                # # ãƒ¬ãƒ™ãƒ«2ã”ã¨ã®å››è§’å½¢ã‚’ä½œæˆ
                # # 2ä»¥ä¸Šã®è¦ç´ ã®ã¿æŠ½å‡º
                # level_2_or_higher = [item for item in parsed_markdown if item[0] >= 2]

                # # levelã®å€¤ãŒ2ä»¥ä¸Šã®è¦ç´ ã‚’æŠ½å‡º
                # elements_level_2_or_higher = [item for item in element_positions if item['level'] >= 2]

                # # ãƒªã‚¹ãƒˆã‚’ã‚¿ãƒ—ãƒ«ã®å½¢ã«å¤‰æ›
                # tuple_list_positions_2_or_higher = [(item['level'], item['x'], item['y']) for item in elements_level_2_or_higher]

                # if highest_level == 3:
                #     # 3ãŒå‡ºç¾ã™ã‚‹æœ€å¾Œã®é …ç›®ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
                #     last_three_index = None
                #     for i, (level, _, _) in enumerate(tuple_list_positions_2_or_higher):
                #         if level == 3:
                #             last_three_index = i

                #     # last_three_indexãŒNoneã§ãªã‘ã‚Œã°ã€æœ€å¾Œã®3ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ã‚¹ãƒ©ã‚¤ã‚¹ã™ã‚‹
                #     if last_three_index is not None:
                #         result_list = tuple_list_positions_2_or_higher[:last_three_index + 1]
                #     else:
                #         result_list = tuple_list_positions_2_or_higher  # 3ãŒãªã„å ´åˆã¯å…ƒã®ãƒªã‚¹ãƒˆã‚’ãã®ã¾ã¾ä½¿ç”¨

                #     tuple_list_positions_2_or_higher = result_list

                # # ãƒ¬ãƒ™ãƒ«2ã”ã¨ã®å››è§’å½¢ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
                # level2_start_x = 0
                # level2_max_x = 0
                # level2_max_y = 0

                # # å„ãƒ¬ãƒ™ãƒ«2ã”ã¨ã«å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                # for level, x, y in tuple_list_positions_2_or_higher:
                #     # æœ€å¤§ã®xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                #     if level >= 2:
                #         level2_max_x = max(level2_max_x, x)
                #         level2_max_y = max(level2_max_y, y)

                #     if level == 2 and x != level2_start_x:
                #         # ãƒ¬ãƒ™ãƒ«2ã®åŒºé–“ã®å››è§’å½¢ã‚’è¨ˆç®—
                #         width = level2_max_x - level2_start_x - 120
                #         height = level2_max_y - 360 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯360
                #         frame_x = level2_start_x + ( width - 120 ) / 2
                #         frame_y = 360 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—

                #         # å­è¦ç´ ãŒã‚ã‚‹å ´åˆã®ã¿å››è§’å½¢ã‚’è¿½åŠ ï¼ˆå››è§’å½¢ã®é«˜ã•ãŒ120ã®å ´åˆã¯è¿½åŠ ã—ãªã„ï¼‰
                #         if height != 120:
                #             # å››è§’å½¢ã‚’è¿½åŠ 
                #             add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                #         # æ–°ã—ã„ãƒ¬ãƒ™ãƒ«2ã®é–‹å§‹ç‚¹ã‚’è¨­å®š
                #         level2_start_x = x
                #         level2_max_x = x
                #         level2_max_y = 360  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

                # # æœ€å¾Œã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ ï¼ˆãƒ¬ãƒ™ãƒ«2ãŒæœ€å¾Œã«ç¾ã‚ŒãŸå ´åˆï¼‰
                # if level2_max_x > level2_start_x:
                #     width = level2_max_x - level2_start_x + 120
                #     height = level2_max_y - 360 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯360
                #     frame_x = level2_start_x + ( width - 120 ) / 2
                #     frame_y = 360 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—
                #     add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                
                # # ãƒ¬ãƒ™ãƒ«3ã”ã¨ã®å››è§’å½¢ã‚’ä½œæˆ
                # # 3ä»¥ä¸Šã®è¦ç´ ã®ã¿æŠ½å‡º
                # level_3_or_higher = [item for item in parsed_markdown if item[0] >= 3]

                # # levelã®å€¤ãŒ3ä»¥ä¸Šã®è¦ç´ ã‚’æŠ½å‡º
                # elements_level_3_or_higher = [item for item in element_positions if item['level'] >= 3]

                # # ãƒªã‚¹ãƒˆã‚’ã‚¿ãƒ—ãƒ«ã®å½¢ã«å¤‰æ›
                # tuple_list_positions_3_or_higher = [(item['level'], item['x'], item['y']) for item in elements_level_3_or_higher]

                # if highest_level == 4:
                #     # 4ãŒå‡ºç¾ã™ã‚‹æœ€å¾Œã®é …ç›®ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
                #     last_four_index = None
                #     for i, (level, _, _) in enumerate(tuple_list_positions_3_or_higher):
                #         if level == 4:
                #             last_four_index = i

                #     # last_four_indexãŒNoneã§ãªã‘ã‚Œã°ã€æœ€å¾Œã®4ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ã‚¹ãƒ©ã‚¤ã‚¹ã™ã‚‹
                #     if last_four_index is not None:
                #         result_list = tuple_list_positions_3_or_higher[:last_four_index + 1]
                #     else:
                #         result_list = tuple_list_positions_3_or_higher  # 4ãŒãªã„å ´åˆã¯å…ƒã®ãƒªã‚¹ãƒˆã‚’ãã®ã¾ã¾ä½¿ç”¨

                #     tuple_list_positions_3_or_higher = result_list

                # # ãƒ¬ãƒ™ãƒ«3ã”ã¨ã®å››è§’å½¢ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
                # level3_start_x = 0
                # level3_max_x = 0
                # level3_max_y = 0

                # # å„ãƒ¬ãƒ™ãƒ«3ã”ã¨ã«å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                # for level, x, y in tuple_list_positions_3_or_higher:
                #     # æœ€å¤§ã®xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                #     if level >= 3:
                #         level3_max_x = max(level3_max_x, x)
                #         level3_max_y = max(level3_max_y, y)

                #     if level == 3 and x != level3_start_x:
                #         # ãƒ¬ãƒ™ãƒ«3ã®åŒºé–“ã®å››è§’å½¢ã‚’è¨ˆç®—
                #         width = level3_max_x - level3_start_x - 120
                #         height = level3_max_y - 480 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯480
                #         frame_x = level3_start_x + ( width - 120 ) / 2
                #         frame_y = 480 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—

                #         # å­è¦ç´ ãŒã‚ã‚‹å ´åˆã®ã¿å››è§’å½¢ã‚’è¿½åŠ ï¼ˆå››è§’å½¢ã®é«˜ã•ãŒ120ã®å ´åˆã¯è¿½åŠ ã—ãªã„ï¼‰
                #         if height != 120:
                #             # å››è§’å½¢ã‚’è¿½åŠ 
                #             add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                #         # æ–°ã—ã„ãƒ¬ãƒ™ãƒ«3ã®é–‹å§‹ç‚¹ã‚’è¨­å®š
                #         level3_start_x = x
                #         level3_max_x = x
                #         level3_max_y = 480  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

                # # æœ€å¾Œã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ ï¼ˆãƒ¬ãƒ™ãƒ«3ãŒæœ€å¾Œã«ç¾ã‚ŒãŸå ´åˆï¼‰
                # if level3_max_x > level3_start_x:
                #     width = level3_max_x - level3_start_x + 120
                #     height = level3_max_y - 480 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯480
                #     frame_x = level3_start_x + ( width - 120 ) / 2
                #     frame_y = 480 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—
                #     add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)


                # # ãƒ¬ãƒ™ãƒ«4ã”ã¨ã®å››è§’å½¢ã‚’ä½œæˆ
                # # 4ä»¥ä¸Šã®è¦ç´ ã®ã¿æŠ½å‡º
                # level_4_or_higher = [item for item in parsed_markdown if item[0] >= 4]

                # # levelã®å€¤ãŒ4ä»¥ä¸Šã®è¦ç´ ã‚’æŠ½å‡º
                # elements_level_4_or_higher = [item for item in element_positions if item['level'] >= 4]

                # # ãƒªã‚¹ãƒˆã‚’ã‚¿ãƒ—ãƒ«ã®å½¢ã«å¤‰æ›
                # tuple_list_positions_4_or_higher = [(item['level'], item['x'], item['y']) for item in elements_level_4_or_higher]

                # if highest_level == 5:
                #     # 5ãŒå‡ºç¾ã™ã‚‹æœ€å¾Œã®é …ç›®ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
                #     last_five_index = None
                #     for i, (level, _, _) in enumerate(tuple_list_positions_4_or_higher):
                #         if level == 5:
                #             last_four_index = i

                #     # last_five_indexãŒNoneã§ãªã‘ã‚Œã°ã€æœ€å¾Œã®5ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ã‚¹ãƒ©ã‚¤ã‚¹ã™ã‚‹
                #     if last_five_index is not None:
                #         result_list = tuple_list_positions_4_or_higher[:last_five_index + 1]
                #     else:
                #         result_list = tuple_list_positions_4_or_higher  # 5ãŒãªã„å ´åˆã¯å…ƒã®ãƒªã‚¹ãƒˆã‚’ãã®ã¾ã¾ä½¿ç”¨

                #     tuple_list_positions_4_or_higher = result_list

                # # ãƒ¬ãƒ™ãƒ«4ã”ã¨ã®å››è§’å½¢ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
                # level4_start_x = 0
                # level4_max_x = 0
                # level4_max_y = 0

                # # å„ãƒ¬ãƒ™ãƒ«4ã”ã¨ã«å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                # for level, x, y in tuple_list_positions_4_or_higher:
                #     # æœ€å¤§ã®xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                #     if level >= 4:
                #         level4_max_x = max(level4_max_x, x)
                #         level4_max_y = max(level4_max_y, y)

                #     if level == 4 and x != level4_start_x:
                #         # ãƒ¬ãƒ™ãƒ«4ã®åŒºé–“ã®å››è§’å½¢ã‚’è¨ˆç®—
                #         width = level4_max_x - level4_start_x - 120
                #         height = level4_max_y - 600 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯600
                #         frame_x = level4_start_x + ( width - 120 ) / 2
                #         frame_y = 600 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—

                #         # å­è¦ç´ ãŒã‚ã‚‹å ´åˆã®ã¿å››è§’å½¢ã‚’è¿½åŠ ï¼ˆå››è§’å½¢ã®é«˜ã•ãŒ120ã®å ´åˆã¯è¿½åŠ ã—ãªã„ï¼‰
                #         if height != 120:
                #             # å››è§’å½¢ã‚’è¿½åŠ 
                #             add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                #         # æ–°ã—ã„ãƒ¬ãƒ™ãƒ«4ã®é–‹å§‹ç‚¹ã‚’è¨­å®š
                #         level4_start_x = x
                #         level4_max_x = x
                #         level4_max_y = 600  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

                # # æœ€å¾Œã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ ï¼ˆãƒ¬ãƒ™ãƒ«4ãŒæœ€å¾Œã«ç¾ã‚ŒãŸå ´åˆï¼‰
                # if level4_max_x > level4_start_x:
                #     width = level4_max_x - level4_start_x + 120
                #     height = level4_max_y - 600 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯600
                #     frame_x = level4_start_x + ( width - 120 ) / 2
                #     frame_y = 600 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—
                #     add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)


                # # ãƒ¬ãƒ™ãƒ«5ã”ã¨ã®å››è§’å½¢ã‚’ä½œæˆ
                # # 5ä»¥ä¸Šã®è¦ç´ ã®ã¿æŠ½å‡º
                # level_5_or_higher = [item for item in parsed_markdown if item[0] >= 5]

                # # levelã®å€¤ãŒ5ä»¥ä¸Šã®è¦ç´ ã‚’æŠ½å‡º
                # elements_level_5_or_higher = [item for item in element_positions if item['level'] >= 5]

                # # ãƒªã‚¹ãƒˆã‚’ã‚¿ãƒ—ãƒ«ã®å½¢ã«å¤‰æ›
                # tuple_list_positions_5_or_higher = [(item['level'], item['x'], item['y']) for item in elements_level_5_or_higher]
                # print(">>>> tuple_list_positions_5_or_higherã¯ã€", tuple_list_positions_5_or_higher)

                # if highest_level == 6:
                #     # 6ãŒå‡ºç¾ã™ã‚‹æœ€å¾Œã®é …ç›®ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
                #     last_six_index = None
                #     for i, (level, _, _) in enumerate(tuple_list_positions_5_or_higher):
                #         if level == 6:
                #             last_six_index = i

                #     # last_six_indexãŒNoneã§ãªã‘ã‚Œã°ã€æœ€å¾Œã®6ã¾ã§ã®ãƒªã‚¹ãƒˆã‚’ã‚¹ãƒ©ã‚¤ã‚¹ã™ã‚‹
                #     if last_six_index is not None:
                #         result_list = tuple_list_positions_5_or_higher[:last_six_index + 1]
                #     else:
                #         result_list = tuple_list_positions_5_or_higher  # 6ãŒãªã„å ´åˆã¯å…ƒã®ãƒªã‚¹ãƒˆã‚’ãã®ã¾ã¾ä½¿ç”¨

                #     tuple_list_positions_5_or_higher = result_list

                # # ãƒ¬ãƒ™ãƒ«5ã”ã¨ã®å››è§’å½¢ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã®å¤‰æ•°
                # level5_start_x = 0
                # level5_max_x = 0
                # level5_max_y = 0

                # # å„ãƒ¬ãƒ™ãƒ«5ã”ã¨ã«å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ 
                # for level, x, y in tuple_list_positions_5_or_higher:
                #     # æœ€å¤§ã®xåº§æ¨™ã¨yåº§æ¨™ã‚’æ›´æ–°
                #     if level >= 5:
                #         level5_max_x = max(level5_max_x, x)
                #         level5_max_y = max(level5_max_y, y)
                #         print(">>>> ç¾åœ¨ã®levelã¯ã€", level, " æ›´æ–°ã•ã‚ŒãŸxåº§æ¨™ã®æœ€å¤§å€¤ã¯ã€", level5_max_x, " æ›´æ–°ã•ã‚ŒãŸyåº§æ¨™ã®æœ€å¤§å€¤ã¯ã€", level5_max_y)

                #     if level == 5 and x != level5_start_x:
                #         # ãƒ¬ãƒ™ãƒ«5ã®åŒºé–“ã®å››è§’å½¢ã‚’è¨ˆç®—
                #         width = level5_max_x - level5_start_x - 120
                #         height = level5_max_y - 720 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯720
                #         frame_x = level5_start_x + ( width - 120 ) / 2
                #         frame_y = 720 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—

                #         # å­è¦ç´ ãŒã‚ã‚‹å ´åˆã®ã¿å››è§’å½¢ã‚’è¿½åŠ ï¼ˆå››è§’å½¢ã®é«˜ã•ãŒ120ã®å ´åˆã¯è¿½åŠ ã—ãªã„ï¼‰
                #         if height != 120:
                #             # å››è§’å½¢ã‚’è¿½åŠ 
                #             add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                #         # æ–°ã—ã„ãƒ¬ãƒ™ãƒ«5ã®é–‹å§‹ç‚¹ã‚’è¨­å®š
                #         level5_start_x = x
                #         print(">>>> æ–°ã—ã„level5ã®é–‹å§‹ç‚¹ã¯ã€", level5_start_x)
                #         level5_max_x = x
                #         print(">>>> ç¾åœ¨ã®level5ã®xè»¸ã®æœ€å¤§å€¤ã¯ã€", level5_max_x)
                #         level5_max_y = 720  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

                # # æœ€å¾Œã®ç¯„å›²ã®å››è§’å½¢ã‚’è¨ˆç®—ã—ã¦è¿½åŠ ï¼ˆãƒ¬ãƒ™ãƒ«5ãŒæœ€å¾Œã«ç¾ã‚ŒãŸå ´åˆï¼‰
                # if level5_max_x > level5_start_x:
                #     width = level5_max_x - level5_start_x + 120
                #     height = level5_max_y - 720 + 120  # yåº§æ¨™ã®åŸºæº–ç‚¹ã¯720
                #     frame_x = level5_start_x + ( width - 120 ) / 2
                #     frame_y = 720 + ( height - 120 ) / 2  # yåº§æ¨™ã®åŸºæº–ç‚¹ã‚’åŠ ç®—
                #     add_rounded_rectangle(api_token, boardId, frame_x, frame_y, width, height)

                markdown_text = st.session_state["markdown_text"]
                # ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒã‚¹ãƒˆã—ãŸç®‡æ¡æ›¸ãå½¢å¼ã«å¤‰æ›ã€‚
                converted_markdown = headline_to_list(markdown_text)

                st.subheader("åˆ†é¡žçµæžœï¼š")

                # ãƒªã‚¹ãƒˆå½¢å¼ã®ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡ºåŠ›ã€‚
                st.markdown(converted_markdown)


        sentence_container = st.container()
        with sentence_container:
            with st.form(key="my_sentence", clear_on_submit=False):
                if "markdown_text" not in st.session_state:
                    st.session_state["markdown_text"] = ""
                layered_data = st.text_area(label="éšŽå±¤åŒ–ãƒ‡ãƒ¼ã‚¿: ", key="layered_data", value=st.session_state["markdown_text"], height=300)
                sentence_button = st.form_submit_button(label="ãƒ‡ãƒ¼ã‚¿ã‚’æ–‡ç« åŒ–")
            if sentence_button and layered_data:

                # ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢"éšŽå±¤åŒ–ãƒ‡ãƒ¼ã‚¿"ã®ãƒ‡ãƒ¼ã‚¿ã§session_stateã®"markdown_text"ã‚’æ›´æ–°
                st.session_state["markdown_text"] = layered_data

                # session_stateã®"markdown_text"ã‚’ãƒªã‚»ãƒƒãƒˆ
                st.session_state.messages = []

                # å¤‰æ•°answerã‚’ãƒªã‚»ãƒƒãƒˆ
                answer = ""
                # å¤‰æ•°labelã‚’ãƒªã‚»ãƒƒãƒˆ
                label = ""
                sentence = f"""
        ### Instructions:
        {translated_theme}
        You are a philosopher who excels at introspection. Please logically connect each of the following bulleted items into a sentence.
        Please add philosophical criticism along the way.

        ### Condition:
        Please write in Japanese.
        Any additional explanations should be enclosed in parentheses.
        The bullet points to be entered can be summarized as follows; {label}

        ### Input:
        ### å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œ
        ### æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„

        ### Output:
        å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œã€‚ï¼ˆç­”ãˆã®ã‚ã‚‹å•é¡Œã‚’ãŸã å¼·åˆ¶çš„ã«è§£ç­”ã•ã›ã‚‰ã‚Œã‚‹ã®ã¯ç„¡é§„ã ã¨æ€ã†ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚„ChatGPTãªã©ãŒæ€¥é€Ÿã«ç™ºå±•ã—ã¦ã„ã‚‹ã®ã§ã€ãã†ã„ã£ãŸå˜ãªã‚‹æš—è¨˜ã‚„è«–ç†è¨ˆç®—ã¯ã€ãã®ã†ã¡äººé–“ãŒã‚„ã‚‹å¿…è¦ã¯ãªããªã‚‹ã¨æ€ã†ã€‚ãã‚Œãªã®ã«ã€ã“ã®ã¾ã¾åå·®å€¤è‡³ä¸Šä¸»ç¾©ã®è©°ã‚è¾¼ã¿æ•™è‚²ã§ä»Šå¾Œã‚‚ã‚„ã£ã¦ã„ããªã‚‰ã°ã€ä½•ã®å½¹ã«ã‚‚ç«‹ãŸãªã„å¤§äººã‚’è‚²ã¦ã‚‹ã“ã¨ã«ãªã‚‹ã ã‚ã†ã€‚ï¼‰
        ãã†ã§ã¯ãªãã¦ã€ã‚‚ã£ã¨æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„ã€‚ï¼ˆç­”ãˆã®ãªã„å•ã„ã«è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ç«‹ã¡å‘ã‹ã£ãŸã‚Šã€è‡ªåˆ†ã ã‘ã®ç‰¹åˆ¥ãªèˆˆå‘³é–¢å¿ƒã‚’è‚²ã¦ã¦å°‚é–€æ€§ã‚’é«˜ã‚ãŸã‚Šã™ã‚‹å‹‰å¼·ã®æ–¹ãŒä»Šå¾Œæ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã¯æ˜Žã‚‰ã‹ã ã€‚ï¼‰

        ### Input:
        """
                
                simplified_answer = ""
                simplifying_sentence = f"""
        ### Instruction:
        {translated_theme}
        Please summarise the text in 1~2 lines, including the bracketed parts.

        ### Condition:
        Please write in Japanese.
        Please make sure that the text is chewed up in a way that high school students can understand.
        Lines beginning with bracketed numbers should be transcribed in their original position and with no change in content.
        Please add a logical connection to the text below.
        {simplified_answer}

        ### Input:
        (1) å¸¸è­˜ã¯ãšã‚Œã®å¤§åˆ‡ãªè¡Œå‹•

        å®¿é¡ŒãŒå¤šã™ãŽã¦èª²é¡Œã‚’ã“ãªã™ã ã‘ã«ãªã£ã¦ã„ã‚‹ã®ãŒå«Œã€‚ï¼ˆç­”ãˆã®ã‚ã‚‹å•é¡Œã‚’ãŸã å¼·åˆ¶çš„ã«è§£ç­”ã•ã›ã‚‰ã‚Œã‚‹ã®ã¯ç„¡é§„ã ã¨æ€ã†ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚„ChatGPTãªã©ãŒæ€¥é€Ÿã«ç™ºå±•ã—ã¦ã„ã‚‹ã®ã§ã€ãã†ã„ã£ãŸå˜ãªã‚‹æš—è¨˜ã‚„è«–ç†è¨ˆç®—ã¯ã€ãã®ã†ã¡äººé–“ãŒã‚„ã‚‹å¿…è¦ã¯ãªããªã‚‹ã¨æ€ã†ã€‚ãã‚Œãªã®ã«ã€ã“ã®ã¾ã¾åå·®å€¤è‡³ä¸Šä¸»ç¾©ã®è©°ã‚è¾¼ã¿æ•™è‚²ã§ä»Šå¾Œã‚‚ã‚„ã£ã¦ã„ããªã‚‰ã°ã€ä½•ã®å½¹ã«ã‚‚ç«‹ãŸãªã„å¤§äººã‚’è‚²ã¦ã‚‹ã“ã¨ã«ãªã‚‹ã ã‚ã†ã€‚ï¼‰
        ãã†ã§ã¯ãªãã¦ã€ã‚‚ã£ã¨æœªæ¥ã®ç¤¾ä¼šã‚’ç™ºå±•ã•ã›ã‚‹ã‚ˆã†ãªæ„å‘³ã‚ã‚‹å‹‰å¼·ãŒã—ãŸã„ã€‚ï¼ˆç­”ãˆã®ãªã„å•ã„ã«è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ç«‹ã¡å‘ã‹ã£ãŸã‚Šã€è‡ªåˆ†ã ã‘ã®ç‰¹åˆ¥ãªèˆˆå‘³é–¢å¿ƒã‚’è‚²ã¦ã¦å°‚é–€æ€§ã‚’é«˜ã‚ãŸã‚Šã™ã‚‹å‹‰å¼·ã®æ–¹ãŒä»Šå¾Œæ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã¯æ˜Žã‚‰ã‹ã ã€‚ï¼‰ã¤ã¾ã‚Šã€ç›®å…ˆã®å®¿é¡Œã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§ã¯ãªãã€å°†æ¥ã®ç¤¾ä¼šã«æ„ç¾©ã®ã‚ã‚‹å­¦ã³ã‚’ã—ãŸã„ã¨ã„ã†ã“ã¨ã€‚ãã—ã¦ãã®ãŸã‚ã«ã¯ã€å­ã©ã‚‚ã ã‘ã˜ã‚ƒãªãå¤§äººã®æ•™è‚²ã‚‚å¿…è¦ã ã¨æ€ã†ã€‚
        ï¼ˆãã‚‚ãã‚‚ä»Šã®æ•™å¸«ãŒæ˜”ãªãŒã‚‰ã®è©°ã‚è¾¼ã¿å¼ã®æ•™è‚²ã§è‚²ã£ãŸã®ã§ã€ãã®æ„è­˜æ”¹é©ãŒå¿…è¦ã ã€‚æ•™å¸«è‡ªèº«ãŒç­”ãˆã®ãªã„è‡ªåˆ†ã®å¿ƒã®åº•ã‹ã‚‰å‡ºã¦ããŸå•ã„ã‚’è¨­å®šã—ã€ç”Ÿå¾’ã¨ä¸€ç·’ã«ãã‚Œã«å–ã‚Šçµ„ã‚€å§¿å‹¢ã‚’è¦‹ã›ãªã„ã¨ã€å­ä¾›é”ã¯ã¤ã„ã¦ã„ã‹ãªã„ã€‚ãã‚Œã ã‘ã§ã¯ãªãã€å­ä¾›ã®è¦ªãŸã¡ã‚‚æ–°ã—ã„å­¦ã³ã‚’äººç”Ÿã«å–ã‚Šå…¥ã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ç­”ãˆã®ãªã„æŽ¢ç©¶æ´»å‹•ã¯å¾“æ¥ã®å­¦ç¿’ã«æ¯”ã¹ã¦ã€ã‚ˆã‚Šæ—¥å¸¸ç”Ÿæ´»ã«æ·±ãé–¢ã‚ã‚‹ã‚‚ã®ã ã€‚æ™®æ®µéŽã”ã—ã¦ã„ã‚‹ä¸­ã§æ„Ÿã˜ã‚‹ç–‘å•ã‚„é•å’Œæ„Ÿãªã©ã‚’èµ·ç‚¹ã«ã—ãŸã€å®Ÿä½“é¨“ã«å³ã—ãŸå•ã„ã§ã‚ã‚‹ã»ã©ã€ä»Šå¾Œã®é•·ã„äººç”Ÿã§å–ã‚Šçµ„ã‚€ã«å€¤ã™ã‚‹æ·±ã„ã‚‚ã®ã«ãªã‚Šã‚„ã™ã„ã€‚ãªã®ã§ã€ã“ã‚Œã¾ã§ã®ã‚ˆã†ã«è¦ªãŒæ•™è‚²ã‚’å­¦æ ¡ã‚„å¡¾ã«ä»»ã›ã£ã±ãªã—ã«ã—ã¦ã€å®¶åº­ã§å­ä¾›ã«ç„¡é–¢å¿ƒã§ã„ã¦ã¯å­ä¾›ã®æŽ¢ç©¶å¿ƒãŒè‚²ã¡ã«ãããªã‚‹ã€‚æ•™å¸«ã¨åŒã˜ã‚ˆã†ã«ã€è¦ªãŸã¡ã‚‚è‡ªåˆ†ã®å•ã„ã‚’ç«‹ã¦ã¦ãã‚Œã‚’è¿½æ±‚ã™ã‚‹å–¶ã¿ã‚’å®Ÿéš›ã«ã‚„ã‚‹ã¹ãã ã€‚ãã—ã¦ã€ãã®è¡Œå‹•ãŒå­ä¾›ãŸã¡ã‚’æ„ŸåŒ–ã•ã›ã€å®¶åº­ã‚’æ´»æ°—ã¥ã‹ã›ã¦ã€ã•ã‚‰ã«ã¯è·å ´ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚‚ä¸Šã’ã‚‹ã“ã¨ã«ãªã‚‹ã®ãŒç†æƒ³ã ã€‚ï¼‰ã“ã®ã‚ˆã†ã«ã€æœªæ¥ã«ã¨ã£ã¦æ„å‘³ã®ã‚ã‚‹æœ¬å½“ã®å­¦ã³ã¯ã€å¹´é½¢ã«é–¢ä¿‚ãªãèª°ã«ã§ã‚‚é‡è¦ã¨è¨€ãˆã‚‹ã€‚

        ### Output:
        (1) å¸¸è­˜ã¯ãšã‚Œã®å¤§åˆ‡ãªè¡Œå‹•

        ãŸã å•é¡Œã®ç­”ãˆã‚’æ•™ãˆè¾¼ã‚€å¤ã„ã‚„ã‚Šæ–¹ã§ã¯ãªãã€ãªãœãã†ãªã‚‹ã®ã‹ã‚’è€ƒãˆãŸã‚Šã€æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ãŸã‚Šã™ã‚‹å­¦ã³ãŒå¤§åˆ‡ã ã£ã¦è©±ã ã‚ˆã€‚ãƒãƒƒãƒˆã‚„ChatGPTã¿ãŸã„ãªè³¢ã„ãƒ„ãƒ¼ãƒ«ãŒãŸãã•ã‚“ã‚ã‚‹ã‹ã‚‰ã€å˜ç´”ãªæš—è¨˜ã‚„è¨ˆç®—ã¯ã‚‚ã†äººé–“ãŒã‚ã–ã‚ã–ã‚„ã‚‹ã“ã¨ã˜ã‚ƒãªããªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã€‚ã§ã‚‚ã€å­¦æ ¡ãŒä»Šã®ã¾ã¾è©°ã‚è¾¼ã¿ã§ç‚¹æ•°ã ã‘è¿½ã„ã‹ã‘ã‚‹æ•™è‚²ã‚’ç¶šã‘ãŸã‚‰ã€æœ¬å½“ã«å¿…è¦ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‰ã‚Œãªã„å¤§äººã«ãªã£ã¦ã—ã¾ã†ã€‚
        ã“ã‚Œã‹ã‚‰ã¯ã€ç­”ãˆãŒã™ãã«ã¯å‡ºãªã„ã‚ˆã†ãªå•é¡Œã«ã©ã†ç«‹ã¡å‘ã‹ã†ã‹ã€è‡ªåˆ†ã®å¥½ããªã“ã¨ã‚’è¦‹ã¤ã‘ã¦æ·±ãæŽ˜ã‚Šä¸‹ã’ã‚‹å­¦ã³ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚“ã ã€‚å…ˆç”ŸãŸã¡ã‚‚æ˜”ã®ã‚„ã‚Šæ–¹ã‹ã‚‰å¤‰ã‚ã£ã¦ã€ç”Ÿå¾’ã¨ä¸€ç·’ã«è€ƒãˆã‚‹ã“ã¨ãŒå¤§äº‹ã ã—ã€ãã‚Œã¯è¦ªã‚‚åŒã˜ã€‚å®¶ã§ã®å­¦ã³ã‚‚ã™ã”ãé‡è¦ã§ã€è¦ªãŒè‡ªåˆ†ã§ç–‘å•ã‚’æŒã£ã¦è€ƒãˆã‚‹å§¿ã‚’å­ä¾›ã«è¦‹ã›ã‚‹ã“ã¨ãŒã€å­ä¾›ã®å¥½å¥‡å¿ƒã‚’è‚²ã¦ã‚‹ã‚“ã ã€‚
        ã¤ã¾ã‚Šã€å­¦æ ¡ã‚„å¡¾ã ã‘ã˜ã‚ƒãªãã¦ã€å®¶ã§ã‚‚è¦ªãŒå­ä¾›ã¨ä¸€ç·’ã«æ–°ã—ã„ã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ãŸã‚Šã€è€ƒãˆãŸã‚Šã™ã‚‹ã“ã¨ãŒã€å­ä¾›ã®æˆé•·ã«ã¨ã£ã¦ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒå¤§äº‹ã£ã¦ã‚ã‘ã€‚ãã†ã™ã‚‹ã¨ã€å®¶ã®ä¸­ã‚‚ã‚‚ã£ã¨æ¥½ã—ããªã£ã¦ã€è¦ªã®ä»•äº‹ã®ã‚„ã‚‹æ°—ã«ã‚‚ã¤ãªãŒã‚‹ã‚“ã ã€‚

        ### Input:
        """
                
                summarized_answer = ""
                summarized_sentence = f"""
        ### Instruction:
        {translated_theme}
        Briefly summarize the following sentences in one sentence.

        ### Condition:
        Please write in Japanese.
        Please make sure that the text is chewed up in a way that high school students can understand.
        Please add a logical connection and a conjunction to the the text below.
        {summarized_answer}

        ### Input:
        ãŸã å•é¡Œã®ç­”ãˆã‚’æ•™ãˆè¾¼ã‚€å¤ã„ã‚„ã‚Šæ–¹ã§ã¯ãªãã€ãªãœãã†ãªã‚‹ã®ã‹ã‚’è€ƒãˆãŸã‚Šã€æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ãŸã‚Šã™ã‚‹å­¦ã³ãŒå¤§åˆ‡ã ã£ã¦è©±ã ã‚ˆã€‚ãƒãƒƒãƒˆã‚„ChatGPTã¿ãŸã„ãªè³¢ã„ãƒ„ãƒ¼ãƒ«ãŒãŸãã•ã‚“ã‚ã‚‹ã‹ã‚‰ã€å˜ç´”ãªæš—è¨˜ã‚„è¨ˆç®—ã¯ã‚‚ã†äººé–“ãŒã‚ã–ã‚ã–ã‚„ã‚‹ã“ã¨ã˜ã‚ƒãªããªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã€‚ã§ã‚‚ã€å­¦æ ¡ãŒä»Šã®ã¾ã¾è©°ã‚è¾¼ã¿ã§ç‚¹æ•°ã ã‘è¿½ã„ã‹ã‘ã‚‹æ•™è‚²ã‚’ç¶šã‘ãŸã‚‰ã€æœ¬å½“ã«å¿…è¦ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‰ã‚Œãªã„å¤§äººã«ãªã£ã¦ã—ã¾ã†ã‚ˆã€‚
        ã“ã‚Œã‹ã‚‰ã¯ã€ç­”ãˆãŒã™ãã«ã¯å‡ºãªã„ã‚ˆã†ãªå•é¡Œã«ã©ã†ç«‹ã¡å‘ã‹ã†ã‹ã€è‡ªåˆ†ã®å¥½ããªã“ã¨ã‚’è¦‹ã¤ã‘ã¦æ·±ãæŽ˜ã‚Šä¸‹ã’ã‚‹å­¦ã³ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚“ã ã€‚å…ˆç”ŸãŸã¡ã‚‚æ˜”ã®ã‚„ã‚Šæ–¹ã‹ã‚‰å¤‰ã‚ã£ã¦ã€ç”Ÿå¾’ã¨ä¸€ç·’ã«è€ƒãˆã‚‹ã“ã¨ãŒå¤§äº‹ã ã—ã€ãã‚Œã¯è¦ªã‚‚åŒã˜ã€‚å®¶ã§ã®å­¦ã³ã‚‚ã™ã”ãé‡è¦ã§ã€è¦ªãŒè‡ªåˆ†ã§ç–‘å•ã‚’æŒã£ã¦è€ƒãˆã‚‹å§¿ã‚’å­ä¾›ã«è¦‹ã›ã‚‹ã“ã¨ãŒã€å­ä¾›ã®å¥½å¥‡å¿ƒã‚’è‚²ã¦ã‚‹ã‚“ã ã€‚
        ã¤ã¾ã‚Šã€å­¦æ ¡ã‚„å¡¾ã ã‘ã˜ã‚ƒãªãã¦ã€å®¶ã§ã‚‚è¦ªãŒå­ä¾›ã¨ä¸€ç·’ã«æ–°ã—ã„ã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ãŸã‚Šã€è€ƒãˆãŸã‚Šã™ã‚‹ã“ã¨ãŒã€å­ä¾›ã®æˆé•·ã«ã¨ã£ã¦ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒå¤§äº‹ã£ã¦ã‚ã‘ã€‚ãã†ã™ã‚‹ã¨ã€å®¶ã®ä¸­ã‚‚ã‚‚ã£ã¨æ¥½ã—ããªã£ã¦ã€è¦ªã®ä»•äº‹ã®ã‚„ã‚‹æ°—ã«ã‚‚ã¤ãªãŒã‚‹ã‚ˆã€‚

        ### Output:
        ã„ã¾ã®æ™‚ä»£ã¯ã€å˜ç´”ãªæš—è¨˜ã‚ˆã‚Šã‚‚è€ƒãˆã‚‹åŠ›ã‚„æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹åŠ›ã‚’è‚²ã¦ã‚‹å­¦ã³ãŒå¤§åˆ‡ãªã‚“ã ã€‚ãã—ã¦ã€å®¶åº­ã§ã‚‚è¦ªãŒå­ä¾›ã¨ä¸€ç·’ã«å­¦ã¶ã“ã¨ãŒã§ãã‚Œã°ã€å­ä¾›ã ã‘ã˜ã‚ƒãªãã¦è¦ªã®æˆé•·ã«ã‚‚ã¤ãªãŒã‚‹ã£ã¦ã‚ã‘ã€‚

        ### Input:
        """
            
                markdown_text = st.session_state["markdown_text"]
                # ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒã‚¹ãƒˆã—ãŸç®‡æ¡æ›¸ãå½¢å¼ã«å¤‰æ›ã€‚
                converted_markdown = headline_to_list(markdown_text)

                st.subheader("åˆ†é¡žçµæžœï¼š")

                # ãƒªã‚¹ãƒˆå½¢å¼ã®ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡ºåŠ›ã€‚
                st.markdown(converted_markdown)
                # ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ®µè½ã”ã¨ã«åˆ†å‰²ã€‚
                segmented_sections = split_sections(markdown_text)
                basic_data_for_abduction = {}
                summarized_list = []
                summarized_each_list = []
                summarized_list_split = []
                summarized_all_list = []
                last_answer = ""
                last_answer_summarized = ""
                just_before_answer_summarized = ""
                
                st.subheader("æ–‡ç« åŒ–ï¼š")

                for section in segmented_sections:

                    # "**"ã§æŒŸã¾ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’æŠ½å‡ºã™ã‚‹
                    symbol_pattern = r"(\*\*.*?\*\*)"
                    matches_symbol = re.findall(symbol_pattern, section)
                    matches_symbol = "\n" + matches_symbol[0]

                    # ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’é™¤ã„ãŸãƒ©ãƒ™ãƒ«ç¾¤ã‚’labels_onlyã«å…¥ã‚Œã‚‹
                    labels_only = section.replace(matches_symbol, "")

                    # labels_onlyã®é …ç›®ã‚’é€†é †ã«ä¸¦ã³æ›¿ãˆã¦labels_only_reversedã«å…¥ã‚Œã‚‹
                    # labels_only_lines = labels_only.strip().split("\n")
                    # labels_only_reversed = "\n".join(list(reversed(labels_only_lines)))

                    # ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’ç« ç«‹ã¦ã¨ã—ã¦å‡ºåŠ›
                    st.markdown(matches_symbol)

                    # ã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã‚’é™¤ã„ãŸãƒ©ãƒ™ãƒ«ç¾¤ã‚’ãƒªã‚¹ãƒˆã«æ ¼ç´
                    labels_only_list = text_to_lines_list(labels_only)

                    # BDAï¼ˆBasic Data for Abductionï¼‰ã”ã¨ã«åˆ†å‰²ã—ãƒªã‚¹ãƒˆåŒ–
                    BDA_list = list_to_BDA(labels_only_list)
                    # ãƒªã‚¹ãƒˆåŒ–ã—ãŸBDAã‚’é€†é †ã«ä¸¦ã³æ›¿ãˆ
                    BDA_list_reversed = list(reversed(BDA_list))

                    # BDAã”ã¨ã®æ–‡ç« åŒ–ã«ä½¿ã†last_messagesã‚’ãƒªã‚»ãƒƒãƒˆ
                    last_messages = []
                    # BDAã”ã¨ã«æ–‡ç« åŒ–
                    for group in BDA_list_reversed:
                        # groupãŒ0å€‹ï¼ˆã‚·ãƒ³ãƒœãƒ«ãƒžãƒ¼ã‚¯ã®ã¿ï¼‰ã®å ´åˆã‚’é™¤ã„ã¦æ–‡ç« åŒ–ã‚’å®Ÿè¡Œ
                        if len(group) >= 1:
                            # sentence_generatingã§æ–‡ç« åŒ–ã—ã€è¿”ã—å€¤ã®è¦ç´„æ–‡ã‚’just_before_answer_summarizedã«æ ¼ç´
                            just_before_answer_summarized = sentence_generating(llm,group,st.session_state["translated_theme"],summarized_list,st.session_state["openai_api_key"],style)
                            summarized_list.append(just_before_answer_summarized)

                    # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã®ã¾ã¨ã‚
                    summarized_text = "\n".join(summarized_list)
                    just_before_answer_summarized = ""
                    st.markdown("ã¾ã¨ã‚")
                    summarized_all = sumarized_sentence_generating(llm,summarized_text,st.session_state["translated_theme"],style)
                    st.session_state["summarized_data"] = summarized_all
                    st.markdown(summarized_all)
                    summarized_text = ""
                    # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¾ã¨ã‚ã‚’å…¨ä½“ã®ã¾ã¨ã‚ã«æ ¼ç´ã—ã¦ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¾ã¨ã‚ã¯ãƒªã‚»ãƒƒãƒˆ
                    summarized_all_list.append(summarized_all)
                    summarized_list = []

                last_answer = st.session_state.messages[-1].content
                if last_answer:
                    last_answer_summarized = summarize(last_answer,openai_api_key,style)
                else:
                    last_answer_summarized = ""
                summarized_all_list.append(last_answer_summarized)
                
                summarized_text = "\n".join(summarized_all_list)
                just_before_answer_summarized = ""
                st.markdown("**å…¨ä½“ã®ã¾ã¨ã‚**")
                summarized_all = sumarized_sentence_generating(llm,summarized_text,st.session_state["translated_theme"],style)
                # summarized_all = summarized_all.replace("\n","")
                st.session_state["summarized_data"] = summarized_all
                st.markdown(summarized_all)

        # related_container = st.container()
        # with related_container:
        #     with st.form(key="my_related", clear_on_submit=False):
        #         summarized_data = st.text_area(label="ã¾ã¨ã‚ã®æ–‡ç« : ", key="summarized_data", value=st.session_state["summarized_data"], height=300)
        #         ask_button = st.form_submit_button(label="ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢ã‹ã‚‰ãƒ’ãƒ³ãƒˆã‚’æŽ¢ã™")
        #         ask_gal_button = st.form_submit_button(label="ã‚®ãƒ£ãƒ«ã‹ã‚‰ãƒ’ãƒ³ãƒˆã‚’å¾—ã‚‹")

        #     if ask_button and summarized_data:

        #         # ã¾ã¨ã‚æ–‡ç« ã®ç·æ–‡å­—æ•°ã®3åˆ†ã®1ã”ã¨ã«åˆ†å‰²ã—ã¦ãƒªã‚¹ãƒˆåŒ–
        #         split_text_length = int(len(summarized_data) / 3)
        #         split_sentences = [summarized_data[x:x+split_text_length] for x in range(0,len(summarized_data),split_text_length)]
        #         # åˆ†å‰²çµæžœãŒ20æ–‡å­—ä»¥ä¸‹ã®æ–‡ç« ã®å ´åˆã€å‰Šé™¤ã™ã‚‹
        #         for i, item in enumerate(split_sentences):
        #             if len(item) < 20:
        #                 del split_sentences[i]

        #         with st.spinner("æ¤œç´¢ä¸­ ..."):
        #             # wikipediaãƒ‡ãƒ¼ã‚¿ã€faiss indexã€embeddingåŒ–ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
        #             wikija_dataset, faiss_index, model = load_wiki()

        #         st.subheader(f"ãƒ†ãƒ¼ãƒžï¼š")
        #         st.markdown(f"""#### ã€Ž{st.session_state["user_theme"]}ã€""")
        #         st.markdown("ã¾ã¨ã‚ã®æ–‡ç« ã‚’ã‚‚ã¨ã«ã€ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢ã‹ã‚‰é–¢ä¿‚ã®ã‚ã‚Šãã†ãªãƒ’ãƒ³ãƒˆã‚’æŽ¢ã—ã¾ã™ã€‚")

        #         wiki_item_list = []
        #         for i, item in enumerate(split_sentences):
        #             emb = to_emb(model, item)
        #             # faiss ã§æ¤œç´¢ã—ã¦ã€é–¢é€£ Top-15 ã‚’å–ã‚Šå‡ºã™
        #             TOP_K = 20
        #             scores, indexes = faiss_index.search(emb, TOP_K)
        #             # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é †1~20ä½ã‹ã‚‰1ã¤ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§æŒ‡å®š
        #             selected_indexes = random.sample(range(1,20), k=1)
        #             # æ®‹ã‚Šä¸€ã¤ã¯ã€8~20ä½ã®ã†ã¡ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã§æŒ‡å®š
        #             # selected_indexes.insert(1,random.randint(8,20))

        #             for sel_i, idx in enumerate(selected_indexes):
        #                 if idx < TOP_K:  # ç¯„å›²ã‚’è¶…ãˆãªã„ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯
        #                     id = indexes[0][idx]
        #                     score = scores[0][idx]
        #                     data = wikija_dataset[int(id)]
        #                     print((score, data["title"], data["text"][:100]))
        #                     wiki_title = data["title"]

        #                     # wikiã®é …ç›®ãŒé‡è¤‡ã—ã¦ã„ãªã„å ´åˆã®ã¿å‡¦ç†
        #                     if wiki_title not in wiki_item_list:
        #                         wiki_item_list.append(wiki_title)

        #                         wiki_text = ">..." + data["text"] + "..."

        #                         # æŠ½å‡ºã—ãŸãƒ†ã‚­ã‚¹ãƒˆã®æœ€åˆã®1æ–‡ã‚’å–ã‚Šå‡ºã™
        #                         first_sentence_wiki = data["text"].partition("ã€‚")[0]

        #                         url = "https://ja.wikipedia.org/api/rest_v1/page/summary/" + data["title"]

        #                         response = requests.get(url)
        #                         json_data = response.json()

        #                         if "extract" in json_data:
        #                             wiki_extract = json_data["extract"]
        #                         else:
        #                             wiki_extract = ""
        #                         # ãƒ’ãƒ³ãƒˆã¨ãªã‚‹è©©ã®ãŸã‚ã®llmã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°
        #                         llm_poet = ChatOpenAI(openai_api_key=openai_api_key, temperature=0, model_name=st.session_state["model_name"])
        #                         poet_answer = related_sentence_generating(llm_poet,item,data["text"],st.session_state["translated_theme"],wiki_extract)
        #                         st.markdown(f"### ãƒ»{wiki_title}")
        #                         if "thumbnail" in json_data:
        #                             thumbnail_image = json_data["thumbnail"]['source']
        #                             st.image(thumbnail_image)
        #                         if wiki_extract:
        #                             st.caption(wiki_extract)
        #                         st.markdown(poet_answer)
        #                         st.markdown(wiki_text)
        #                         st.link_button("Wikipedia", "https://ja.wikipedia.org/wiki/" + data["title"] + "#:~:text=" + first_sentence_wiki)
                                
        #                         st.markdown("\n\n")

        #                         bing_query_url = "https://www.bing.com/search?q=" + wiki_title
        #                         st.link_button(f"Webã§ã€Œ{wiki_title}ã€ã‚’æ¤œç´¢", bing_query_url)

        #                         st.markdown("\n\n")

        #                         st.markdown("##### ðŸ“š")

        #                         url = "https://www.googleapis.com/books/v1/volumes?q=" + wiki_title + "&langRestrict=ja&orderBy=newest"

        #                         response = requests.get(url)
        #                         json_data = response.json()

        #                         col1, col2, col3 = st.columns(3)
        #                         columns = [col1, col2, col3]

        #                         if 'items' in json_data:
        #                             for i, idx in enumerate(json_data['items'][0:2]):
        #                                 book_item = json_data['items'][i]
        #                                 volume_info = book_item['volumeInfo']
        #                                 book_id = book_item['id']
        #                                 book_title = volume_info['title']
        #                                 col = columns[i]  # å„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç•°ãªã‚‹ã‚«ãƒ©ãƒ ã«å‡ç­‰ã«å‰²ã‚Šå½“ã¦ã‚‹
        #                                 with col:
        #                                     st.markdown(f"""<span style="word-wrap:break-word;">{book_title}</span>""", unsafe_allow_html=True)
        #                                     if 'imageLinks' in volume_info:
        #                                         book_thumbnail = volume_info['imageLinks']['thumbnail']
        #                                         st.image(book_thumbnail)
        #                                     else:
        #                                         book_thumbnail = ""
        #                                     if 'description' in volume_info:
        #                                         book_description = volume_info['description']
        #                                         st.caption(book_description[:100])
        #                                     else:
        #                                         book_description = ""
        #                                     book_link = "https://www.google.co.jp/books/edition/_/" + book_id + "?hl=ja"
        #                                     # book_link = volume_info['previewLink']
        #                                     st.link_button("è©³ç´°", book_link)

        #                             st.markdown("\n")
        #                         else:
        #                             st.markdown("Google Booksã§ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n")

        #                         amazon_link = f"https://www.amazon.co.jp/s?k={wiki_title}&i=stripbooks"
        #                         st.link_button("Amazonã§é–¢é€£æ›¸ç±ã‚’æŽ¢ã™", amazon_link)
        #                         calil_link = "https://calil.jp/search?q=" + wiki_title
        #                         st.link_button("å›³æ›¸é¤¨ï¼ˆã‚«ãƒ¼ãƒªãƒ«ï¼‰ã§é–¢é€£è³‡æ–™ã‚’æŽ¢ã™", calil_link)

        #                         st.markdown("\n\n")

        #     if ask_gal_button and summarized_data:

        #         # ã¾ã¨ã‚æ–‡ç« ã®ç·æ–‡å­—æ•°ã®3åˆ†ã®1ã”ã¨ã«åˆ†å‰²ã—ã¦ãƒªã‚¹ãƒˆåŒ–
        #         split_text_length = int(len(summarized_data) / 3)
        #         split_sentences = [summarized_data[x:x+split_text_length] for x in range(0,len(summarized_data),split_text_length)]
        #         # åˆ†å‰²çµæžœãŒ20æ–‡å­—ä»¥ä¸‹ã®æ–‡ç« ã®å ´åˆã€å‰Šé™¤ã™ã‚‹
        #         for i, item in enumerate(split_sentences):
        #             if len(item) < 20:
        #                 del split_sentences[i]

        #         with st.spinner("ã‚¤ãƒ³ã‚¹ã‚¿ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­ ..."):
        #             # wikipediaãƒ‡ãƒ¼ã‚¿ã€faiss indexã€embeddingåŒ–ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
        #             wikija_dataset, faiss_index, model = load_wiki()

        #         st.subheader(f"ä¾é ¼ãƒ†ãƒ¼ãƒžï¼š")
        #         st.markdown(f"""#### ã€Ž{st.session_state["user_theme"]}ã€""")
        #         st.markdown("ä¸Šã®ã¾ã¨ã‚ã‚’ã‚‚ã¨ã«ã€æ¬¡ã«èª¿æŸ»ã™ã¹ãå¯¾è±¡ã‚’å¤§å­¦ç”Ÿã‹ã‚‰èžãã¾ã—ãŸðŸ¤­ðŸ¤")
        #         st.caption("""
        # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚„å›³æ›¸é¤¨ã§èª¿ã¹ãŸã‚Šã€å®Ÿéš›ã«ç¾åœ°ã‚’è¨ªã‚ŒãŸã‚Šã™ã‚‹ãŸã‚ã®å…¥ã‚Šå£ã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
        # ãã“ã§å‡ºä¼šã£ãŸã‚Šè¦‹èžãã—ãŸã“ã¨ã‹ã‚‰ã€æ›´ã«æ¬¡ã®èª¿æŸ»å¯¾è±¡ã«æ¸¡ã‚Šæ­©ãã€æœ€çµ‚çš„ã«ã‚ãªãŸã®å•é¡Œæ„è­˜ã‚’æ›´ã«æ·±ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n
        # ãã—ã¦ã€èª¿ã¹ã‚‹ãªã‹ã§ã€æ„Ÿå‹•ã—ãŸã‚Šã€ãªã‚‹ã»ã©ã¨æ€ã£ãŸã‚Šã€ã¾ãŸã¯ã“ã‚Œã¯é•ã†ãªã¨æ„Ÿã˜ãŸã‚Šã—ãŸã‚‰ã€å¿˜ã‚Œãªã„ã†ã¡ã«ç®‡æ¡æ›¸ãã§ãƒ¡ãƒ¢ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\
        # ãã‚Œã‚’ã¾ãŸã“ã®KJ-GPTã‚’ä½¿ã£ã¦åˆ†æžã—ã¦ã¿ã‚‹ã¨ã€ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã¾ã™ã¾ã™ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
        # """)
        #         wiki_item_list = []
        #         for i, item in enumerate(split_sentences):
        #             # container = st.container()
        #             # container.write(item)
        #             emb = to_emb(model, item)
        #             # faiss ã§æ¤œç´¢ã—ã¦ã€é–¢é€£ Top-15 ã‚’å–ã‚Šå‡ºã™
        #             TOP_K = 15
        #             scores, indexes = faiss_index.search(emb, TOP_K)
        #             # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é †4~15ä½ã‹ã‚‰1ã¤ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§æŒ‡å®š
        #             selected_indexes = random.sample(range(4,15), k=1)
        #             # æ®‹ã‚Šä¸€ã¤ã¯ã€8~20ä½ã®ã†ã¡ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã§æŒ‡å®š
        #             # selected_indexes.insert(1,random.randint(8,20))

        #             for sel_i, idx in enumerate(selected_indexes):
        #                 if idx < TOP_K:  # ç¯„å›²ã‚’è¶…ãˆãªã„ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯
        #                     # if i  == 1 and sel_i == 1:
        #                     #     id = random.randint(1,5555583)
        #                     # if idx % 3  == 0:
        #                     #     id = random.randint(1,5555583)
        #                     # else:
        #                     #     id = indexes[0][idx]
        #                     id = indexes[0][idx]
        #                     score = scores[0][idx]
        #                     data = wikija_dataset[int(id)]
        #                     print((score, data["title"], data["text"][:100]))
        #                     wiki_title = data["title"]

        #                     # wikiã®é …ç›®ãŒé‡è¤‡ã—ã¦ã„ãªã„å ´åˆã®ã¿å‡¦ç†
        #                     if wiki_title not in wiki_item_list:
        #                         wiki_item_list.append(wiki_title)

        #                         wiki_text = ">..." + data["text"] + "..."

        #                         # æŠ½å‡ºã—ãŸãƒ†ã‚­ã‚¹ãƒˆã®æœ€åˆã®1æ–‡ã‚’å–ã‚Šå‡ºã™
        #                         first_sentence_wiki = data["text"].partition("ã€‚")[0]

        #                         url = "https://ja.wikipedia.org/api/rest_v1/page/summary/" + data["title"]

        #                         response = requests.get(url)
        #                         json_data = response.json()

        #                         if "extract" in json_data:
        #                             wiki_extract = json_data["extract"]
        #                         else:
        #                             wiki_extract = ""
        #                         gal_answer = related_gal_sentence_generating(llm,item,data["text"],st.session_state["translated_theme"],wiki_extract)
        #                         st.markdown(f"### ãƒ»{wiki_title}")
        #                         if "thumbnail" in json_data:
        #                             thumbnail_image = json_data["thumbnail"]['source']
        #                             st.image(thumbnail_image)
        #                         if wiki_extract:
        #                             st.caption(wiki_extract)
        #                         st.markdown(gal_answer)
        #                         st.markdown(wiki_text)
        #                         st.link_button("Wikipedia", "https://ja.wikipedia.org/wiki/" + data["title"] + "#:~:text=" + first_sentence_wiki)
                                
        #                         st.markdown("\n\n")

        #                         if any(adult_keyword in wiki_title for adult_keyword in adult_keywords):
        #                             print("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ä¸é©åˆ‡ãªå†…å®¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚")
        #                         else:
        #                             bing_query_url = "https://www.bing.com/search?q=" + wiki_title
        #                             st.link_button(f"Webã§ã€Œ{wiki_title}ã€ã‚’æ¤œç´¢", bing_query_url)

        #                             st.markdown("\n\n")

        #                             st.markdown("##### ðŸ“š")

        #                             url = "https://www.googleapis.com/books/v1/volumes?q=" + wiki_title + "&langRestrict=ja&orderBy=newest"

        #                             response = requests.get(url)
        #                             json_data = response.json()

        #                             col1, col2, col3 = st.columns(3)
        #                             columns = [col1, col2, col3]

        #                             if 'items' in json_data:
        #                                 for i, idx in enumerate(json_data['items'][0:2]):
        #                                     book_item = json_data['items'][i]
        #                                     volume_info = book_item['volumeInfo']
        #                                     book_id = book_item['id']
        #                                     book_title = volume_info['title']
        #                                     col = columns[i]  # å„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç•°ãªã‚‹ã‚«ãƒ©ãƒ ã«å‡ç­‰ã«å‰²ã‚Šå½“ã¦ã‚‹
        #                                     with col:
        #                                         st.markdown(f"""<span style="word-wrap:break-word;">{book_title}</span>""", unsafe_allow_html=True)
        #                                         if 'imageLinks' in volume_info:
        #                                             book_thumbnail = volume_info['imageLinks']['thumbnail']
        #                                             st.image(book_thumbnail)
        #                                         else:
        #                                             book_thumbnail = ""
        #                                         if 'description' in volume_info:
        #                                             book_description = volume_info['description']
        #                                             st.caption(book_description[:100])
        #                                         else:
        #                                             book_description = ""
        #                                         book_link = "https://www.google.co.jp/books/edition/_/" + book_id + "?hl=ja"
        #                                         # book_link = volume_info['previewLink']
        #                                         st.link_button("è©³ç´°", book_link)

        #                                 st.markdown("\n")
        #                             else:
        #                                 st.markdown("Google Booksã§ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n")

        #                             amazon_link = f"https://www.amazon.co.jp/s?k={wiki_title}&i=stripbooks"
        #                             st.link_button("Amazonã§é–¢é€£æ›¸ç±ã‚’æŽ¢ã™", amazon_link)
        #                             calil_link = "https://calil.jp/search?q=" + wiki_title
        #                             st.link_button("å›³æ›¸é¤¨ï¼ˆã‚«ãƒ¼ãƒªãƒ«ï¼‰ã§é–¢é€£è³‡æ–™ã‚’æŽ¢ã™", calil_link)

        #                             st.markdown("\n\n")

    # ã‚³ã‚¹ãƒˆã®è¨ˆç®—ã¨è¡¨ç¤º
    costs = st.session_state.get('costs', [])
    st.sidebar.markdown("## æ–™é‡‘ \n#### *ç¾åœ¨GPT-4oã¯æ–™é‡‘è¨ˆç®—ã«éžå¯¾å¿œ")
    st.sidebar.markdown(f"**åˆè¨ˆé‡‘é¡: ${sum(costs):.5f}**")
    for cost in costs:
        st.sidebar.markdown(f"- ${cost:.5f}")

if __name__ == "__main__":
    main()
